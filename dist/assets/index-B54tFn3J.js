(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $m(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Jm={exports:{}},tc={},Qm={exports:{}},me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lo=Symbol.for("react.element"),tS=Symbol.for("react.portal"),nS=Symbol.for("react.fragment"),iS=Symbol.for("react.strict_mode"),rS=Symbol.for("react.profiler"),sS=Symbol.for("react.provider"),oS=Symbol.for("react.context"),aS=Symbol.for("react.forward_ref"),cS=Symbol.for("react.suspense"),lS=Symbol.for("react.memo"),uS=Symbol.for("react.lazy"),_f=Symbol.iterator;function dS(t){return t===null||typeof t!="object"?null:(t=_f&&t[_f]||t["@@iterator"],typeof t=="function"?t:null)}var Ym={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xm=Object.assign,Zm={};function Gr(t,e,n){this.props=t,this.context=e,this.refs=Zm,this.updater=n||Ym}Gr.prototype.isReactComponent={};Gr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Gr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function eg(){}eg.prototype=Gr.prototype;function cd(t,e,n){this.props=t,this.context=e,this.refs=Zm,this.updater=n||Ym}var ld=cd.prototype=new eg;ld.constructor=cd;Xm(ld,Gr.prototype);ld.isPureReactComponent=!0;var Pf=Array.isArray,tg=Object.prototype.hasOwnProperty,ud={current:null},ng={key:!0,ref:!0,__self:!0,__source:!0};function ig(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)tg.call(e,i)&&!ng.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:lo,type:t,key:s,ref:o,props:r,_owner:ud.current}}function hS(t,e){return{$$typeof:lo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function dd(t){return typeof t=="object"&&t!==null&&t.$$typeof===lo}function fS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Rf=/\/+/g;function Jc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?fS(""+t.key):e.toString(36)}function Ko(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case lo:case tS:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+Jc(o,0):i,Pf(r)?(n="",t!=null&&(n=t.replace(Rf,"$&/")+"/"),Ko(r,e,n,"",function(u){return u})):r!=null&&(dd(r)&&(r=hS(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Rf,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Pf(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+Jc(s,a);o+=Ko(s,e,n,c,r)}else if(c=dS(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+Jc(s,a++),o+=Ko(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Po(t,e,n){if(t==null)return t;var i=[],r=0;return Ko(t,i,"","",function(s){return e.call(n,s,r++)}),i}function pS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var St={current:null},$o={transition:null},mS={ReactCurrentDispatcher:St,ReactCurrentBatchConfig:$o,ReactCurrentOwner:ud};function rg(){throw Error("act(...) is not supported in production builds of React.")}me.Children={map:Po,forEach:function(t,e,n){Po(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Po(t,function(){e++}),e},toArray:function(t){return Po(t,function(e){return e})||[]},only:function(t){if(!dd(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};me.Component=Gr;me.Fragment=nS;me.Profiler=rS;me.PureComponent=cd;me.StrictMode=iS;me.Suspense=cS;me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mS;me.act=rg;me.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Xm({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=ud.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)tg.call(e,c)&&!ng.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];i.children=a}return{$$typeof:lo,type:t.type,key:r,ref:s,props:i,_owner:o}};me.createContext=function(t){return t={$$typeof:oS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:sS,_context:t},t.Consumer=t};me.createElement=ig;me.createFactory=function(t){var e=ig.bind(null,t);return e.type=t,e};me.createRef=function(){return{current:null}};me.forwardRef=function(t){return{$$typeof:aS,render:t}};me.isValidElement=dd;me.lazy=function(t){return{$$typeof:uS,_payload:{_status:-1,_result:t},_init:pS}};me.memo=function(t,e){return{$$typeof:lS,type:t,compare:e===void 0?null:e}};me.startTransition=function(t){var e=$o.transition;$o.transition={};try{t()}finally{$o.transition=e}};me.unstable_act=rg;me.useCallback=function(t,e){return St.current.useCallback(t,e)};me.useContext=function(t){return St.current.useContext(t)};me.useDebugValue=function(){};me.useDeferredValue=function(t){return St.current.useDeferredValue(t)};me.useEffect=function(t,e){return St.current.useEffect(t,e)};me.useId=function(){return St.current.useId()};me.useImperativeHandle=function(t,e,n){return St.current.useImperativeHandle(t,e,n)};me.useInsertionEffect=function(t,e){return St.current.useInsertionEffect(t,e)};me.useLayoutEffect=function(t,e){return St.current.useLayoutEffect(t,e)};me.useMemo=function(t,e){return St.current.useMemo(t,e)};me.useReducer=function(t,e,n){return St.current.useReducer(t,e,n)};me.useRef=function(t){return St.current.useRef(t)};me.useState=function(t){return St.current.useState(t)};me.useSyncExternalStore=function(t,e,n){return St.current.useSyncExternalStore(t,e,n)};me.useTransition=function(){return St.current.useTransition()};me.version="18.3.1";Qm.exports=me;var Ce=Qm.exports;const gS=$m(Ce);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vS=Ce,yS=Symbol.for("react.element"),kS=Symbol.for("react.fragment"),SS=Object.prototype.hasOwnProperty,TS=vS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,CS={key:!0,ref:!0,__self:!0,__source:!0};function sg(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)SS.call(e,i)&&!CS.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:yS,type:t,key:s,ref:o,props:r,_owner:TS.current}}tc.Fragment=kS;tc.jsx=sg;tc.jsxs=sg;Jm.exports=tc;var ie=Jm.exports,Bl={},og={exports:{}},Bt={},ag={exports:{}},cg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(B,Z){var ne=B.length;B.push(Z);e:for(;0<ne;){var Te=ne-1>>>1,ge=B[Te];if(0<r(ge,Z))B[Te]=Z,B[ne]=ge,ne=Te;else break e}}function n(B){return B.length===0?null:B[0]}function i(B){if(B.length===0)return null;var Z=B[0],ne=B.pop();if(ne!==Z){B[0]=ne;e:for(var Te=0,ge=B.length,qe=ge>>>1;Te<qe;){var lt=2*(Te+1)-1,Dt=B[lt],bt=lt+1,tr=B[bt];if(0>r(Dt,ne))bt<ge&&0>r(tr,Dt)?(B[Te]=tr,B[bt]=ne,Te=bt):(B[Te]=Dt,B[lt]=ne,Te=lt);else if(bt<ge&&0>r(tr,ne))B[Te]=tr,B[bt]=ne,Te=bt;else break e}}return Z}function r(B,Z){var ne=B.sortIndex-Z.sortIndex;return ne!==0?ne:B.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],u=[],d=1,f=null,m=3,S=!1,y=!1,g=!1,E=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(B){for(var Z=n(u);Z!==null;){if(Z.callback===null)i(u);else if(Z.startTime<=B)i(u),Z.sortIndex=Z.expirationTime,e(c,Z);else break;Z=n(u)}}function C(B){if(g=!1,b(B),!y)if(n(c)!==null)y=!0,H(x);else{var Z=n(u);Z!==null&&re(C,Z.startTime-B)}}function x(B,Z){y=!1,g&&(g=!1,v(U),U=-1),S=!0;var ne=m;try{for(b(Z),f=n(c);f!==null&&(!(f.expirationTime>Z)||B&&!M());){var Te=f.callback;if(typeof Te=="function"){f.callback=null,m=f.priorityLevel;var ge=Te(f.expirationTime<=Z);Z=t.unstable_now(),typeof ge=="function"?f.callback=ge:f===n(c)&&i(c),b(Z)}else i(c);f=n(c)}if(f!==null)var qe=!0;else{var lt=n(u);lt!==null&&re(C,lt.startTime-Z),qe=!1}return qe}finally{f=null,m=ne,S=!1}}var A=!1,D=null,U=-1,V=5,R=-1;function M(){return!(t.unstable_now()-R<V)}function K(){if(D!==null){var B=t.unstable_now();R=B;var Z=!0;try{Z=D(!0,B)}finally{Z?Y():(A=!1,D=null)}}else A=!1}var Y;if(typeof T=="function")Y=function(){T(K)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,le=se.port2;se.port1.onmessage=K,Y=function(){le.postMessage(null)}}else Y=function(){E(K,0)};function H(B){D=B,A||(A=!0,Y())}function re(B,Z){U=E(function(){B(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(B){B.callback=null},t.unstable_continueExecution=function(){y||S||(y=!0,H(x))},t.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<B?Math.floor(1e3/B):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(B){switch(m){case 1:case 2:case 3:var Z=3;break;default:Z=m}var ne=m;m=Z;try{return B()}finally{m=ne}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(B,Z){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var ne=m;m=B;try{return Z()}finally{m=ne}},t.unstable_scheduleCallback=function(B,Z,ne){var Te=t.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?Te+ne:Te):ne=Te,B){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=ne+ge,B={id:d++,callback:Z,priorityLevel:B,startTime:ne,expirationTime:ge,sortIndex:-1},ne>Te?(B.sortIndex=ne,e(u,B),n(c)===null&&B===n(u)&&(g?(v(U),U=-1):g=!0,re(C,ne-Te))):(B.sortIndex=ge,e(c,B),y||S||(y=!0,H(x))),B},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(B){var Z=m;return function(){var ne=m;m=Z;try{return B.apply(this,arguments)}finally{m=ne}}}})(cg);ag.exports=cg;var bS=ag.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wS=Ce,jt=bS;function q(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lg=new Set,js={};function Xi(t,e){Lr(t,e),Lr(t+"Capture",e)}function Lr(t,e){for(js[t]=e,t=0;t<e.length;t++)lg.add(e[t])}var Gn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vl=Object.prototype.hasOwnProperty,ES=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,If={},xf={};function _S(t){return Vl.call(xf,t)?!0:Vl.call(If,t)?!1:ES.test(t)?xf[t]=!0:(If[t]=!0,!1)}function PS(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function RS(t,e,n,i){if(e===null||typeof e>"u"||PS(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Tt(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var ct={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ct[t]=new Tt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ct[e]=new Tt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ct[t]=new Tt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ct[t]=new Tt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ct[t]=new Tt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ct[t]=new Tt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ct[t]=new Tt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ct[t]=new Tt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ct[t]=new Tt(t,5,!1,t.toLowerCase(),null,!1,!1)});var hd=/[\-:]([a-z])/g;function fd(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(hd,fd);ct[e]=new Tt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(hd,fd);ct[e]=new Tt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(hd,fd);ct[e]=new Tt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ct[t]=new Tt(t,1,!1,t.toLowerCase(),null,!1,!1)});ct.xlinkHref=new Tt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ct[t]=new Tt(t,1,!1,t.toLowerCase(),null,!0,!0)});function pd(t,e,n,i){var r=ct.hasOwnProperty(e)?ct[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(RS(e,n,r,i)&&(n=null),i||r===null?_S(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Yn=wS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ro=Symbol.for("react.element"),ar=Symbol.for("react.portal"),cr=Symbol.for("react.fragment"),md=Symbol.for("react.strict_mode"),zl=Symbol.for("react.profiler"),ug=Symbol.for("react.provider"),dg=Symbol.for("react.context"),gd=Symbol.for("react.forward_ref"),Wl=Symbol.for("react.suspense"),ql=Symbol.for("react.suspense_list"),vd=Symbol.for("react.memo"),ii=Symbol.for("react.lazy"),hg=Symbol.for("react.offscreen"),Of=Symbol.iterator;function ss(t){return t===null||typeof t!="object"?null:(t=Of&&t[Of]||t["@@iterator"],typeof t=="function"?t:null)}var Le=Object.assign,Qc;function ks(t){if(Qc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Qc=e&&e[1]||""}return`
`+Qc+t}var Yc=!1;function Xc(t,e){if(!t||Yc)return"";Yc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){i=u}t.call(e.prototype)}else{try{throw Error()}catch(u){i=u}t()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{Yc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ks(t):""}function IS(t){switch(t.tag){case 5:return ks(t.type);case 16:return ks("Lazy");case 13:return ks("Suspense");case 19:return ks("SuspenseList");case 0:case 2:case 15:return t=Xc(t.type,!1),t;case 11:return t=Xc(t.type.render,!1),t;case 1:return t=Xc(t.type,!0),t;default:return""}}function Hl(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case cr:return"Fragment";case ar:return"Portal";case zl:return"Profiler";case md:return"StrictMode";case Wl:return"Suspense";case ql:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case dg:return(t.displayName||"Context")+".Consumer";case ug:return(t._context.displayName||"Context")+".Provider";case gd:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case vd:return e=t.displayName||null,e!==null?e:Hl(t.type)||"Memo";case ii:e=t._payload,t=t._init;try{return Hl(t(e))}catch{}}return null}function xS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hl(e);case 8:return e===md?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ci(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function fg(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function OS(t){var e=fg(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Io(t){t._valueTracker||(t._valueTracker=OS(t))}function pg(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=fg(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function ya(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Gl(t,e){var n=e.checked;return Le({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Mf(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Ci(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function mg(t,e){e=e.checked,e!=null&&pd(t,"checked",e,!1)}function Kl(t,e){mg(t,e);var n=Ci(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?$l(t,e.type,n):e.hasOwnProperty("defaultValue")&&$l(t,e.type,Ci(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Af(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function $l(t,e,n){(e!=="number"||ya(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ss=Array.isArray;function Cr(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Ci(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Jl(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(q(91));return Le({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Df(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(q(92));if(Ss(n)){if(1<n.length)throw Error(q(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ci(n)}}function gg(t,e){var n=Ci(e.value),i=Ci(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Nf(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function vg(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ql(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?vg(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var xo,yg=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(xo=xo||document.createElement("div"),xo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=xo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Bs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Es={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},MS=["Webkit","ms","Moz","O"];Object.keys(Es).forEach(function(t){MS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Es[e]=Es[t]})});function kg(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Es.hasOwnProperty(t)&&Es[t]?(""+e).trim():e+"px"}function Sg(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=kg(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var AS=Le({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yl(t,e){if(e){if(AS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(q(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(q(62))}}function Xl(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zl=null;function yd(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var eu=null,br=null,wr=null;function Lf(t){if(t=fo(t)){if(typeof eu!="function")throw Error(q(280));var e=t.stateNode;e&&(e=oc(e),eu(t.stateNode,t.type,e))}}function Tg(t){br?wr?wr.push(t):wr=[t]:br=t}function Cg(){if(br){var t=br,e=wr;if(wr=br=null,Lf(t),e)for(t=0;t<e.length;t++)Lf(e[t])}}function bg(t,e){return t(e)}function wg(){}var Zc=!1;function Eg(t,e,n){if(Zc)return t(e,n);Zc=!0;try{return bg(t,e,n)}finally{Zc=!1,(br!==null||wr!==null)&&(wg(),Cg())}}function Vs(t,e){var n=t.stateNode;if(n===null)return null;var i=oc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(q(231,e,typeof n));return n}var tu=!1;if(Gn)try{var os={};Object.defineProperty(os,"passive",{get:function(){tu=!0}}),window.addEventListener("test",os,os),window.removeEventListener("test",os,os)}catch{tu=!1}function DS(t,e,n,i,r,s,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var _s=!1,ka=null,Sa=!1,nu=null,NS={onError:function(t){_s=!0,ka=t}};function LS(t,e,n,i,r,s,o,a,c){_s=!1,ka=null,DS.apply(NS,arguments)}function US(t,e,n,i,r,s,o,a,c){if(LS.apply(this,arguments),_s){if(_s){var u=ka;_s=!1,ka=null}else throw Error(q(198));Sa||(Sa=!0,nu=u)}}function Zi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function _g(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Uf(t){if(Zi(t)!==t)throw Error(q(188))}function FS(t){var e=t.alternate;if(!e){if(e=Zi(t),e===null)throw Error(q(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Uf(r),t;if(s===i)return Uf(r),e;s=s.sibling}throw Error(q(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(q(189))}}if(n.alternate!==i)throw Error(q(190))}if(n.tag!==3)throw Error(q(188));return n.stateNode.current===n?t:e}function Pg(t){return t=FS(t),t!==null?Rg(t):null}function Rg(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Rg(t);if(e!==null)return e;t=t.sibling}return null}var Ig=jt.unstable_scheduleCallback,Ff=jt.unstable_cancelCallback,jS=jt.unstable_shouldYield,BS=jt.unstable_requestPaint,ze=jt.unstable_now,VS=jt.unstable_getCurrentPriorityLevel,kd=jt.unstable_ImmediatePriority,xg=jt.unstable_UserBlockingPriority,Ta=jt.unstable_NormalPriority,zS=jt.unstable_LowPriority,Og=jt.unstable_IdlePriority,nc=null,En=null;function WS(t){if(En&&typeof En.onCommitFiberRoot=="function")try{En.onCommitFiberRoot(nc,t,void 0,(t.current.flags&128)===128)}catch{}}var dn=Math.clz32?Math.clz32:GS,qS=Math.log,HS=Math.LN2;function GS(t){return t>>>=0,t===0?32:31-(qS(t)/HS|0)|0}var Oo=64,Mo=4194304;function Ts(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ca(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Ts(a):(s&=o,s!==0&&(i=Ts(s)))}else o=n&~r,o!==0?i=Ts(o):s!==0&&(i=Ts(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-dn(e),r=1<<n,i|=t[n],e&=~r;return i}function KS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $S(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-dn(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=KS(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function iu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Mg(){var t=Oo;return Oo<<=1,!(Oo&4194240)&&(Oo=64),t}function el(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function uo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-dn(e),t[e]=n}function JS(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-dn(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Sd(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-dn(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var be=0;function Ag(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Dg,Td,Ng,Lg,Ug,ru=!1,Ao=[],di=null,hi=null,fi=null,zs=new Map,Ws=new Map,si=[],QS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jf(t,e){switch(t){case"focusin":case"focusout":di=null;break;case"dragenter":case"dragleave":hi=null;break;case"mouseover":case"mouseout":fi=null;break;case"pointerover":case"pointerout":zs.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ws.delete(e.pointerId)}}function as(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=fo(e),e!==null&&Td(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function YS(t,e,n,i,r){switch(e){case"focusin":return di=as(di,t,e,n,i,r),!0;case"dragenter":return hi=as(hi,t,e,n,i,r),!0;case"mouseover":return fi=as(fi,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return zs.set(s,as(zs.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Ws.set(s,as(Ws.get(s)||null,t,e,n,i,r)),!0}return!1}function Fg(t){var e=ji(t.target);if(e!==null){var n=Zi(e);if(n!==null){if(e=n.tag,e===13){if(e=_g(n),e!==null){t.blockedOn=e,Ug(t.priority,function(){Ng(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Jo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=su(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Zl=i,n.target.dispatchEvent(i),Zl=null}else return e=fo(n),e!==null&&Td(e),t.blockedOn=n,!1;e.shift()}return!0}function Bf(t,e,n){Jo(t)&&n.delete(e)}function XS(){ru=!1,di!==null&&Jo(di)&&(di=null),hi!==null&&Jo(hi)&&(hi=null),fi!==null&&Jo(fi)&&(fi=null),zs.forEach(Bf),Ws.forEach(Bf)}function cs(t,e){t.blockedOn===e&&(t.blockedOn=null,ru||(ru=!0,jt.unstable_scheduleCallback(jt.unstable_NormalPriority,XS)))}function qs(t){function e(r){return cs(r,t)}if(0<Ao.length){cs(Ao[0],t);for(var n=1;n<Ao.length;n++){var i=Ao[n];i.blockedOn===t&&(i.blockedOn=null)}}for(di!==null&&cs(di,t),hi!==null&&cs(hi,t),fi!==null&&cs(fi,t),zs.forEach(e),Ws.forEach(e),n=0;n<si.length;n++)i=si[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<si.length&&(n=si[0],n.blockedOn===null);)Fg(n),n.blockedOn===null&&si.shift()}var Er=Yn.ReactCurrentBatchConfig,ba=!0;function ZS(t,e,n,i){var r=be,s=Er.transition;Er.transition=null;try{be=1,Cd(t,e,n,i)}finally{be=r,Er.transition=s}}function eT(t,e,n,i){var r=be,s=Er.transition;Er.transition=null;try{be=4,Cd(t,e,n,i)}finally{be=r,Er.transition=s}}function Cd(t,e,n,i){if(ba){var r=su(t,e,n,i);if(r===null)ul(t,e,i,wa,n),jf(t,i);else if(YS(r,t,e,n,i))i.stopPropagation();else if(jf(t,i),e&4&&-1<QS.indexOf(t)){for(;r!==null;){var s=fo(r);if(s!==null&&Dg(s),s=su(t,e,n,i),s===null&&ul(t,e,i,wa,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else ul(t,e,i,null,n)}}var wa=null;function su(t,e,n,i){if(wa=null,t=yd(i),t=ji(t),t!==null)if(e=Zi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=_g(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return wa=t,null}function jg(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(VS()){case kd:return 1;case xg:return 4;case Ta:case zS:return 16;case Og:return 536870912;default:return 16}default:return 16}}var ci=null,bd=null,Qo=null;function Bg(){if(Qo)return Qo;var t,e=bd,n=e.length,i,r="value"in ci?ci.value:ci.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Qo=r.slice(t,1<i?1-i:void 0)}function Yo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Do(){return!0}function Vf(){return!1}function Vt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Do:Vf,this.isPropagationStopped=Vf,this}return Le(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),e}var Kr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wd=Vt(Kr),ho=Le({},Kr,{view:0,detail:0}),tT=Vt(ho),tl,nl,ls,ic=Le({},ho,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ed,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ls&&(ls&&t.type==="mousemove"?(tl=t.screenX-ls.screenX,nl=t.screenY-ls.screenY):nl=tl=0,ls=t),tl)},movementY:function(t){return"movementY"in t?t.movementY:nl}}),zf=Vt(ic),nT=Le({},ic,{dataTransfer:0}),iT=Vt(nT),rT=Le({},ho,{relatedTarget:0}),il=Vt(rT),sT=Le({},Kr,{animationName:0,elapsedTime:0,pseudoElement:0}),oT=Vt(sT),aT=Le({},Kr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),cT=Vt(aT),lT=Le({},Kr,{data:0}),Wf=Vt(lT),uT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fT(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=hT[t])?!!e[t]:!1}function Ed(){return fT}var pT=Le({},ho,{key:function(t){if(t.key){var e=uT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Yo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?dT[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ed,charCode:function(t){return t.type==="keypress"?Yo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Yo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),mT=Vt(pT),gT=Le({},ic,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qf=Vt(gT),vT=Le({},ho,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ed}),yT=Vt(vT),kT=Le({},Kr,{propertyName:0,elapsedTime:0,pseudoElement:0}),ST=Vt(kT),TT=Le({},ic,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),CT=Vt(TT),bT=[9,13,27,32],_d=Gn&&"CompositionEvent"in window,Ps=null;Gn&&"documentMode"in document&&(Ps=document.documentMode);var wT=Gn&&"TextEvent"in window&&!Ps,Vg=Gn&&(!_d||Ps&&8<Ps&&11>=Ps),Hf=" ",Gf=!1;function zg(t,e){switch(t){case"keyup":return bT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wg(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var lr=!1;function ET(t,e){switch(t){case"compositionend":return Wg(e);case"keypress":return e.which!==32?null:(Gf=!0,Hf);case"textInput":return t=e.data,t===Hf&&Gf?null:t;default:return null}}function _T(t,e){if(lr)return t==="compositionend"||!_d&&zg(t,e)?(t=Bg(),Qo=bd=ci=null,lr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Vg&&e.locale!=="ko"?null:e.data;default:return null}}var PT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!PT[t.type]:e==="textarea"}function qg(t,e,n,i){Tg(i),e=Ea(e,"onChange"),0<e.length&&(n=new wd("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Rs=null,Hs=null;function RT(t){tv(t,0)}function rc(t){var e=hr(t);if(pg(e))return t}function IT(t,e){if(t==="change")return e}var Hg=!1;if(Gn){var rl;if(Gn){var sl="oninput"in document;if(!sl){var $f=document.createElement("div");$f.setAttribute("oninput","return;"),sl=typeof $f.oninput=="function"}rl=sl}else rl=!1;Hg=rl&&(!document.documentMode||9<document.documentMode)}function Jf(){Rs&&(Rs.detachEvent("onpropertychange",Gg),Hs=Rs=null)}function Gg(t){if(t.propertyName==="value"&&rc(Hs)){var e=[];qg(e,Hs,t,yd(t)),Eg(RT,e)}}function xT(t,e,n){t==="focusin"?(Jf(),Rs=e,Hs=n,Rs.attachEvent("onpropertychange",Gg)):t==="focusout"&&Jf()}function OT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return rc(Hs)}function MT(t,e){if(t==="click")return rc(e)}function AT(t,e){if(t==="input"||t==="change")return rc(e)}function DT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var fn=typeof Object.is=="function"?Object.is:DT;function Gs(t,e){if(fn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Vl.call(e,r)||!fn(t[r],e[r]))return!1}return!0}function Qf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Yf(t,e){var n=Qf(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Qf(n)}}function Kg(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Kg(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function $g(){for(var t=window,e=ya();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ya(t.document)}return e}function Pd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function NT(t){var e=$g(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Kg(n.ownerDocument.documentElement,n)){if(i!==null&&Pd(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Yf(n,s);var o=Yf(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var LT=Gn&&"documentMode"in document&&11>=document.documentMode,ur=null,ou=null,Is=null,au=!1;function Xf(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;au||ur==null||ur!==ya(i)||(i=ur,"selectionStart"in i&&Pd(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Is&&Gs(Is,i)||(Is=i,i=Ea(ou,"onSelect"),0<i.length&&(e=new wd("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=ur)))}function No(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var dr={animationend:No("Animation","AnimationEnd"),animationiteration:No("Animation","AnimationIteration"),animationstart:No("Animation","AnimationStart"),transitionend:No("Transition","TransitionEnd")},ol={},Jg={};Gn&&(Jg=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition);function sc(t){if(ol[t])return ol[t];if(!dr[t])return t;var e=dr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Jg)return ol[t]=e[n];return t}var Qg=sc("animationend"),Yg=sc("animationiteration"),Xg=sc("animationstart"),Zg=sc("transitionend"),ev=new Map,Zf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _i(t,e){ev.set(t,e),Xi(e,[t])}for(var al=0;al<Zf.length;al++){var cl=Zf[al],UT=cl.toLowerCase(),FT=cl[0].toUpperCase()+cl.slice(1);_i(UT,"on"+FT)}_i(Qg,"onAnimationEnd");_i(Yg,"onAnimationIteration");_i(Xg,"onAnimationStart");_i("dblclick","onDoubleClick");_i("focusin","onFocus");_i("focusout","onBlur");_i(Zg,"onTransitionEnd");Lr("onMouseEnter",["mouseout","mouseover"]);Lr("onMouseLeave",["mouseout","mouseover"]);Lr("onPointerEnter",["pointerout","pointerover"]);Lr("onPointerLeave",["pointerout","pointerover"]);Xi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cs));function ep(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,US(i,e,void 0,t),t.currentTarget=null}function tv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;ep(r,a,u),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;ep(r,a,u),s=c}}}if(Sa)throw t=nu,Sa=!1,nu=null,t}function Ie(t,e){var n=e[hu];n===void 0&&(n=e[hu]=new Set);var i=t+"__bubble";n.has(i)||(nv(e,t,2,!1),n.add(i))}function ll(t,e,n){var i=0;e&&(i|=4),nv(n,t,i,e)}var Lo="_reactListening"+Math.random().toString(36).slice(2);function Ks(t){if(!t[Lo]){t[Lo]=!0,lg.forEach(function(n){n!=="selectionchange"&&(jT.has(n)||ll(n,!1,t),ll(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Lo]||(e[Lo]=!0,ll("selectionchange",!1,e))}}function nv(t,e,n,i){switch(jg(e)){case 1:var r=ZS;break;case 4:r=eT;break;default:r=Cd}n=r.bind(null,e,n,t),r=void 0,!tu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function ul(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=ji(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Eg(function(){var u=s,d=yd(n),f=[];e:{var m=ev.get(t);if(m!==void 0){var S=wd,y=t;switch(t){case"keypress":if(Yo(n)===0)break e;case"keydown":case"keyup":S=mT;break;case"focusin":y="focus",S=il;break;case"focusout":y="blur",S=il;break;case"beforeblur":case"afterblur":S=il;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=zf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=iT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=yT;break;case Qg:case Yg:case Xg:S=oT;break;case Zg:S=ST;break;case"scroll":S=tT;break;case"wheel":S=CT;break;case"copy":case"cut":case"paste":S=cT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=qf}var g=(e&4)!==0,E=!g&&t==="scroll",v=g?m!==null?m+"Capture":null:m;g=[];for(var T=u,b;T!==null;){b=T;var C=b.stateNode;if(b.tag===5&&C!==null&&(b=C,v!==null&&(C=Vs(T,v),C!=null&&g.push($s(T,C,b)))),E)break;T=T.return}0<g.length&&(m=new S(m,y,null,n,d),f.push({event:m,listeners:g}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",S=t==="mouseout"||t==="pointerout",m&&n!==Zl&&(y=n.relatedTarget||n.fromElement)&&(ji(y)||y[Kn]))break e;if((S||m)&&(m=d.window===d?d:(m=d.ownerDocument)?m.defaultView||m.parentWindow:window,S?(y=n.relatedTarget||n.toElement,S=u,y=y?ji(y):null,y!==null&&(E=Zi(y),y!==E||y.tag!==5&&y.tag!==6)&&(y=null)):(S=null,y=u),S!==y)){if(g=zf,C="onMouseLeave",v="onMouseEnter",T="mouse",(t==="pointerout"||t==="pointerover")&&(g=qf,C="onPointerLeave",v="onPointerEnter",T="pointer"),E=S==null?m:hr(S),b=y==null?m:hr(y),m=new g(C,T+"leave",S,n,d),m.target=E,m.relatedTarget=b,C=null,ji(d)===u&&(g=new g(v,T+"enter",y,n,d),g.target=b,g.relatedTarget=E,C=g),E=C,S&&y)t:{for(g=S,v=y,T=0,b=g;b;b=rr(b))T++;for(b=0,C=v;C;C=rr(C))b++;for(;0<T-b;)g=rr(g),T--;for(;0<b-T;)v=rr(v),b--;for(;T--;){if(g===v||v!==null&&g===v.alternate)break t;g=rr(g),v=rr(v)}g=null}else g=null;S!==null&&tp(f,m,S,g,!1),y!==null&&E!==null&&tp(f,E,y,g,!0)}}e:{if(m=u?hr(u):window,S=m.nodeName&&m.nodeName.toLowerCase(),S==="select"||S==="input"&&m.type==="file")var x=IT;else if(Kf(m))if(Hg)x=AT;else{x=OT;var A=xT}else(S=m.nodeName)&&S.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(x=MT);if(x&&(x=x(t,u))){qg(f,x,n,d);break e}A&&A(t,m,u),t==="focusout"&&(A=m._wrapperState)&&A.controlled&&m.type==="number"&&$l(m,"number",m.value)}switch(A=u?hr(u):window,t){case"focusin":(Kf(A)||A.contentEditable==="true")&&(ur=A,ou=u,Is=null);break;case"focusout":Is=ou=ur=null;break;case"mousedown":au=!0;break;case"contextmenu":case"mouseup":case"dragend":au=!1,Xf(f,n,d);break;case"selectionchange":if(LT)break;case"keydown":case"keyup":Xf(f,n,d)}var D;if(_d)e:{switch(t){case"compositionstart":var U="onCompositionStart";break e;case"compositionend":U="onCompositionEnd";break e;case"compositionupdate":U="onCompositionUpdate";break e}U=void 0}else lr?zg(t,n)&&(U="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(U="onCompositionStart");U&&(Vg&&n.locale!=="ko"&&(lr||U!=="onCompositionStart"?U==="onCompositionEnd"&&lr&&(D=Bg()):(ci=d,bd="value"in ci?ci.value:ci.textContent,lr=!0)),A=Ea(u,U),0<A.length&&(U=new Wf(U,t,null,n,d),f.push({event:U,listeners:A}),D?U.data=D:(D=Wg(n),D!==null&&(U.data=D)))),(D=wT?ET(t,n):_T(t,n))&&(u=Ea(u,"onBeforeInput"),0<u.length&&(d=new Wf("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:u}),d.data=D))}tv(f,e)})}function $s(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ea(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Vs(t,n),s!=null&&i.unshift($s(t,s,r)),s=Vs(t,e),s!=null&&i.push($s(t,s,r))),t=t.return}return i}function rr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function tp(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,u=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&u!==null&&(a=u,r?(c=Vs(n,s),c!=null&&o.unshift($s(n,c,a))):r||(c=Vs(n,s),c!=null&&o.push($s(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var BT=/\r\n?/g,VT=/\u0000|\uFFFD/g;function np(t){return(typeof t=="string"?t:""+t).replace(BT,`
`).replace(VT,"")}function Uo(t,e,n){if(e=np(e),np(t)!==e&&n)throw Error(q(425))}function _a(){}var cu=null,lu=null;function uu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var du=typeof setTimeout=="function"?setTimeout:void 0,zT=typeof clearTimeout=="function"?clearTimeout:void 0,ip=typeof Promise=="function"?Promise:void 0,WT=typeof queueMicrotask=="function"?queueMicrotask:typeof ip<"u"?function(t){return ip.resolve(null).then(t).catch(qT)}:du;function qT(t){setTimeout(function(){throw t})}function dl(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),qs(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);qs(e)}function pi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function rp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var $r=Math.random().toString(36).slice(2),bn="__reactFiber$"+$r,Js="__reactProps$"+$r,Kn="__reactContainer$"+$r,hu="__reactEvents$"+$r,HT="__reactListeners$"+$r,GT="__reactHandles$"+$r;function ji(t){var e=t[bn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Kn]||n[bn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=rp(t);t!==null;){if(n=t[bn])return n;t=rp(t)}return e}t=n,n=t.parentNode}return null}function fo(t){return t=t[bn]||t[Kn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function hr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(q(33))}function oc(t){return t[Js]||null}var fu=[],fr=-1;function Pi(t){return{current:t}}function Oe(t){0>fr||(t.current=fu[fr],fu[fr]=null,fr--)}function Pe(t,e){fr++,fu[fr]=t.current,t.current=e}var bi={},ft=Pi(bi),xt=Pi(!1),qi=bi;function Ur(t,e){var n=t.type.contextTypes;if(!n)return bi;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Ot(t){return t=t.childContextTypes,t!=null}function Pa(){Oe(xt),Oe(ft)}function sp(t,e,n){if(ft.current!==bi)throw Error(q(168));Pe(ft,e),Pe(xt,n)}function iv(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(q(108,xS(t)||"Unknown",r));return Le({},n,i)}function Ra(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||bi,qi=ft.current,Pe(ft,t),Pe(xt,xt.current),!0}function op(t,e,n){var i=t.stateNode;if(!i)throw Error(q(169));n?(t=iv(t,e,qi),i.__reactInternalMemoizedMergedChildContext=t,Oe(xt),Oe(ft),Pe(ft,t)):Oe(xt),Pe(xt,n)}var Nn=null,ac=!1,hl=!1;function rv(t){Nn===null?Nn=[t]:Nn.push(t)}function KT(t){ac=!0,rv(t)}function Ri(){if(!hl&&Nn!==null){hl=!0;var t=0,e=be;try{var n=Nn;for(be=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Nn=null,ac=!1}catch(r){throw Nn!==null&&(Nn=Nn.slice(t+1)),Ig(kd,Ri),r}finally{be=e,hl=!1}}return null}var pr=[],mr=0,Ia=null,xa=0,Ht=[],Gt=0,Hi=null,zn=1,Wn="";function Ni(t,e){pr[mr++]=xa,pr[mr++]=Ia,Ia=t,xa=e}function sv(t,e,n){Ht[Gt++]=zn,Ht[Gt++]=Wn,Ht[Gt++]=Hi,Hi=t;var i=zn;t=Wn;var r=32-dn(i)-1;i&=~(1<<r),n+=1;var s=32-dn(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,zn=1<<32-dn(e)+r|n<<r|i,Wn=s+t}else zn=1<<s|n<<r|i,Wn=t}function Rd(t){t.return!==null&&(Ni(t,1),sv(t,1,0))}function Id(t){for(;t===Ia;)Ia=pr[--mr],pr[mr]=null,xa=pr[--mr],pr[mr]=null;for(;t===Hi;)Hi=Ht[--Gt],Ht[Gt]=null,Wn=Ht[--Gt],Ht[Gt]=null,zn=Ht[--Gt],Ht[Gt]=null}var Ft=null,Lt=null,Me=!1,on=null;function ov(t,e){var n=Kt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function ap(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Ft=t,Lt=pi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Ft=t,Lt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Hi!==null?{id:zn,overflow:Wn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Kt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Ft=t,Lt=null,!0):!1;default:return!1}}function pu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function mu(t){if(Me){var e=Lt;if(e){var n=e;if(!ap(t,e)){if(pu(t))throw Error(q(418));e=pi(n.nextSibling);var i=Ft;e&&ap(t,e)?ov(i,n):(t.flags=t.flags&-4097|2,Me=!1,Ft=t)}}else{if(pu(t))throw Error(q(418));t.flags=t.flags&-4097|2,Me=!1,Ft=t}}}function cp(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ft=t}function Fo(t){if(t!==Ft)return!1;if(!Me)return cp(t),Me=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!uu(t.type,t.memoizedProps)),e&&(e=Lt)){if(pu(t))throw av(),Error(q(418));for(;e;)ov(t,e),e=pi(e.nextSibling)}if(cp(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(q(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Lt=pi(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Lt=null}}else Lt=Ft?pi(t.stateNode.nextSibling):null;return!0}function av(){for(var t=Lt;t;)t=pi(t.nextSibling)}function Fr(){Lt=Ft=null,Me=!1}function xd(t){on===null?on=[t]:on.push(t)}var $T=Yn.ReactCurrentBatchConfig;function us(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(q(309));var i=n.stateNode}if(!i)throw Error(q(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(q(284));if(!n._owner)throw Error(q(290,t))}return t}function jo(t,e){throw t=Object.prototype.toString.call(e),Error(q(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function lp(t){var e=t._init;return e(t._payload)}function cv(t){function e(v,T){if(t){var b=v.deletions;b===null?(v.deletions=[T],v.flags|=16):b.push(T)}}function n(v,T){if(!t)return null;for(;T!==null;)e(v,T),T=T.sibling;return null}function i(v,T){for(v=new Map;T!==null;)T.key!==null?v.set(T.key,T):v.set(T.index,T),T=T.sibling;return v}function r(v,T){return v=yi(v,T),v.index=0,v.sibling=null,v}function s(v,T,b){return v.index=b,t?(b=v.alternate,b!==null?(b=b.index,b<T?(v.flags|=2,T):b):(v.flags|=2,T)):(v.flags|=1048576,T)}function o(v){return t&&v.alternate===null&&(v.flags|=2),v}function a(v,T,b,C){return T===null||T.tag!==6?(T=kl(b,v.mode,C),T.return=v,T):(T=r(T,b),T.return=v,T)}function c(v,T,b,C){var x=b.type;return x===cr?d(v,T,b.props.children,C,b.key):T!==null&&(T.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===ii&&lp(x)===T.type)?(C=r(T,b.props),C.ref=us(v,T,b),C.return=v,C):(C=ra(b.type,b.key,b.props,null,v.mode,C),C.ref=us(v,T,b),C.return=v,C)}function u(v,T,b,C){return T===null||T.tag!==4||T.stateNode.containerInfo!==b.containerInfo||T.stateNode.implementation!==b.implementation?(T=Sl(b,v.mode,C),T.return=v,T):(T=r(T,b.children||[]),T.return=v,T)}function d(v,T,b,C,x){return T===null||T.tag!==7?(T=Wi(b,v.mode,C,x),T.return=v,T):(T=r(T,b),T.return=v,T)}function f(v,T,b){if(typeof T=="string"&&T!==""||typeof T=="number")return T=kl(""+T,v.mode,b),T.return=v,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Ro:return b=ra(T.type,T.key,T.props,null,v.mode,b),b.ref=us(v,null,T),b.return=v,b;case ar:return T=Sl(T,v.mode,b),T.return=v,T;case ii:var C=T._init;return f(v,C(T._payload),b)}if(Ss(T)||ss(T))return T=Wi(T,v.mode,b,null),T.return=v,T;jo(v,T)}return null}function m(v,T,b,C){var x=T!==null?T.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return x!==null?null:a(v,T,""+b,C);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ro:return b.key===x?c(v,T,b,C):null;case ar:return b.key===x?u(v,T,b,C):null;case ii:return x=b._init,m(v,T,x(b._payload),C)}if(Ss(b)||ss(b))return x!==null?null:d(v,T,b,C,null);jo(v,b)}return null}function S(v,T,b,C,x){if(typeof C=="string"&&C!==""||typeof C=="number")return v=v.get(b)||null,a(T,v,""+C,x);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Ro:return v=v.get(C.key===null?b:C.key)||null,c(T,v,C,x);case ar:return v=v.get(C.key===null?b:C.key)||null,u(T,v,C,x);case ii:var A=C._init;return S(v,T,b,A(C._payload),x)}if(Ss(C)||ss(C))return v=v.get(b)||null,d(T,v,C,x,null);jo(T,C)}return null}function y(v,T,b,C){for(var x=null,A=null,D=T,U=T=0,V=null;D!==null&&U<b.length;U++){D.index>U?(V=D,D=null):V=D.sibling;var R=m(v,D,b[U],C);if(R===null){D===null&&(D=V);break}t&&D&&R.alternate===null&&e(v,D),T=s(R,T,U),A===null?x=R:A.sibling=R,A=R,D=V}if(U===b.length)return n(v,D),Me&&Ni(v,U),x;if(D===null){for(;U<b.length;U++)D=f(v,b[U],C),D!==null&&(T=s(D,T,U),A===null?x=D:A.sibling=D,A=D);return Me&&Ni(v,U),x}for(D=i(v,D);U<b.length;U++)V=S(D,v,U,b[U],C),V!==null&&(t&&V.alternate!==null&&D.delete(V.key===null?U:V.key),T=s(V,T,U),A===null?x=V:A.sibling=V,A=V);return t&&D.forEach(function(M){return e(v,M)}),Me&&Ni(v,U),x}function g(v,T,b,C){var x=ss(b);if(typeof x!="function")throw Error(q(150));if(b=x.call(b),b==null)throw Error(q(151));for(var A=x=null,D=T,U=T=0,V=null,R=b.next();D!==null&&!R.done;U++,R=b.next()){D.index>U?(V=D,D=null):V=D.sibling;var M=m(v,D,R.value,C);if(M===null){D===null&&(D=V);break}t&&D&&M.alternate===null&&e(v,D),T=s(M,T,U),A===null?x=M:A.sibling=M,A=M,D=V}if(R.done)return n(v,D),Me&&Ni(v,U),x;if(D===null){for(;!R.done;U++,R=b.next())R=f(v,R.value,C),R!==null&&(T=s(R,T,U),A===null?x=R:A.sibling=R,A=R);return Me&&Ni(v,U),x}for(D=i(v,D);!R.done;U++,R=b.next())R=S(D,v,U,R.value,C),R!==null&&(t&&R.alternate!==null&&D.delete(R.key===null?U:R.key),T=s(R,T,U),A===null?x=R:A.sibling=R,A=R);return t&&D.forEach(function(K){return e(v,K)}),Me&&Ni(v,U),x}function E(v,T,b,C){if(typeof b=="object"&&b!==null&&b.type===cr&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Ro:e:{for(var x=b.key,A=T;A!==null;){if(A.key===x){if(x=b.type,x===cr){if(A.tag===7){n(v,A.sibling),T=r(A,b.props.children),T.return=v,v=T;break e}}else if(A.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===ii&&lp(x)===A.type){n(v,A.sibling),T=r(A,b.props),T.ref=us(v,A,b),T.return=v,v=T;break e}n(v,A);break}else e(v,A);A=A.sibling}b.type===cr?(T=Wi(b.props.children,v.mode,C,b.key),T.return=v,v=T):(C=ra(b.type,b.key,b.props,null,v.mode,C),C.ref=us(v,T,b),C.return=v,v=C)}return o(v);case ar:e:{for(A=b.key;T!==null;){if(T.key===A)if(T.tag===4&&T.stateNode.containerInfo===b.containerInfo&&T.stateNode.implementation===b.implementation){n(v,T.sibling),T=r(T,b.children||[]),T.return=v,v=T;break e}else{n(v,T);break}else e(v,T);T=T.sibling}T=Sl(b,v.mode,C),T.return=v,v=T}return o(v);case ii:return A=b._init,E(v,T,A(b._payload),C)}if(Ss(b))return y(v,T,b,C);if(ss(b))return g(v,T,b,C);jo(v,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,T!==null&&T.tag===6?(n(v,T.sibling),T=r(T,b),T.return=v,v=T):(n(v,T),T=kl(b,v.mode,C),T.return=v,v=T),o(v)):n(v,T)}return E}var jr=cv(!0),lv=cv(!1),Oa=Pi(null),Ma=null,gr=null,Od=null;function Md(){Od=gr=Ma=null}function Ad(t){var e=Oa.current;Oe(Oa),t._currentValue=e}function gu(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function _r(t,e){Ma=t,Od=gr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Rt=!0),t.firstContext=null)}function Qt(t){var e=t._currentValue;if(Od!==t)if(t={context:t,memoizedValue:e,next:null},gr===null){if(Ma===null)throw Error(q(308));gr=t,Ma.dependencies={lanes:0,firstContext:t}}else gr=gr.next=t;return e}var Bi=null;function Dd(t){Bi===null?Bi=[t]:Bi.push(t)}function uv(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Dd(e)):(n.next=r.next,r.next=n),e.interleaved=n,$n(t,i)}function $n(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ri=!1;function Nd(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Hn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function mi(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,ye&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,$n(t,n)}return r=i.interleaved,r===null?(e.next=e,Dd(i)):(e.next=r.next,r.next=e),i.interleaved=e,$n(t,n)}function Xo(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Sd(t,n)}}function up(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Aa(t,e,n,i){var r=t.updateQueue;ri=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?s=u:o.next=u,o=c;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=c))}if(s!==null){var f=r.baseState;o=0,d=u=c=null,a=s;do{var m=a.lane,S=a.eventTime;if((i&m)===m){d!==null&&(d=d.next={eventTime:S,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,g=a;switch(m=e,S=n,g.tag){case 1:if(y=g.payload,typeof y=="function"){f=y.call(S,f,m);break e}f=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=g.payload,m=typeof y=="function"?y.call(S,f,m):y,m==null)break e;f=Le({},f,m);break e;case 2:ri=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,m=r.effects,m===null?r.effects=[a]:m.push(a))}else S={eventTime:S,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=S,c=f):d=d.next=S,o|=m;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;m=a,a=m.next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}while(!0);if(d===null&&(c=f),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=d,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Ki|=o,t.lanes=o,t.memoizedState=f}}function dp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(q(191,r));r.call(i)}}}var po={},_n=Pi(po),Qs=Pi(po),Ys=Pi(po);function Vi(t){if(t===po)throw Error(q(174));return t}function Ld(t,e){switch(Pe(Ys,e),Pe(Qs,t),Pe(_n,po),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ql(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ql(e,t)}Oe(_n),Pe(_n,e)}function Br(){Oe(_n),Oe(Qs),Oe(Ys)}function hv(t){Vi(Ys.current);var e=Vi(_n.current),n=Ql(e,t.type);e!==n&&(Pe(Qs,t),Pe(_n,n))}function Ud(t){Qs.current===t&&(Oe(_n),Oe(Qs))}var De=Pi(0);function Da(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var fl=[];function Fd(){for(var t=0;t<fl.length;t++)fl[t]._workInProgressVersionPrimary=null;fl.length=0}var Zo=Yn.ReactCurrentDispatcher,pl=Yn.ReactCurrentBatchConfig,Gi=0,Ne=null,Je=null,Xe=null,Na=!1,xs=!1,Xs=0,JT=0;function ut(){throw Error(q(321))}function jd(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!fn(t[n],e[n]))return!1;return!0}function Bd(t,e,n,i,r,s){if(Gi=s,Ne=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Zo.current=t===null||t.memoizedState===null?ZT:eC,t=n(i,r),xs){s=0;do{if(xs=!1,Xs=0,25<=s)throw Error(q(301));s+=1,Xe=Je=null,e.updateQueue=null,Zo.current=tC,t=n(i,r)}while(xs)}if(Zo.current=La,e=Je!==null&&Je.next!==null,Gi=0,Xe=Je=Ne=null,Na=!1,e)throw Error(q(300));return t}function Vd(){var t=Xs!==0;return Xs=0,t}function Tn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xe===null?Ne.memoizedState=Xe=t:Xe=Xe.next=t,Xe}function Yt(){if(Je===null){var t=Ne.alternate;t=t!==null?t.memoizedState:null}else t=Je.next;var e=Xe===null?Ne.memoizedState:Xe.next;if(e!==null)Xe=e,Je=t;else{if(t===null)throw Error(q(310));Je=t,t={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},Xe===null?Ne.memoizedState=Xe=t:Xe=Xe.next=t}return Xe}function Zs(t,e){return typeof e=="function"?e(t):e}function ml(t){var e=Yt(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var i=Je,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,u=s;do{var d=u.lane;if((Gi&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=f,o=i):c=c.next=f,Ne.lanes|=d,Ki|=d}u=u.next}while(u!==null&&u!==s);c===null?o=i:c.next=a,fn(i,e.memoizedState)||(Rt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Ne.lanes|=s,Ki|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function gl(t){var e=Yt(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);fn(s,e.memoizedState)||(Rt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function fv(){}function pv(t,e){var n=Ne,i=Yt(),r=e(),s=!fn(i.memoizedState,r);if(s&&(i.memoizedState=r,Rt=!0),i=i.queue,zd(vv.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Xe!==null&&Xe.memoizedState.tag&1){if(n.flags|=2048,eo(9,gv.bind(null,n,i,r,e),void 0,null),tt===null)throw Error(q(349));Gi&30||mv(n,e,r)}return r}function mv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ne.updateQueue,e===null?(e={lastEffect:null,stores:null},Ne.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function gv(t,e,n,i){e.value=n,e.getSnapshot=i,yv(e)&&kv(t)}function vv(t,e,n){return n(function(){yv(e)&&kv(t)})}function yv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!fn(t,n)}catch{return!0}}function kv(t){var e=$n(t,1);e!==null&&hn(e,t,1,-1)}function hp(t){var e=Tn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:t},e.queue=t,t=t.dispatch=XT.bind(null,Ne,t),[e.memoizedState,t]}function eo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Ne.updateQueue,e===null?(e={lastEffect:null,stores:null},Ne.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Sv(){return Yt().memoizedState}function ea(t,e,n,i){var r=Tn();Ne.flags|=t,r.memoizedState=eo(1|e,n,void 0,i===void 0?null:i)}function cc(t,e,n,i){var r=Yt();i=i===void 0?null:i;var s=void 0;if(Je!==null){var o=Je.memoizedState;if(s=o.destroy,i!==null&&jd(i,o.deps)){r.memoizedState=eo(e,n,s,i);return}}Ne.flags|=t,r.memoizedState=eo(1|e,n,s,i)}function fp(t,e){return ea(8390656,8,t,e)}function zd(t,e){return cc(2048,8,t,e)}function Tv(t,e){return cc(4,2,t,e)}function Cv(t,e){return cc(4,4,t,e)}function bv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function wv(t,e,n){return n=n!=null?n.concat([t]):null,cc(4,4,bv.bind(null,e,t),n)}function Wd(){}function Ev(t,e){var n=Yt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&jd(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function _v(t,e){var n=Yt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&jd(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Pv(t,e,n){return Gi&21?(fn(n,e)||(n=Mg(),Ne.lanes|=n,Ki|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Rt=!0),t.memoizedState=n)}function QT(t,e){var n=be;be=n!==0&&4>n?n:4,t(!0);var i=pl.transition;pl.transition={};try{t(!1),e()}finally{be=n,pl.transition=i}}function Rv(){return Yt().memoizedState}function YT(t,e,n){var i=vi(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Iv(t))xv(e,n);else if(n=uv(t,e,n,i),n!==null){var r=yt();hn(n,t,i,r),Ov(n,e,i)}}function XT(t,e,n){var i=vi(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Iv(t))xv(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,fn(a,o)){var c=e.interleaved;c===null?(r.next=r,Dd(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=uv(t,e,r,i),n!==null&&(r=yt(),hn(n,t,i,r),Ov(n,e,i))}}function Iv(t){var e=t.alternate;return t===Ne||e!==null&&e===Ne}function xv(t,e){xs=Na=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Ov(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Sd(t,n)}}var La={readContext:Qt,useCallback:ut,useContext:ut,useEffect:ut,useImperativeHandle:ut,useInsertionEffect:ut,useLayoutEffect:ut,useMemo:ut,useReducer:ut,useRef:ut,useState:ut,useDebugValue:ut,useDeferredValue:ut,useTransition:ut,useMutableSource:ut,useSyncExternalStore:ut,useId:ut,unstable_isNewReconciler:!1},ZT={readContext:Qt,useCallback:function(t,e){return Tn().memoizedState=[t,e===void 0?null:e],t},useContext:Qt,useEffect:fp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ea(4194308,4,bv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ea(4194308,4,t,e)},useInsertionEffect:function(t,e){return ea(4,2,t,e)},useMemo:function(t,e){var n=Tn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Tn();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=YT.bind(null,Ne,t),[i.memoizedState,t]},useRef:function(t){var e=Tn();return t={current:t},e.memoizedState=t},useState:hp,useDebugValue:Wd,useDeferredValue:function(t){return Tn().memoizedState=t},useTransition:function(){var t=hp(!1),e=t[0];return t=QT.bind(null,t[1]),Tn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Ne,r=Tn();if(Me){if(n===void 0)throw Error(q(407));n=n()}else{if(n=e(),tt===null)throw Error(q(349));Gi&30||mv(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,fp(vv.bind(null,i,s,t),[t]),i.flags|=2048,eo(9,gv.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Tn(),e=tt.identifierPrefix;if(Me){var n=Wn,i=zn;n=(i&~(1<<32-dn(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Xs++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=JT++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},eC={readContext:Qt,useCallback:Ev,useContext:Qt,useEffect:zd,useImperativeHandle:wv,useInsertionEffect:Tv,useLayoutEffect:Cv,useMemo:_v,useReducer:ml,useRef:Sv,useState:function(){return ml(Zs)},useDebugValue:Wd,useDeferredValue:function(t){var e=Yt();return Pv(e,Je.memoizedState,t)},useTransition:function(){var t=ml(Zs)[0],e=Yt().memoizedState;return[t,e]},useMutableSource:fv,useSyncExternalStore:pv,useId:Rv,unstable_isNewReconciler:!1},tC={readContext:Qt,useCallback:Ev,useContext:Qt,useEffect:zd,useImperativeHandle:wv,useInsertionEffect:Tv,useLayoutEffect:Cv,useMemo:_v,useReducer:gl,useRef:Sv,useState:function(){return gl(Zs)},useDebugValue:Wd,useDeferredValue:function(t){var e=Yt();return Je===null?e.memoizedState=t:Pv(e,Je.memoizedState,t)},useTransition:function(){var t=gl(Zs)[0],e=Yt().memoizedState;return[t,e]},useMutableSource:fv,useSyncExternalStore:pv,useId:Rv,unstable_isNewReconciler:!1};function nn(t,e){if(t&&t.defaultProps){e=Le({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function vu(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Le({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var lc={isMounted:function(t){return(t=t._reactInternals)?Zi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=yt(),r=vi(t),s=Hn(i,r);s.payload=e,n!=null&&(s.callback=n),e=mi(t,s,r),e!==null&&(hn(e,t,r,i),Xo(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=yt(),r=vi(t),s=Hn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=mi(t,s,r),e!==null&&(hn(e,t,r,i),Xo(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=yt(),i=vi(t),r=Hn(n,i);r.tag=2,e!=null&&(r.callback=e),e=mi(t,r,i),e!==null&&(hn(e,t,i,n),Xo(e,t,i))}};function pp(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Gs(n,i)||!Gs(r,s):!0}function Mv(t,e,n){var i=!1,r=bi,s=e.contextType;return typeof s=="object"&&s!==null?s=Qt(s):(r=Ot(e)?qi:ft.current,i=e.contextTypes,s=(i=i!=null)?Ur(t,r):bi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=lc,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function mp(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&lc.enqueueReplaceState(e,e.state,null)}function yu(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Nd(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Qt(s):(s=Ot(e)?qi:ft.current,r.context=Ur(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(vu(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&lc.enqueueReplaceState(r,r.state,null),Aa(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Vr(t,e){try{var n="",i=e;do n+=IS(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function vl(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ku(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var nC=typeof WeakMap=="function"?WeakMap:Map;function Av(t,e,n){n=Hn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Fa||(Fa=!0,Iu=i),ku(t,e)},n}function Dv(t,e,n){n=Hn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){ku(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){ku(t,e),typeof i!="function"&&(gi===null?gi=new Set([this]):gi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function gp(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new nC;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=gC.bind(null,t,e,n),e.then(t,t))}function vp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function yp(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Hn(-1,1),e.tag=2,mi(n,e,1))),n.lanes|=1),t)}var iC=Yn.ReactCurrentOwner,Rt=!1;function mt(t,e,n,i){e.child=t===null?lv(e,null,n,i):jr(e,t.child,n,i)}function kp(t,e,n,i,r){n=n.render;var s=e.ref;return _r(e,r),i=Bd(t,e,n,i,s,r),n=Vd(),t!==null&&!Rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Jn(t,e,r)):(Me&&n&&Rd(e),e.flags|=1,mt(t,e,i,r),e.child)}function Sp(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Yd(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Nv(t,e,s,i,r)):(t=ra(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Gs,n(o,i)&&t.ref===e.ref)return Jn(t,e,r)}return e.flags|=1,t=yi(s,i),t.ref=e.ref,t.return=e,e.child=t}function Nv(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Gs(s,i)&&t.ref===e.ref)if(Rt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Rt=!0);else return e.lanes=t.lanes,Jn(t,e,r)}return Su(t,e,n,i,r)}function Lv(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pe(yr,Nt),Nt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Pe(yr,Nt),Nt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,Pe(yr,Nt),Nt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,Pe(yr,Nt),Nt|=i;return mt(t,e,r,n),e.child}function Uv(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Su(t,e,n,i,r){var s=Ot(n)?qi:ft.current;return s=Ur(e,s),_r(e,r),n=Bd(t,e,n,i,s,r),i=Vd(),t!==null&&!Rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Jn(t,e,r)):(Me&&i&&Rd(e),e.flags|=1,mt(t,e,n,r),e.child)}function Tp(t,e,n,i,r){if(Ot(n)){var s=!0;Ra(e)}else s=!1;if(_r(e,r),e.stateNode===null)ta(t,e),Mv(e,n,i),yu(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Qt(u):(u=Ot(n)?qi:ft.current,u=Ur(e,u));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==u)&&mp(e,o,i,u),ri=!1;var m=e.memoizedState;o.state=m,Aa(e,i,o,r),c=e.memoizedState,a!==i||m!==c||xt.current||ri?(typeof d=="function"&&(vu(e,n,d,i),c=e.memoizedState),(a=ri||pp(e,n,a,i,m,c,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=u,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,dv(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:nn(e.type,a),o.props=u,f=e.pendingProps,m=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Qt(c):(c=Ot(n)?qi:ft.current,c=Ur(e,c));var S=n.getDerivedStateFromProps;(d=typeof S=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||m!==c)&&mp(e,o,i,c),ri=!1,m=e.memoizedState,o.state=m,Aa(e,i,o,r);var y=e.memoizedState;a!==f||m!==y||xt.current||ri?(typeof S=="function"&&(vu(e,n,S,i),y=e.memoizedState),(u=ri||pp(e,n,u,i,m,y,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,y,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),o.props=i,o.state=y,o.context=c,i=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),i=!1)}return Tu(t,e,n,i,s,r)}function Tu(t,e,n,i,r,s){Uv(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&op(e,n,!1),Jn(t,e,s);i=e.stateNode,iC.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=jr(e,t.child,null,s),e.child=jr(e,null,a,s)):mt(t,e,a,s),e.memoizedState=i.state,r&&op(e,n,!0),e.child}function Fv(t){var e=t.stateNode;e.pendingContext?sp(t,e.pendingContext,e.pendingContext!==e.context):e.context&&sp(t,e.context,!1),Ld(t,e.containerInfo)}function Cp(t,e,n,i,r){return Fr(),xd(r),e.flags|=256,mt(t,e,n,i),e.child}var Cu={dehydrated:null,treeContext:null,retryLane:0};function bu(t){return{baseLanes:t,cachePool:null,transitions:null}}function jv(t,e,n){var i=e.pendingProps,r=De.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Pe(De,r&1),t===null)return mu(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=hc(o,i,0,null),t=Wi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=bu(n),e.memoizedState=Cu,t):qd(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return rC(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=yi(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=yi(a,s):(s=Wi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?bu(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Cu,i}return s=t.child,t=s.sibling,i=yi(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function qd(t,e){return e=hc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Bo(t,e,n,i){return i!==null&&xd(i),jr(e,t.child,null,n),t=qd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function rC(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=vl(Error(q(422))),Bo(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=hc({mode:"visible",children:i.children},r,0,null),s=Wi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&jr(e,t.child,null,o),e.child.memoizedState=bu(o),e.memoizedState=Cu,s);if(!(e.mode&1))return Bo(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(q(419)),i=vl(s,i,void 0),Bo(t,e,o,i)}if(a=(o&t.childLanes)!==0,Rt||a){if(i=tt,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,$n(t,r),hn(i,t,r,-1))}return Qd(),i=vl(Error(q(421))),Bo(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=vC.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,Lt=pi(r.nextSibling),Ft=e,Me=!0,on=null,t!==null&&(Ht[Gt++]=zn,Ht[Gt++]=Wn,Ht[Gt++]=Hi,zn=t.id,Wn=t.overflow,Hi=e),e=qd(e,i.children),e.flags|=4096,e)}function bp(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),gu(t.return,e,n)}function yl(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Bv(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(mt(t,e,i.children,n),i=De.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&bp(t,n,e);else if(t.tag===19)bp(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Pe(De,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Da(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),yl(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Da(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}yl(e,!0,n,null,s);break;case"together":yl(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ta(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Jn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ki|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(q(153));if(e.child!==null){for(t=e.child,n=yi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=yi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function sC(t,e,n){switch(e.tag){case 3:Fv(e),Fr();break;case 5:hv(e);break;case 1:Ot(e.type)&&Ra(e);break;case 4:Ld(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Pe(Oa,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Pe(De,De.current&1),e.flags|=128,null):n&e.child.childLanes?jv(t,e,n):(Pe(De,De.current&1),t=Jn(t,e,n),t!==null?t.sibling:null);Pe(De,De.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Bv(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Pe(De,De.current),i)break;return null;case 22:case 23:return e.lanes=0,Lv(t,e,n)}return Jn(t,e,n)}var Vv,wu,zv,Wv;Vv=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};wu=function(){};zv=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Vi(_n.current);var s=null;switch(n){case"input":r=Gl(t,r),i=Gl(t,i),s=[];break;case"select":r=Le({},r,{value:void 0}),i=Le({},i,{value:void 0}),s=[];break;case"textarea":r=Jl(t,r),i=Jl(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=_a)}Yl(n,i);var o;n=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(js.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var c=i[u];if(a=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(js.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Ie("scroll",t),s||a===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};Wv=function(t,e,n,i){n!==i&&(e.flags|=4)};function ds(t,e){if(!Me)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function dt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function oC(t,e,n){var i=e.pendingProps;switch(Id(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dt(e),null;case 1:return Ot(e.type)&&Pa(),dt(e),null;case 3:return i=e.stateNode,Br(),Oe(xt),Oe(ft),Fd(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Fo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,on!==null&&(Mu(on),on=null))),wu(t,e),dt(e),null;case 5:Ud(e);var r=Vi(Ys.current);if(n=e.type,t!==null&&e.stateNode!=null)zv(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(q(166));return dt(e),null}if(t=Vi(_n.current),Fo(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[bn]=e,i[Js]=s,t=(e.mode&1)!==0,n){case"dialog":Ie("cancel",i),Ie("close",i);break;case"iframe":case"object":case"embed":Ie("load",i);break;case"video":case"audio":for(r=0;r<Cs.length;r++)Ie(Cs[r],i);break;case"source":Ie("error",i);break;case"img":case"image":case"link":Ie("error",i),Ie("load",i);break;case"details":Ie("toggle",i);break;case"input":Mf(i,s),Ie("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Ie("invalid",i);break;case"textarea":Df(i,s),Ie("invalid",i)}Yl(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Uo(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Uo(i.textContent,a,t),r=["children",""+a]):js.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ie("scroll",i)}switch(n){case"input":Io(i),Af(i,s,!0);break;case"textarea":Io(i),Nf(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=_a)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=vg(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[bn]=e,t[Js]=i,Vv(t,e,!1,!1),e.stateNode=t;e:{switch(o=Xl(n,i),n){case"dialog":Ie("cancel",t),Ie("close",t),r=i;break;case"iframe":case"object":case"embed":Ie("load",t),r=i;break;case"video":case"audio":for(r=0;r<Cs.length;r++)Ie(Cs[r],t);r=i;break;case"source":Ie("error",t),r=i;break;case"img":case"image":case"link":Ie("error",t),Ie("load",t),r=i;break;case"details":Ie("toggle",t),r=i;break;case"input":Mf(t,i),r=Gl(t,i),Ie("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Le({},i,{value:void 0}),Ie("invalid",t);break;case"textarea":Df(t,i),r=Jl(t,i),Ie("invalid",t);break;default:r=i}Yl(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?Sg(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&yg(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Bs(t,c):typeof c=="number"&&Bs(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(js.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Ie("scroll",t):c!=null&&pd(t,s,c,o))}switch(n){case"input":Io(t),Af(t,i,!1);break;case"textarea":Io(t),Nf(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Ci(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Cr(t,!!i.multiple,s,!1):i.defaultValue!=null&&Cr(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=_a)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return dt(e),null;case 6:if(t&&e.stateNode!=null)Wv(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(q(166));if(n=Vi(Ys.current),Vi(_n.current),Fo(e)){if(i=e.stateNode,n=e.memoizedProps,i[bn]=e,(s=i.nodeValue!==n)&&(t=Ft,t!==null))switch(t.tag){case 3:Uo(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Uo(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[bn]=e,e.stateNode=i}return dt(e),null;case 13:if(Oe(De),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Me&&Lt!==null&&e.mode&1&&!(e.flags&128))av(),Fr(),e.flags|=98560,s=!1;else if(s=Fo(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(q(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(q(317));s[bn]=e}else Fr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;dt(e),s=!1}else on!==null&&(Mu(on),on=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||De.current&1?Ye===0&&(Ye=3):Qd())),e.updateQueue!==null&&(e.flags|=4),dt(e),null);case 4:return Br(),wu(t,e),t===null&&Ks(e.stateNode.containerInfo),dt(e),null;case 10:return Ad(e.type._context),dt(e),null;case 17:return Ot(e.type)&&Pa(),dt(e),null;case 19:if(Oe(De),s=e.memoizedState,s===null)return dt(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)ds(s,!1);else{if(Ye!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Da(t),o!==null){for(e.flags|=128,ds(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Pe(De,De.current&1|2),e.child}t=t.sibling}s.tail!==null&&ze()>zr&&(e.flags|=128,i=!0,ds(s,!1),e.lanes=4194304)}else{if(!i)if(t=Da(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ds(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Me)return dt(e),null}else 2*ze()-s.renderingStartTime>zr&&n!==1073741824&&(e.flags|=128,i=!0,ds(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ze(),e.sibling=null,n=De.current,Pe(De,i?n&1|2:n&1),e):(dt(e),null);case 22:case 23:return Jd(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Nt&1073741824&&(dt(e),e.subtreeFlags&6&&(e.flags|=8192)):dt(e),null;case 24:return null;case 25:return null}throw Error(q(156,e.tag))}function aC(t,e){switch(Id(e),e.tag){case 1:return Ot(e.type)&&Pa(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Br(),Oe(xt),Oe(ft),Fd(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Ud(e),null;case 13:if(Oe(De),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(q(340));Fr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Oe(De),null;case 4:return Br(),null;case 10:return Ad(e.type._context),null;case 22:case 23:return Jd(),null;case 24:return null;default:return null}}var Vo=!1,ht=!1,cC=typeof WeakSet=="function"?WeakSet:Set,ee=null;function vr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Fe(t,e,i)}else n.current=null}function Eu(t,e,n){try{n()}catch(i){Fe(t,e,i)}}var wp=!1;function lC(t,e){if(cu=ba,t=$g(),Pd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,u=0,d=0,f=t,m=null;t:for(;;){for(var S;f!==n||r!==0&&f.nodeType!==3||(a=o+r),f!==s||i!==0&&f.nodeType!==3||(c=o+i),f.nodeType===3&&(o+=f.nodeValue.length),(S=f.firstChild)!==null;)m=f,f=S;for(;;){if(f===t)break t;if(m===n&&++u===r&&(a=o),m===s&&++d===i&&(c=o),(S=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=S}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(lu={focusedElem:t,selectionRange:n},ba=!1,ee=e;ee!==null;)if(e=ee,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ee=t;else for(;ee!==null;){e=ee;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var g=y.memoizedProps,E=y.memoizedState,v=e.stateNode,T=v.getSnapshotBeforeUpdate(e.elementType===e.type?g:nn(e.type,g),E);v.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(C){Fe(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,ee=t;break}ee=e.return}return y=wp,wp=!1,y}function Os(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Eu(e,n,s)}r=r.next}while(r!==i)}}function uc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function _u(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function qv(t){var e=t.alternate;e!==null&&(t.alternate=null,qv(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[bn],delete e[Js],delete e[hu],delete e[HT],delete e[GT])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Hv(t){return t.tag===5||t.tag===3||t.tag===4}function Ep(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Hv(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Pu(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=_a));else if(i!==4&&(t=t.child,t!==null))for(Pu(t,e,n),t=t.sibling;t!==null;)Pu(t,e,n),t=t.sibling}function Ru(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Ru(t,e,n),t=t.sibling;t!==null;)Ru(t,e,n),t=t.sibling}var rt=null,rn=!1;function Zn(t,e,n){for(n=n.child;n!==null;)Gv(t,e,n),n=n.sibling}function Gv(t,e,n){if(En&&typeof En.onCommitFiberUnmount=="function")try{En.onCommitFiberUnmount(nc,n)}catch{}switch(n.tag){case 5:ht||vr(n,e);case 6:var i=rt,r=rn;rt=null,Zn(t,e,n),rt=i,rn=r,rt!==null&&(rn?(t=rt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):rt.removeChild(n.stateNode));break;case 18:rt!==null&&(rn?(t=rt,n=n.stateNode,t.nodeType===8?dl(t.parentNode,n):t.nodeType===1&&dl(t,n),qs(t)):dl(rt,n.stateNode));break;case 4:i=rt,r=rn,rt=n.stateNode.containerInfo,rn=!0,Zn(t,e,n),rt=i,rn=r;break;case 0:case 11:case 14:case 15:if(!ht&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Eu(n,e,o),r=r.next}while(r!==i)}Zn(t,e,n);break;case 1:if(!ht&&(vr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Fe(n,e,a)}Zn(t,e,n);break;case 21:Zn(t,e,n);break;case 22:n.mode&1?(ht=(i=ht)||n.memoizedState!==null,Zn(t,e,n),ht=i):Zn(t,e,n);break;default:Zn(t,e,n)}}function _p(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new cC),e.forEach(function(i){var r=yC.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function en(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:rt=a.stateNode,rn=!1;break e;case 3:rt=a.stateNode.containerInfo,rn=!0;break e;case 4:rt=a.stateNode.containerInfo,rn=!0;break e}a=a.return}if(rt===null)throw Error(q(160));Gv(s,o,r),rt=null,rn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){Fe(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Kv(e,t),e=e.sibling}function Kv(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(en(e,t),kn(t),i&4){try{Os(3,t,t.return),uc(3,t)}catch(g){Fe(t,t.return,g)}try{Os(5,t,t.return)}catch(g){Fe(t,t.return,g)}}break;case 1:en(e,t),kn(t),i&512&&n!==null&&vr(n,n.return);break;case 5:if(en(e,t),kn(t),i&512&&n!==null&&vr(n,n.return),t.flags&32){var r=t.stateNode;try{Bs(r,"")}catch(g){Fe(t,t.return,g)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&mg(r,s),Xl(a,o);var u=Xl(a,s);for(o=0;o<c.length;o+=2){var d=c[o],f=c[o+1];d==="style"?Sg(r,f):d==="dangerouslySetInnerHTML"?yg(r,f):d==="children"?Bs(r,f):pd(r,d,f,u)}switch(a){case"input":Kl(r,s);break;case"textarea":gg(r,s);break;case"select":var m=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var S=s.value;S!=null?Cr(r,!!s.multiple,S,!1):m!==!!s.multiple&&(s.defaultValue!=null?Cr(r,!!s.multiple,s.defaultValue,!0):Cr(r,!!s.multiple,s.multiple?[]:"",!1))}r[Js]=s}catch(g){Fe(t,t.return,g)}}break;case 6:if(en(e,t),kn(t),i&4){if(t.stateNode===null)throw Error(q(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(g){Fe(t,t.return,g)}}break;case 3:if(en(e,t),kn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{qs(e.containerInfo)}catch(g){Fe(t,t.return,g)}break;case 4:en(e,t),kn(t);break;case 13:en(e,t),kn(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Kd=ze())),i&4&&_p(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(ht=(u=ht)||d,en(e,t),ht=u):en(e,t),kn(t),i&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(ee=t,d=t.child;d!==null;){for(f=ee=d;ee!==null;){switch(m=ee,S=m.child,m.tag){case 0:case 11:case 14:case 15:Os(4,m,m.return);break;case 1:vr(m,m.return);var y=m.stateNode;if(typeof y.componentWillUnmount=="function"){i=m,n=m.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(g){Fe(i,n,g)}}break;case 5:vr(m,m.return);break;case 22:if(m.memoizedState!==null){Rp(f);continue}}S!==null?(S.return=m,ee=S):Rp(f)}d=d.sibling}e:for(d=null,f=t;;){if(f.tag===5){if(d===null){d=f;try{r=f.stateNode,u?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=kg("display",o))}catch(g){Fe(t,t.return,g)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(g){Fe(t,t.return,g)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:en(e,t),kn(t),i&4&&_p(t);break;case 21:break;default:en(e,t),kn(t)}}function kn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Hv(n)){var i=n;break e}n=n.return}throw Error(q(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Bs(r,""),i.flags&=-33);var s=Ep(t);Ru(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Ep(t);Pu(t,a,o);break;default:throw Error(q(161))}}catch(c){Fe(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function uC(t,e,n){ee=t,$v(t)}function $v(t,e,n){for(var i=(t.mode&1)!==0;ee!==null;){var r=ee,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Vo;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||ht;a=Vo;var u=ht;if(Vo=o,(ht=c)&&!u)for(ee=r;ee!==null;)o=ee,c=o.child,o.tag===22&&o.memoizedState!==null?Ip(r):c!==null?(c.return=o,ee=c):Ip(r);for(;s!==null;)ee=s,$v(s),s=s.sibling;ee=r,Vo=a,ht=u}Pp(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,ee=s):Pp(t)}}function Pp(t){for(;ee!==null;){var e=ee;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ht||uc(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!ht)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:nn(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&dp(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}dp(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&qs(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}ht||e.flags&512&&_u(e)}catch(m){Fe(e,e.return,m)}}if(e===t){ee=null;break}if(n=e.sibling,n!==null){n.return=e.return,ee=n;break}ee=e.return}}function Rp(t){for(;ee!==null;){var e=ee;if(e===t){ee=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ee=n;break}ee=e.return}}function Ip(t){for(;ee!==null;){var e=ee;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{uc(4,e)}catch(c){Fe(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){Fe(e,r,c)}}var s=e.return;try{_u(e)}catch(c){Fe(e,s,c)}break;case 5:var o=e.return;try{_u(e)}catch(c){Fe(e,o,c)}}}catch(c){Fe(e,e.return,c)}if(e===t){ee=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ee=a;break}ee=e.return}}var dC=Math.ceil,Ua=Yn.ReactCurrentDispatcher,Hd=Yn.ReactCurrentOwner,Jt=Yn.ReactCurrentBatchConfig,ye=0,tt=null,Ge=null,at=0,Nt=0,yr=Pi(0),Ye=0,to=null,Ki=0,dc=0,Gd=0,Ms=null,_t=null,Kd=0,zr=1/0,Dn=null,Fa=!1,Iu=null,gi=null,zo=!1,li=null,ja=0,As=0,xu=null,na=-1,ia=0;function yt(){return ye&6?ze():na!==-1?na:na=ze()}function vi(t){return t.mode&1?ye&2&&at!==0?at&-at:$T.transition!==null?(ia===0&&(ia=Mg()),ia):(t=be,t!==0||(t=window.event,t=t===void 0?16:jg(t.type)),t):1}function hn(t,e,n,i){if(50<As)throw As=0,xu=null,Error(q(185));uo(t,n,i),(!(ye&2)||t!==tt)&&(t===tt&&(!(ye&2)&&(dc|=n),Ye===4&&oi(t,at)),Mt(t,i),n===1&&ye===0&&!(e.mode&1)&&(zr=ze()+500,ac&&Ri()))}function Mt(t,e){var n=t.callbackNode;$S(t,e);var i=Ca(t,t===tt?at:0);if(i===0)n!==null&&Ff(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Ff(n),e===1)t.tag===0?KT(xp.bind(null,t)):rv(xp.bind(null,t)),WT(function(){!(ye&6)&&Ri()}),n=null;else{switch(Ag(i)){case 1:n=kd;break;case 4:n=xg;break;case 16:n=Ta;break;case 536870912:n=Og;break;default:n=Ta}n=ny(n,Jv.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Jv(t,e){if(na=-1,ia=0,ye&6)throw Error(q(327));var n=t.callbackNode;if(Pr()&&t.callbackNode!==n)return null;var i=Ca(t,t===tt?at:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Ba(t,i);else{e=i;var r=ye;ye|=2;var s=Yv();(tt!==t||at!==e)&&(Dn=null,zr=ze()+500,zi(t,e));do try{pC();break}catch(a){Qv(t,a)}while(!0);Md(),Ua.current=s,ye=r,Ge!==null?e=0:(tt=null,at=0,e=Ye)}if(e!==0){if(e===2&&(r=iu(t),r!==0&&(i=r,e=Ou(t,r))),e===1)throw n=to,zi(t,0),oi(t,i),Mt(t,ze()),n;if(e===6)oi(t,i);else{if(r=t.current.alternate,!(i&30)&&!hC(r)&&(e=Ba(t,i),e===2&&(s=iu(t),s!==0&&(i=s,e=Ou(t,s))),e===1))throw n=to,zi(t,0),oi(t,i),Mt(t,ze()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(q(345));case 2:Li(t,_t,Dn);break;case 3:if(oi(t,i),(i&130023424)===i&&(e=Kd+500-ze(),10<e)){if(Ca(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){yt(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=du(Li.bind(null,t,_t,Dn),e);break}Li(t,_t,Dn);break;case 4:if(oi(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-dn(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=ze()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*dC(i/1960))-i,10<i){t.timeoutHandle=du(Li.bind(null,t,_t,Dn),i);break}Li(t,_t,Dn);break;case 5:Li(t,_t,Dn);break;default:throw Error(q(329))}}}return Mt(t,ze()),t.callbackNode===n?Jv.bind(null,t):null}function Ou(t,e){var n=Ms;return t.current.memoizedState.isDehydrated&&(zi(t,e).flags|=256),t=Ba(t,e),t!==2&&(e=_t,_t=n,e!==null&&Mu(e)),t}function Mu(t){_t===null?_t=t:_t.push.apply(_t,t)}function hC(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!fn(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function oi(t,e){for(e&=~Gd,e&=~dc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-dn(e),i=1<<n;t[n]=-1,e&=~i}}function xp(t){if(ye&6)throw Error(q(327));Pr();var e=Ca(t,0);if(!(e&1))return Mt(t,ze()),null;var n=Ba(t,e);if(t.tag!==0&&n===2){var i=iu(t);i!==0&&(e=i,n=Ou(t,i))}if(n===1)throw n=to,zi(t,0),oi(t,e),Mt(t,ze()),n;if(n===6)throw Error(q(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Li(t,_t,Dn),Mt(t,ze()),null}function $d(t,e){var n=ye;ye|=1;try{return t(e)}finally{ye=n,ye===0&&(zr=ze()+500,ac&&Ri())}}function $i(t){li!==null&&li.tag===0&&!(ye&6)&&Pr();var e=ye;ye|=1;var n=Jt.transition,i=be;try{if(Jt.transition=null,be=1,t)return t()}finally{be=i,Jt.transition=n,ye=e,!(ye&6)&&Ri()}}function Jd(){Nt=yr.current,Oe(yr)}function zi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,zT(n)),Ge!==null)for(n=Ge.return;n!==null;){var i=n;switch(Id(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Pa();break;case 3:Br(),Oe(xt),Oe(ft),Fd();break;case 5:Ud(i);break;case 4:Br();break;case 13:Oe(De);break;case 19:Oe(De);break;case 10:Ad(i.type._context);break;case 22:case 23:Jd()}n=n.return}if(tt=t,Ge=t=yi(t.current,null),at=Nt=e,Ye=0,to=null,Gd=dc=Ki=0,_t=Ms=null,Bi!==null){for(e=0;e<Bi.length;e++)if(n=Bi[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Bi=null}return t}function Qv(t,e){do{var n=Ge;try{if(Md(),Zo.current=La,Na){for(var i=Ne.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Na=!1}if(Gi=0,Xe=Je=Ne=null,xs=!1,Xs=0,Hd.current=null,n===null||n.return===null){Ye=1,to=e,Ge=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=at,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var m=d.alternate;m?(d.updateQueue=m.updateQueue,d.memoizedState=m.memoizedState,d.lanes=m.lanes):(d.updateQueue=null,d.memoizedState=null)}var S=vp(o);if(S!==null){S.flags&=-257,yp(S,o,a,s,e),S.mode&1&&gp(s,u,e),e=S,c=u;var y=e.updateQueue;if(y===null){var g=new Set;g.add(c),e.updateQueue=g}else y.add(c);break e}else{if(!(e&1)){gp(s,u,e),Qd();break e}c=Error(q(426))}}else if(Me&&a.mode&1){var E=vp(o);if(E!==null){!(E.flags&65536)&&(E.flags|=256),yp(E,o,a,s,e),xd(Vr(c,a));break e}}s=c=Vr(c,a),Ye!==4&&(Ye=2),Ms===null?Ms=[s]:Ms.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=Av(s,c,e);up(s,v);break e;case 1:a=c;var T=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof T.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(gi===null||!gi.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var C=Dv(s,a,e);up(s,C);break e}}s=s.return}while(s!==null)}Zv(n)}catch(x){e=x,Ge===n&&n!==null&&(Ge=n=n.return);continue}break}while(!0)}function Yv(){var t=Ua.current;return Ua.current=La,t===null?La:t}function Qd(){(Ye===0||Ye===3||Ye===2)&&(Ye=4),tt===null||!(Ki&268435455)&&!(dc&268435455)||oi(tt,at)}function Ba(t,e){var n=ye;ye|=2;var i=Yv();(tt!==t||at!==e)&&(Dn=null,zi(t,e));do try{fC();break}catch(r){Qv(t,r)}while(!0);if(Md(),ye=n,Ua.current=i,Ge!==null)throw Error(q(261));return tt=null,at=0,Ye}function fC(){for(;Ge!==null;)Xv(Ge)}function pC(){for(;Ge!==null&&!jS();)Xv(Ge)}function Xv(t){var e=ty(t.alternate,t,Nt);t.memoizedProps=t.pendingProps,e===null?Zv(t):Ge=e,Hd.current=null}function Zv(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=aC(n,e),n!==null){n.flags&=32767,Ge=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ye=6,Ge=null;return}}else if(n=oC(n,e,Nt),n!==null){Ge=n;return}if(e=e.sibling,e!==null){Ge=e;return}Ge=e=t}while(e!==null);Ye===0&&(Ye=5)}function Li(t,e,n){var i=be,r=Jt.transition;try{Jt.transition=null,be=1,mC(t,e,n,i)}finally{Jt.transition=r,be=i}return null}function mC(t,e,n,i){do Pr();while(li!==null);if(ye&6)throw Error(q(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(q(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(JS(t,s),t===tt&&(Ge=tt=null,at=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||zo||(zo=!0,ny(Ta,function(){return Pr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Jt.transition,Jt.transition=null;var o=be;be=1;var a=ye;ye|=4,Hd.current=null,lC(t,n),Kv(n,t),NT(lu),ba=!!cu,lu=cu=null,t.current=n,uC(n),BS(),ye=a,be=o,Jt.transition=s}else t.current=n;if(zo&&(zo=!1,li=t,ja=r),s=t.pendingLanes,s===0&&(gi=null),WS(n.stateNode),Mt(t,ze()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Fa)throw Fa=!1,t=Iu,Iu=null,t;return ja&1&&t.tag!==0&&Pr(),s=t.pendingLanes,s&1?t===xu?As++:(As=0,xu=t):As=0,Ri(),null}function Pr(){if(li!==null){var t=Ag(ja),e=Jt.transition,n=be;try{if(Jt.transition=null,be=16>t?16:t,li===null)var i=!1;else{if(t=li,li=null,ja=0,ye&6)throw Error(q(331));var r=ye;for(ye|=4,ee=t.current;ee!==null;){var s=ee,o=s.child;if(ee.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(ee=u;ee!==null;){var d=ee;switch(d.tag){case 0:case 11:case 15:Os(8,d,s)}var f=d.child;if(f!==null)f.return=d,ee=f;else for(;ee!==null;){d=ee;var m=d.sibling,S=d.return;if(qv(d),d===u){ee=null;break}if(m!==null){m.return=S,ee=m;break}ee=S}}}var y=s.alternate;if(y!==null){var g=y.child;if(g!==null){y.child=null;do{var E=g.sibling;g.sibling=null,g=E}while(g!==null)}}ee=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ee=o;else e:for(;ee!==null;){if(s=ee,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Os(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,ee=v;break e}ee=s.return}}var T=t.current;for(ee=T;ee!==null;){o=ee;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,ee=b;else e:for(o=T;ee!==null;){if(a=ee,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:uc(9,a)}}catch(x){Fe(a,a.return,x)}if(a===o){ee=null;break e}var C=a.sibling;if(C!==null){C.return=a.return,ee=C;break e}ee=a.return}}if(ye=r,Ri(),En&&typeof En.onPostCommitFiberRoot=="function")try{En.onPostCommitFiberRoot(nc,t)}catch{}i=!0}return i}finally{be=n,Jt.transition=e}}return!1}function Op(t,e,n){e=Vr(n,e),e=Av(t,e,1),t=mi(t,e,1),e=yt(),t!==null&&(uo(t,1,e),Mt(t,e))}function Fe(t,e,n){if(t.tag===3)Op(t,t,n);else for(;e!==null;){if(e.tag===3){Op(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(gi===null||!gi.has(i))){t=Vr(n,t),t=Dv(e,t,1),e=mi(e,t,1),t=yt(),e!==null&&(uo(e,1,t),Mt(e,t));break}}e=e.return}}function gC(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=yt(),t.pingedLanes|=t.suspendedLanes&n,tt===t&&(at&n)===n&&(Ye===4||Ye===3&&(at&130023424)===at&&500>ze()-Kd?zi(t,0):Gd|=n),Mt(t,e)}function ey(t,e){e===0&&(t.mode&1?(e=Mo,Mo<<=1,!(Mo&130023424)&&(Mo=4194304)):e=1);var n=yt();t=$n(t,e),t!==null&&(uo(t,e,n),Mt(t,n))}function vC(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ey(t,n)}function yC(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(q(314))}i!==null&&i.delete(e),ey(t,n)}var ty;ty=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||xt.current)Rt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Rt=!1,sC(t,e,n);Rt=!!(t.flags&131072)}else Rt=!1,Me&&e.flags&1048576&&sv(e,xa,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;ta(t,e),t=e.pendingProps;var r=Ur(e,ft.current);_r(e,n),r=Bd(null,e,i,t,r,n);var s=Vd();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ot(i)?(s=!0,Ra(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Nd(e),r.updater=lc,e.stateNode=r,r._reactInternals=e,yu(e,i,t,n),e=Tu(null,e,i,!0,s,n)):(e.tag=0,Me&&s&&Rd(e),mt(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(ta(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=SC(i),t=nn(i,t),r){case 0:e=Su(null,e,i,t,n);break e;case 1:e=Tp(null,e,i,t,n);break e;case 11:e=kp(null,e,i,t,n);break e;case 14:e=Sp(null,e,i,nn(i.type,t),n);break e}throw Error(q(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:nn(i,r),Su(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:nn(i,r),Tp(t,e,i,r,n);case 3:e:{if(Fv(e),t===null)throw Error(q(387));i=e.pendingProps,s=e.memoizedState,r=s.element,dv(t,e),Aa(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Vr(Error(q(423)),e),e=Cp(t,e,i,n,r);break e}else if(i!==r){r=Vr(Error(q(424)),e),e=Cp(t,e,i,n,r);break e}else for(Lt=pi(e.stateNode.containerInfo.firstChild),Ft=e,Me=!0,on=null,n=lv(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Fr(),i===r){e=Jn(t,e,n);break e}mt(t,e,i,n)}e=e.child}return e;case 5:return hv(e),t===null&&mu(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,uu(i,r)?o=null:s!==null&&uu(i,s)&&(e.flags|=32),Uv(t,e),mt(t,e,o,n),e.child;case 6:return t===null&&mu(e),null;case 13:return jv(t,e,n);case 4:return Ld(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=jr(e,null,i,n):mt(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:nn(i,r),kp(t,e,i,r,n);case 7:return mt(t,e,e.pendingProps,n),e.child;case 8:return mt(t,e,e.pendingProps.children,n),e.child;case 12:return mt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Pe(Oa,i._currentValue),i._currentValue=o,s!==null)if(fn(s.value,o)){if(s.children===r.children&&!xt.current){e=Jn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=Hn(-1,n&-n),c.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),gu(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(q(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),gu(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}mt(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,_r(e,n),r=Qt(r),i=i(r),e.flags|=1,mt(t,e,i,n),e.child;case 14:return i=e.type,r=nn(i,e.pendingProps),r=nn(i.type,r),Sp(t,e,i,r,n);case 15:return Nv(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:nn(i,r),ta(t,e),e.tag=1,Ot(i)?(t=!0,Ra(e)):t=!1,_r(e,n),Mv(e,i,r),yu(e,i,r,n),Tu(null,e,i,!0,t,n);case 19:return Bv(t,e,n);case 22:return Lv(t,e,n)}throw Error(q(156,e.tag))};function ny(t,e){return Ig(t,e)}function kC(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kt(t,e,n,i){return new kC(t,e,n,i)}function Yd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function SC(t){if(typeof t=="function")return Yd(t)?1:0;if(t!=null){if(t=t.$$typeof,t===gd)return 11;if(t===vd)return 14}return 2}function yi(t,e){var n=t.alternate;return n===null?(n=Kt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function ra(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Yd(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case cr:return Wi(n.children,r,s,e);case md:o=8,r|=8;break;case zl:return t=Kt(12,n,e,r|2),t.elementType=zl,t.lanes=s,t;case Wl:return t=Kt(13,n,e,r),t.elementType=Wl,t.lanes=s,t;case ql:return t=Kt(19,n,e,r),t.elementType=ql,t.lanes=s,t;case hg:return hc(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ug:o=10;break e;case dg:o=9;break e;case gd:o=11;break e;case vd:o=14;break e;case ii:o=16,i=null;break e}throw Error(q(130,t==null?t:typeof t,""))}return e=Kt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Wi(t,e,n,i){return t=Kt(7,t,i,e),t.lanes=n,t}function hc(t,e,n,i){return t=Kt(22,t,i,e),t.elementType=hg,t.lanes=n,t.stateNode={isHidden:!1},t}function kl(t,e,n){return t=Kt(6,t,null,e),t.lanes=n,t}function Sl(t,e,n){return e=Kt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function TC(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=el(0),this.expirationTimes=el(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=el(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Xd(t,e,n,i,r,s,o,a,c){return t=new TC(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Kt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Nd(s),t}function CC(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ar,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function iy(t){if(!t)return bi;t=t._reactInternals;e:{if(Zi(t)!==t||t.tag!==1)throw Error(q(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ot(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(q(171))}if(t.tag===1){var n=t.type;if(Ot(n))return iv(t,n,e)}return e}function ry(t,e,n,i,r,s,o,a,c){return t=Xd(n,i,!0,t,r,s,o,a,c),t.context=iy(null),n=t.current,i=yt(),r=vi(n),s=Hn(i,r),s.callback=e??null,mi(n,s,r),t.current.lanes=r,uo(t,r,i),Mt(t,i),t}function fc(t,e,n,i){var r=e.current,s=yt(),o=vi(r);return n=iy(n),e.context===null?e.context=n:e.pendingContext=n,e=Hn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=mi(r,e,o),t!==null&&(hn(t,r,o,s),Xo(t,r,o)),o}function Va(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Mp(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Zd(t,e){Mp(t,e),(t=t.alternate)&&Mp(t,e)}function bC(){return null}var sy=typeof reportError=="function"?reportError:function(t){console.error(t)};function eh(t){this._internalRoot=t}pc.prototype.render=eh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(q(409));fc(t,e,null,null)};pc.prototype.unmount=eh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;$i(function(){fc(null,t,null,null)}),e[Kn]=null}};function pc(t){this._internalRoot=t}pc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Lg();t={blockedOn:null,target:t,priority:e};for(var n=0;n<si.length&&e!==0&&e<si[n].priority;n++);si.splice(n,0,t),n===0&&Fg(t)}};function th(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function mc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ap(){}function wC(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var u=Va(o);s.call(u)}}var o=ry(e,i,t,0,null,!1,!1,"",Ap);return t._reactRootContainer=o,t[Kn]=o.current,Ks(t.nodeType===8?t.parentNode:t),$i(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var u=Va(c);a.call(u)}}var c=Xd(t,0,!1,null,null,!1,!1,"",Ap);return t._reactRootContainer=c,t[Kn]=c.current,Ks(t.nodeType===8?t.parentNode:t),$i(function(){fc(e,c,n,i)}),c}function gc(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=Va(o);a.call(c)}}fc(e,o,t,r)}else o=wC(n,e,t,r,i);return Va(o)}Dg=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ts(e.pendingLanes);n!==0&&(Sd(e,n|1),Mt(e,ze()),!(ye&6)&&(zr=ze()+500,Ri()))}break;case 13:$i(function(){var i=$n(t,1);if(i!==null){var r=yt();hn(i,t,1,r)}}),Zd(t,1)}};Td=function(t){if(t.tag===13){var e=$n(t,134217728);if(e!==null){var n=yt();hn(e,t,134217728,n)}Zd(t,134217728)}};Ng=function(t){if(t.tag===13){var e=vi(t),n=$n(t,e);if(n!==null){var i=yt();hn(n,t,e,i)}Zd(t,e)}};Lg=function(){return be};Ug=function(t,e){var n=be;try{return be=t,e()}finally{be=n}};eu=function(t,e,n){switch(e){case"input":if(Kl(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=oc(i);if(!r)throw Error(q(90));pg(i),Kl(i,r)}}}break;case"textarea":gg(t,n);break;case"select":e=n.value,e!=null&&Cr(t,!!n.multiple,e,!1)}};bg=$d;wg=$i;var EC={usingClientEntryPoint:!1,Events:[fo,hr,oc,Tg,Cg,$d]},hs={findFiberByHostInstance:ji,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_C={bundleType:hs.bundleType,version:hs.version,rendererPackageName:hs.rendererPackageName,rendererConfig:hs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Pg(t),t===null?null:t.stateNode},findFiberByHostInstance:hs.findFiberByHostInstance||bC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wo.isDisabled&&Wo.supportsFiber)try{nc=Wo.inject(_C),En=Wo}catch{}}Bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=EC;Bt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!th(e))throw Error(q(200));return CC(t,e,null,n)};Bt.createRoot=function(t,e){if(!th(t))throw Error(q(299));var n=!1,i="",r=sy;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Xd(t,1,!1,null,null,n,!1,i,r),t[Kn]=e.current,Ks(t.nodeType===8?t.parentNode:t),new eh(e)};Bt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(q(188)):(t=Object.keys(t).join(","),Error(q(268,t)));return t=Pg(e),t=t===null?null:t.stateNode,t};Bt.flushSync=function(t){return $i(t)};Bt.hydrate=function(t,e,n){if(!mc(e))throw Error(q(200));return gc(null,t,e,!0,n)};Bt.hydrateRoot=function(t,e,n){if(!th(t))throw Error(q(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=sy;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=ry(e,null,t,1,n??null,r,!1,s,o),t[Kn]=e.current,Ks(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new pc(e)};Bt.render=function(t,e,n){if(!mc(e))throw Error(q(200));return gc(null,t,e,!1,n)};Bt.unmountComponentAtNode=function(t){if(!mc(t))throw Error(q(40));return t._reactRootContainer?($i(function(){gc(null,null,t,!1,function(){t._reactRootContainer=null,t[Kn]=null})}),!0):!1};Bt.unstable_batchedUpdates=$d;Bt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!mc(n))throw Error(q(200));if(t==null||t._reactInternals===void 0)throw Error(q(38));return gc(t,e,n,!1,i)};Bt.version="18.3.1-next-f1338f8080-20240426";function oy(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oy)}catch(t){console.error(t)}}oy(),og.exports=Bt;var PC=og.exports,Dp=PC;Bl.createRoot=Dp.createRoot,Bl.hydrateRoot=Dp.hydrateRoot;var ay={exports:{}};(function(t,e){(function(i,r){t.exports=r(Ce)})(wn,function(n){return function(i){var r={};function s(o){if(r[o])return r[o].exports;var a=r[o]={i:o,l:!1,exports:{}};return i[o].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=i,s.c=r,s.d=function(o,a,c){s.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:c})},s.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.t=function(o,a){if(a&1&&(o=s(o)),a&8||a&4&&typeof o=="object"&&o&&o.__esModule)return o;var c=Object.create(null);if(s.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:o}),a&2&&typeof o!="string")for(var u in o)s.d(c,u,(function(d){return o[d]}).bind(null,u));return c},s.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(a,"a",a),a},s.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},s.p="",s(s.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(i,r,s){s.r(r);var o=s("react"),a=function(){var m=function(S,y){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,E){g.__proto__=E}||function(g,E){for(var v in E)E.hasOwnProperty(v)&&(g[v]=E[v])},m(S,y)};return function(S,y){m(S,y);function g(){this.constructor=S}S.prototype=y===null?Object.create(y):(g.prototype=y.prototype,new g)}}(),c=function(){return c=Object.assign||function(m){for(var S,y=1,g=arguments.length;y<g;y++){S=arguments[y];for(var E in S)Object.prototype.hasOwnProperty.call(S,E)&&(m[E]=S[E])}return m},c.apply(this,arguments)},u=function(m,S){var y={};for(var g in m)Object.prototype.hasOwnProperty.call(m,g)&&S.indexOf(g)<0&&(y[g]=m[g]);if(m!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,g=Object.getOwnPropertySymbols(m);E<g.length;E++)S.indexOf(g[E])<0&&Object.prototype.propertyIsEnumerable.call(m,g[E])&&(y[g[E]]=m[g[E]]);return y};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(S){var y=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return y?new Promise(function(g,E){y.call(navigator,S,g,E)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function d(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var f=function(m){a(S,m);function S(y){var g=m.call(this,y)||this;return g.canvas=null,g.ctx=null,g.requestUserMediaId=0,g.unmounted=!1,g.state={hasUserMedia:!1},g}return S.prototype.componentDidMount=function(){var y=this,g=y.state,E=y.props;if(this.unmounted=!1,!d()){E.onUserMediaError("getUserMedia not supported");return}g.hasUserMedia||this.requestUserMedia(),E.children&&typeof E.children!="function"&&console.warn("children must be a function")},S.prototype.componentDidUpdate=function(y){var g=this.props;if(!d()){g.onUserMediaError("getUserMedia not supported");return}var E=JSON.stringify(y.audioConstraints)!==JSON.stringify(g.audioConstraints),v=JSON.stringify(y.videoConstraints)!==JSON.stringify(g.videoConstraints),T=y.minScreenshotWidth!==g.minScreenshotWidth,b=y.minScreenshotHeight!==g.minScreenshotHeight;(v||T||b)&&(this.canvas=null,this.ctx=null),(E||v)&&(this.stopAndCleanup(),this.requestUserMedia())},S.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},S.stopMediaStream=function(y){y&&(y.getVideoTracks&&y.getAudioTracks?(y.getVideoTracks().map(function(g){y.removeTrack(g),g.stop()}),y.getAudioTracks().map(function(g){y.removeTrack(g),g.stop()})):y.stop())},S.prototype.stopAndCleanup=function(){var y=this.state;y.hasUserMedia&&(S.stopMediaStream(this.stream),y.src&&window.URL.revokeObjectURL(y.src))},S.prototype.getScreenshot=function(y){var g=this,E=g.state,v=g.props;if(!E.hasUserMedia)return null;var T=this.getCanvas(y);return T&&T.toDataURL(v.screenshotFormat,v.screenshotQuality)},S.prototype.getCanvas=function(y){var g=this,E=g.state,v=g.props;if(!this.video||!E.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var T=this.video.videoWidth,b=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var C=T/b;T=v.minScreenshotWidth||this.video.clientWidth,b=T/C,v.minScreenshotHeight&&b<v.minScreenshotHeight&&(b=v.minScreenshotHeight,T=b*C)}this.canvas=document.createElement("canvas"),this.canvas.width=(y==null?void 0:y.width)||T,this.canvas.height=(y==null?void 0:y.height)||b,this.ctx=this.canvas.getContext("2d")}var x=this,A=x.ctx,D=x.canvas;return A&&D&&(D.width=(y==null?void 0:y.width)||D.width,D.height=(y==null?void 0:y.height)||D.height,v.mirrored&&(A.translate(D.width,0),A.scale(-1,1)),A.imageSmoothingEnabled=v.imageSmoothing,A.drawImage(this.video,0,0,(y==null?void 0:y.width)||D.width,(y==null?void 0:y.height)||D.height),v.mirrored&&(A.scale(-1,1),A.translate(-D.width,0))),D},S.prototype.requestUserMedia=function(){var y=this,g=this.props,E=function(b,C){var x={video:typeof C<"u"?C:!0};g.audio&&(x.audio=typeof b<"u"?b:!0),y.requestUserMediaId++;var A=y.requestUserMediaId;navigator.mediaDevices.getUserMedia(x).then(function(D){y.unmounted||A!==y.requestUserMediaId?S.stopMediaStream(D):y.handleUserMedia(null,D)}).catch(function(D){y.handleUserMedia(D)})};if("mediaDevices"in navigator)E(g.audioConstraints,g.videoConstraints);else{var v=function(b){return{optional:[{sourceId:b}]}},T=function(b){var C=b.deviceId;return typeof C=="string"?C:Array.isArray(C)&&C.length>0?C[0]:typeof C=="object"&&C.ideal?C.ideal:null};MediaStreamTrack.getSources(function(b){var C=null,x=null;b.forEach(function(U){U.kind==="audio"?C=U.id:U.kind==="video"&&(x=U.id)});var A=T(g.audioConstraints);A&&(C=A);var D=T(g.videoConstraints);D&&(x=D),E(v(C),v(x))})}},S.prototype.handleUserMedia=function(y,g){var E=this.props;if(y||!g){this.setState({hasUserMedia:!1}),E.onUserMediaError(y);return}this.stream=g;try{this.video&&(this.video.srcObject=g),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(g)})}E.onUserMedia(g)},S.prototype.render=function(){var y=this,g=this,E=g.state,v=g.props,T=v.audio;v.forceScreenshotSourceSize;var b=v.disablePictureInPicture;v.onUserMedia,v.onUserMediaError,v.screenshotFormat,v.screenshotQuality,v.minScreenshotWidth,v.minScreenshotHeight,v.audioConstraints,v.videoConstraints,v.imageSmoothing;var C=v.mirrored,x=v.style,A=x===void 0?{}:x,D=v.children,U=u(v,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),V=C?c(c({},A),{transform:(A.transform||"")+" scaleX(-1)"}):A,R={getScreenshot:this.getScreenshot.bind(this)};return o.createElement(o.Fragment,null,o.createElement("video",c({autoPlay:!0,disablePictureInPicture:b,src:E.src,muted:!T,playsInline:!0,ref:function(M){y.video=M},style:V},U)),D&&D(R))},S.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},S}(o.Component);r.default=f},react:function(i,r){i.exports=n}}).default})})(ay);var RC=ay.exports;const IC=$m(RC);var Np={};(function(){var t;function e(l){var h=0;return function(){return h<l.length?{done:!1,value:l[h++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,p){return l==Array.prototype||l==Object.prototype||(l[h]=p.value),l};function i(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof wn=="object"&&wn];for(var h=0;h<l.length;++h){var p=l[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=i(this);function s(l,h){if(h)e:{var p=r;l=l.split(".");for(var k=0;k<l.length-1;k++){var w=l[k];if(!(w in p))break e;p=p[w]}l=l[l.length-1],k=p[l],h=h(k),h!=k&&h!=null&&n(p,l,{configurable:!0,writable:!0,value:h})}}s("Symbol",function(l){function h(P){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new p(k+(P||"")+"_"+w++,P)}function p(P,_){this.h=P,n(this,"description",{configurable:!0,writable:!0,value:_})}if(l)return l;p.prototype.toString=function(){return this.h};var k="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",w=0;return h}),s("Symbol.iterator",function(l){if(l)return l;l=Symbol("Symbol.iterator");for(var h="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),p=0;p<h.length;p++){var k=r[h[p]];typeof k=="function"&&typeof k.prototype[l]!="function"&&n(k.prototype,l,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return l});function o(l){return l={next:l},l[Symbol.iterator]=function(){return this},l}function a(l){var h=typeof Symbol<"u"&&Symbol.iterator&&l[Symbol.iterator];return h?h.call(l):{next:e(l)}}function c(l){if(!(l instanceof Array)){l=a(l);for(var h,p=[];!(h=l.next()).done;)p.push(h.value);l=p}return l}var u=typeof Object.assign=="function"?Object.assign:function(l,h){for(var p=1;p<arguments.length;p++){var k=arguments[p];if(k)for(var w in k)Object.prototype.hasOwnProperty.call(k,w)&&(l[w]=k[w])}return l};s("Object.assign",function(l){return l||u});var d=typeof Object.create=="function"?Object.create:function(l){function h(){}return h.prototype=l,new h},f;if(typeof Object.setPrototypeOf=="function")f=Object.setPrototypeOf;else{var m;e:{var S={a:!0},y={};try{y.__proto__=S,m=y.a;break e}catch{}m=!1}f=m?function(l,h){if(l.__proto__=h,l.__proto__!==h)throw new TypeError(l+" is not extensible");return l}:null}var g=f;function E(l,h){if(l.prototype=d(h.prototype),l.prototype.constructor=l,g)g(l,h);else for(var p in h)if(p!="prototype")if(Object.defineProperties){var k=Object.getOwnPropertyDescriptor(h,p);k&&Object.defineProperty(l,p,k)}else l[p]=h[p];l.za=h.prototype}function v(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function T(l){if(l.m)throw new TypeError("Generator is already running");l.m=!0}v.prototype.u=function(l){this.i=l};function b(l,h){l.l={ma:h,na:!0},l.h=l.s||l.v}v.prototype.return=function(l){this.l={return:l},this.h=this.v};function C(l,h,p){return l.h=p,{value:h}}function x(l){this.h=new v,this.i=l}function A(l,h){T(l.h);var p=l.h.j;return p?D(l,"return"in p?p.return:function(k){return{value:k,done:!0}},h,l.h.return):(l.h.return(h),U(l))}function D(l,h,p,k){try{var w=h.call(l.h.j,p);if(!(w instanceof Object))throw new TypeError("Iterator result "+w+" is not an object");if(!w.done)return l.h.m=!1,w;var P=w.value}catch(_){return l.h.j=null,b(l.h,_),U(l)}return l.h.j=null,k.call(l.h,P),U(l)}function U(l){for(;l.h.h;)try{var h=l.i(l.h);if(h)return l.h.m=!1,{value:h.value,done:!1}}catch(p){l.h.i=void 0,b(l.h,p)}if(l.h.m=!1,l.h.l){if(h=l.h.l,l.h.l=null,h.na)throw h.ma;return{value:h.return,done:!0}}return{value:void 0,done:!0}}function V(l){this.next=function(h){return T(l.h),l.h.j?h=D(l,l.h.j.next,h,l.h.u):(l.h.u(h),h=U(l)),h},this.throw=function(h){return T(l.h),l.h.j?h=D(l,l.h.j.throw,h,l.h.u):(b(l.h,h),h=U(l)),h},this.return=function(h){return A(l,h)},this[Symbol.iterator]=function(){return this}}function R(l){function h(k){return l.next(k)}function p(k){return l.throw(k)}return new Promise(function(k,w){function P(_){_.done?k(_.value):Promise.resolve(_.value).then(h,p).then(P,w)}P(l.next())})}function M(l){return R(new V(new x(l)))}s("Promise",function(l){function h(_){this.i=0,this.j=void 0,this.h=[],this.u=!1;var O=this.l();try{_(O.resolve,O.reject)}catch(L){O.reject(L)}}function p(){this.h=null}function k(_){return _ instanceof h?_:new h(function(O){O(_)})}if(l)return l;p.prototype.i=function(_){if(this.h==null){this.h=[];var O=this;this.j(function(){O.m()})}this.h.push(_)};var w=r.setTimeout;p.prototype.j=function(_){w(_,0)},p.prototype.m=function(){for(;this.h&&this.h.length;){var _=this.h;this.h=[];for(var O=0;O<_.length;++O){var L=_[O];_[O]=null;try{L()}catch(W){this.l(W)}}}this.h=null},p.prototype.l=function(_){this.j(function(){throw _})},h.prototype.l=function(){function _(W){return function(J){L||(L=!0,W.call(O,J))}}var O=this,L=!1;return{resolve:_(this.I),reject:_(this.m)}},h.prototype.I=function(_){if(_===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(_ instanceof h)this.L(_);else{e:switch(typeof _){case"object":var O=_!=null;break e;case"function":O=!0;break e;default:O=!1}O?this.F(_):this.s(_)}},h.prototype.F=function(_){var O=void 0;try{O=_.then}catch(L){this.m(L);return}typeof O=="function"?this.M(O,_):this.s(_)},h.prototype.m=function(_){this.v(2,_)},h.prototype.s=function(_){this.v(1,_)},h.prototype.v=function(_,O){if(this.i!=0)throw Error("Cannot settle("+_+", "+O+"): Promise already settled in state"+this.i);this.i=_,this.j=O,this.i===2&&this.K(),this.H()},h.prototype.K=function(){var _=this;w(function(){if(_.D()){var O=r.console;typeof O<"u"&&O.error(_.j)}},1)},h.prototype.D=function(){if(this.u)return!1;var _=r.CustomEvent,O=r.Event,L=r.dispatchEvent;return typeof L>"u"?!0:(typeof _=="function"?_=new _("unhandledrejection",{cancelable:!0}):typeof O=="function"?_=new O("unhandledrejection",{cancelable:!0}):(_=r.document.createEvent("CustomEvent"),_.initCustomEvent("unhandledrejection",!1,!0,_)),_.promise=this,_.reason=this.j,L(_))},h.prototype.H=function(){if(this.h!=null){for(var _=0;_<this.h.length;++_)P.i(this.h[_]);this.h=null}};var P=new p;return h.prototype.L=function(_){var O=this.l();_.T(O.resolve,O.reject)},h.prototype.M=function(_,O){var L=this.l();try{_.call(O,L.resolve,L.reject)}catch(W){L.reject(W)}},h.prototype.then=function(_,O){function L(te,X){return typeof te=="function"?function(ae){try{W(te(ae))}catch(de){J(de)}}:X}var W,J,oe=new h(function(te,X){W=te,J=X});return this.T(L(_,W),L(O,J)),oe},h.prototype.catch=function(_){return this.then(void 0,_)},h.prototype.T=function(_,O){function L(){switch(W.i){case 1:_(W.j);break;case 2:O(W.j);break;default:throw Error("Unexpected state: "+W.i)}}var W=this;this.h==null?P.i(L):this.h.push(L),this.u=!0},h.resolve=k,h.reject=function(_){return new h(function(O,L){L(_)})},h.race=function(_){return new h(function(O,L){for(var W=a(_),J=W.next();!J.done;J=W.next())k(J.value).T(O,L)})},h.all=function(_){var O=a(_),L=O.next();return L.done?k([]):new h(function(W,J){function oe(ae){return function(de){te[ae]=de,X--,X==0&&W(te)}}var te=[],X=0;do te.push(void 0),X++,k(L.value).T(oe(te.length-1),J),L=O.next();while(!L.done)})},h});function K(l,h){l instanceof String&&(l+="");var p=0,k=!1,w={next:function(){if(!k&&p<l.length){var P=p++;return{value:h(P,l[P]),done:!1}}return k=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}s("Array.prototype.keys",function(l){return l||function(){return K(this,function(h){return h})}}),s("Array.prototype.fill",function(l){return l||function(h,p,k){var w=this.length||0;for(0>p&&(p=Math.max(0,w+p)),(k==null||k>w)&&(k=w),k=Number(k),0>k&&(k=Math.max(0,w+k)),p=Number(p||0);p<k;p++)this[p]=h;return this}});function Y(l){return l||Array.prototype.fill}s("Int8Array.prototype.fill",Y),s("Uint8Array.prototype.fill",Y),s("Uint8ClampedArray.prototype.fill",Y),s("Int16Array.prototype.fill",Y),s("Uint16Array.prototype.fill",Y),s("Int32Array.prototype.fill",Y),s("Uint32Array.prototype.fill",Y),s("Float32Array.prototype.fill",Y),s("Float64Array.prototype.fill",Y),s("Object.is",function(l){return l||function(h,p){return h===p?h!==0||1/h===1/p:h!==h&&p!==p}}),s("Array.prototype.includes",function(l){return l||function(h,p){var k=this;k instanceof String&&(k=String(k));var w=k.length;for(p=p||0,0>p&&(p=Math.max(p+w,0));p<w;p++){var P=k[p];if(P===h||Object.is(P,h))return!0}return!1}}),s("String.prototype.includes",function(l){return l||function(h,p){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(h,p||0)!==-1}});var se=this||self;function le(l,h){l=l.split(".");var p=se;l[0]in p||typeof p.execScript>"u"||p.execScript("var "+l[0]);for(var k;l.length&&(k=l.shift());)l.length||h===void 0?p[k]&&p[k]!==Object.prototype[k]?p=p[k]:p=p[k]={}:p[k]=h}function H(l){var h;e:{if((h=se.navigator)&&(h=h.userAgent))break e;h=""}return h.indexOf(l)!=-1}var re=Array.prototype.map?function(l,h){return Array.prototype.map.call(l,h,void 0)}:function(l,h){for(var p=l.length,k=Array(p),w=typeof l=="string"?l.split(""):l,P=0;P<p;P++)P in w&&(k[P]=h.call(void 0,w[P],P,l));return k},B={},Z=null;function ne(l){var h=l.length,p=3*h/4;p%3?p=Math.floor(p):"=.".indexOf(l[h-1])!=-1&&(p="=.".indexOf(l[h-2])!=-1?p-2:p-1);var k=new Uint8Array(p),w=0;return Te(l,function(P){k[w++]=P}),w!==p?k.subarray(0,w):k}function Te(l,h){function p(L){for(;k<l.length;){var W=l.charAt(k++),J=Z[W];if(J!=null)return J;if(!/^[\s\xa0]*$/.test(W))throw Error("Unknown base64 encoding at char: "+W)}return L}ge();for(var k=0;;){var w=p(-1),P=p(0),_=p(64),O=p(64);if(O===64&&w===-1)break;h(w<<2|P>>4),_!=64&&(h(P<<4&240|_>>2),O!=64&&h(_<<6&192|O))}}function ge(){if(!Z){Z={};for(var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),h=["+/=","+/","-_=","-_.","-_"],p=0;5>p;p++){var k=l.concat(h[p].split(""));B[p]=k;for(var w=0;w<k.length;w++){var P=k[w];Z[P]===void 0&&(Z[P]=w)}}}}var qe=typeof Uint8Array<"u",lt=!(H("Trident")||H("MSIE"))&&typeof se.btoa=="function";function Dt(l){if(!lt){var h;h===void 0&&(h=0),ge(),h=B[h];for(var p=Array(Math.floor(l.length/3)),k=h[64]||"",w=0,P=0;w<l.length-2;w+=3){var _=l[w],O=l[w+1],L=l[w+2],W=h[_>>2];_=h[(_&3)<<4|O>>4],O=h[(O&15)<<2|L>>6],L=h[L&63],p[P++]=W+_+O+L}switch(W=0,L=k,l.length-w){case 2:W=l[w+1],L=h[(W&15)<<2]||k;case 1:l=l[w],p[P]=h[l>>2]+h[(l&3)<<4|W>>4]+L+k}return p.join("")}for(h="";10240<l.length;)h+=String.fromCharCode.apply(null,l.subarray(0,10240)),l=l.subarray(10240);return h+=String.fromCharCode.apply(null,l),btoa(h)}var bt=RegExp("[-_.]","g");function tr(l){switch(l){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function Ih(l){if(!lt)return ne(l);bt.test(l)&&(l=l.replace(bt,tr)),l=atob(l);for(var h=new Uint8Array(l.length),p=0;p<l.length;p++)h[p]=l.charCodeAt(p);return h}var xh;function _c(){return xh||(xh=new Uint8Array(0))}var Qr={},ck=typeof Uint8Array.prototype.slice=="function",Ke=0,pt=0;function Oh(l){var h=0>l;l=Math.abs(l);var p=l>>>0;l=Math.floor((l-p)/4294967296),h&&(p=a(Mh(p,l)),h=p.next().value,l=p.next().value,p=h),Ke=p>>>0,pt=l>>>0}var lk=typeof BigInt=="function";function Mh(l,h){return h=~h,l?l=~l+1:h+=1,[l,h]}function Ah(l,h){this.i=l>>>0,this.h=h>>>0}function Dh(l){if(!l)return Nh||(Nh=new Ah(0,0));if(!/^-?\d+$/.test(l))return null;if(16>l.length)Oh(Number(l));else if(lk)l=BigInt(l),Ke=Number(l&BigInt(4294967295))>>>0,pt=Number(l>>BigInt(32)&BigInt(4294967295));else{var h=+(l[0]==="-");pt=Ke=0;for(var p=l.length,k=h,w=(p-h)%6+h;w<=p;k=w,w+=6)k=Number(l.slice(k,w)),pt*=1e6,Ke=1e6*Ke+k,4294967296<=Ke&&(pt+=Ke/4294967296|0,Ke%=4294967296);h&&(h=a(Mh(Ke,pt)),l=h.next().value,h=h.next().value,Ke=l,pt=h)}return new Ah(Ke,pt)}var Nh;function Lh(l,h){return Error("Invalid wire type: "+l+" (at position "+h+")")}function Pc(){return Error("Failed to read varint, encoding is invalid.")}function Uh(l,h){return Error("Tried to read past the end of the data "+h+" > "+l)}function Oi(){throw Error("Invalid UTF8")}function Fh(l,h){return h=String.fromCharCode.apply(null,h),l==null?h:l+h}var mo=void 0,Rc,uk=typeof TextDecoder<"u",jh,dk=typeof TextEncoder<"u",Bh;function Vh(l){if(l!==Qr)throw Error("illegal external caller")}function Yr(l,h){if(Vh(h),this.V=l,l!=null&&l.length===0)throw Error("ByteString should be constructed with non-empty values")}function Ic(){return Bh||(Bh=new Yr(null,Qr))}function zh(l){Vh(Qr);var h=l.V;return h=h==null||qe&&h!=null&&h instanceof Uint8Array?h:typeof h=="string"?Ih(h):null,h==null?h:l.V=h}function hk(l){if(typeof l=="string")return{buffer:Ih(l),C:!1};if(Array.isArray(l))return{buffer:new Uint8Array(l),C:!1};if(l.constructor===Uint8Array)return{buffer:l,C:!1};if(l.constructor===ArrayBuffer)return{buffer:new Uint8Array(l),C:!1};if(l.constructor===Yr)return{buffer:zh(l)||_c(),C:!0};if(l instanceof Uint8Array)return{buffer:new Uint8Array(l.buffer,l.byteOffset,l.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Wh(l,h){this.i=null,this.m=!1,this.h=this.j=this.l=0,xc(this,l,h)}function xc(l,h,p){p=p===void 0?{}:p,l.S=p.S===void 0?!1:p.S,h&&(h=hk(h),l.i=h.buffer,l.m=h.C,l.l=0,l.j=l.i.length,l.h=l.l)}Wh.prototype.reset=function(){this.h=this.l};function Mi(l,h){if(l.h=h,h>l.j)throw Uh(l.j,h)}function Xr(l){var h=l.i,p=l.h,k=h[p++],w=k&127;if(k&128&&(k=h[p++],w|=(k&127)<<7,k&128&&(k=h[p++],w|=(k&127)<<14,k&128&&(k=h[p++],w|=(k&127)<<21,k&128&&(k=h[p++],w|=k<<28,k&128&&h[p++]&128&&h[p++]&128&&h[p++]&128&&h[p++]&128&&h[p++]&128)))))throw Pc();return Mi(l,p),w}function qh(l,h){if(0>h)throw Error("Tried to read a negative byte length: "+h);var p=l.h,k=p+h;if(k>l.j)throw Uh(h,l.j-p);return l.h=k,p}var Hh=[];function Oc(){this.h=[]}Oc.prototype.length=function(){return this.h.length},Oc.prototype.end=function(){var l=this.h;return this.h=[],l};function Gh(l,h,p){for(;0<p||127<h;)l.h.push(h&127|128),h=(h>>>7|p<<25)>>>0,p>>>=7;l.h.push(h)}function Ai(l,h){for(;127<h;)l.h.push(h&127|128),h>>>=7;l.h.push(h)}function Mc(l,h){if(Hh.length){var p=Hh.pop();xc(p,l,h),l=p}else l=new Wh(l,h);this.h=l,this.j=this.h.h,this.i=this.l=-1,this.setOptions(h)}Mc.prototype.setOptions=function(l){l=l===void 0?{}:l,this.ca=l.ca===void 0?!1:l.ca},Mc.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function Kh(l){var h=l.h;if(h.h==h.j)return!1;l.j=l.h.h;var p=Xr(l.h)>>>0;if(h=p>>>3,p&=7,!(0<=p&&5>=p))throw Lh(p,l.j);if(1>h)throw Error("Invalid field number: "+h+" (at position "+l.j+")");return l.l=h,l.i=p,!0}function go(l){switch(l.i){case 0:if(l.i!=0)go(l);else e:{l=l.h;for(var h=l.h,p=h+10,k=l.i;h<p;)if(!(k[h++]&128)){Mi(l,h);break e}throw Pc()}break;case 1:l=l.h,Mi(l,l.h+8);break;case 2:l.i!=2?go(l):(h=Xr(l.h)>>>0,l=l.h,Mi(l,l.h+h));break;case 5:l=l.h,Mi(l,l.h+4);break;case 3:h=l.l;do{if(!Kh(l))throw Error("Unmatched start-group tag: stream EOF");if(l.i==4){if(l.l!=h)throw Error("Unmatched end-group tag");break}go(l)}while(!0);break;default:throw Lh(l.i,l.j)}}var vo=[];function fk(){this.j=[],this.i=0,this.h=new Oc}function nr(l,h){h.length!==0&&(l.j.push(h),l.i+=h.length)}function pk(l,h){if(h=h.R){nr(l,l.h.end());for(var p=0;p<h.length;p++)nr(l,zh(h[p])||_c())}}var Mn=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Di(l,h){return Mn?l[Mn]|=h:l.A!==void 0?l.A|=h:(Object.defineProperties(l,{A:{value:h,configurable:!0,writable:!0,enumerable:!1}}),h)}function $h(l,h){Mn?l[Mn]&&(l[Mn]&=~h):l.A!==void 0&&(l.A&=~h)}function Ve(l){var h;return Mn?h=l[Mn]:h=l.A,h??0}function mn(l,h){Mn?l[Mn]=h:l.A!==void 0?l.A=h:Object.defineProperties(l,{A:{value:h,configurable:!0,writable:!0,enumerable:!1}})}function Ac(l){return Di(l,1),l}function mk(l,h){mn(h,(l|0)&-51)}function yo(l,h){mn(h,(l|18)&-41)}var Dc={};function ko(l){return l!==null&&typeof l=="object"&&!Array.isArray(l)&&l.constructor===Object}var Zr,Jh=[];mn(Jh,23),Zr=Object.freeze(Jh);function Nc(l){if(Ve(l.o)&2)throw Error("Cannot mutate an immutable Message")}function Lc(l){var h=l.length;(h=h?l[h-1]:void 0)&&ko(h)?h.g=1:(h={},l.push((h.g=1,h)))}function Qh(l){var h=l.i+l.G;return l.B||(l.B=l.o[h]={})}function Xt(l,h){return h===-1?null:h>=l.i?l.B?l.B[h]:void 0:l.o[h+l.G]}function gn(l,h,p,k){Nc(l),es(l,h,p,k)}function es(l,h,p,k){l.j&&(l.j=void 0),h>=l.i||k?Qh(l)[h]=p:(l.o[h+l.G]=p,(l=l.B)&&h in l&&delete l[h])}function Uc(l,h,p,k){var w=Xt(l,h);Array.isArray(w)||(w=Zr);var P=Ve(w);if(P&1||Ac(w),k)P&2||Di(w,2),p&1||Object.freeze(w);else{k=!(p&2);var _=P&2;p&1||!_?k&&P&16&&!_&&$h(w,16):(w=Ac(Array.prototype.slice.call(w)),es(l,h,w))}return w}function Fc(l,h){var p=Xt(l,h),k=p==null?p:typeof p=="number"||p==="NaN"||p==="Infinity"||p==="-Infinity"?Number(p):void 0;return k!=null&&k!==p&&es(l,h,k),k}function Yh(l,h,p,k,w){l.h||(l.h={});var P=l.h[p],_=Uc(l,p,3,w);if(!P){var O=_;P=[];var L=!!(Ve(l.o)&16);_=!!(Ve(O)&2);var W=O;!w&&_&&(O=Array.prototype.slice.call(O));for(var J=_,oe=0;oe<O.length;oe++){var te=O[oe],X=h,ae=!1;if(ae=ae===void 0?!1:ae,te=Array.isArray(te)?new X(te):ae?new X:void 0,te!==void 0){X=te.o;var de=ae=Ve(X);_&&(de|=2),L&&(de|=16),de!=ae&&mn(X,de),X=de,J=J||!!(2&X),P.push(te)}}return l.h[p]=P,L=Ve(O),h=L|33,h=J?h&-9:h|8,L!=h&&(J=O,Object.isFrozen(J)&&(J=Array.prototype.slice.call(J)),mn(J,h),O=J),W!==O&&es(l,p,O),(w||k&&_)&&Di(P,2),k&&Object.freeze(P),P}return w||(w=Object.isFrozen(P),k&&!w?Object.freeze(P):!k&&w&&(P=Array.prototype.slice.call(P),l.h[p]=P)),P}function jc(l,h,p){var k=!!(Ve(l.o)&2);if(h=Yh(l,h,p,k,k),l=Uc(l,p,3,k),!(k||Ve(l)&8)){for(k=0;k<h.length;k++){if(p=h[k],Ve(p.o)&2){var w=rf(p,!1);w.j=p}else w=p;p!==w&&(h[k]=w,l[k]=w.o)}Di(l,8)}return h}function vn(l,h,p){if(p!=null&&typeof p!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof p+": "+p);gn(l,h,p)}function Xh(l,h,p,k,w){Nc(l);var P=Yh(l,p,h,!1,!1);return p=k??new p,l=Uc(l,h,2,!1),w!=null?(P.splice(w,0,p),l.splice(w,0,p.o)):(P.push(p),l.push(p.o)),p.C()&&$h(l,8),p}function So(l,h){return l??h}function yn(l,h,p){return p=p===void 0?0:p,So(Fc(l,h),p)}var To;function gk(l){switch(typeof l){case"number":return isFinite(l)?l:String(l);case"object":if(l)if(Array.isArray(l)){if(Ve(l)&128)return l=Array.prototype.slice.call(l),Lc(l),l}else{if(qe&&l!=null&&l instanceof Uint8Array)return Dt(l);if(l instanceof Yr){var h=l.V;return h==null?"":typeof h=="string"?h:l.V=Dt(h)}}}return l}function Zh(l,h,p,k){if(l!=null){if(Array.isArray(l))l=Bc(l,h,p,k!==void 0);else if(ko(l)){var w={},P;for(P in l)w[P]=Zh(l[P],h,p,k);l=w}else l=h(l,k);return l}}function Bc(l,h,p,k){var w=Ve(l);k=k?!!(w&16):void 0,l=Array.prototype.slice.call(l);for(var P=0;P<l.length;P++)l[P]=Zh(l[P],h,p,k);return p(w,l),l}function vk(l){return l.ja===Dc?l.toJSON():gk(l)}function yk(l,h){l&128&&Lc(h)}function ef(l,h,p){if(p=p===void 0?yo:p,l!=null){if(qe&&l instanceof Uint8Array)return l.length?new Yr(new Uint8Array(l),Qr):Ic();if(Array.isArray(l)){var k=Ve(l);return k&2?l:h&&!(k&32)&&(k&16||k===0)?(mn(l,k|2),l):(l=Bc(l,ef,k&4?yo:p,!0),h=Ve(l),h&4&&h&2&&Object.freeze(l),l)}return l.ja===Dc?nf(l):l}}function tf(l,h,p,k,w,P,_){if(l=l.h&&l.h[p]){if(k=Ve(l),k&2?k=l:(P=re(l,nf),yo(k,P),Object.freeze(P),k=P),Nc(h),_=k==null?Zr:Ac([]),k!=null){for(P=!!k.length,l=0;l<k.length;l++){var O=k[l];P=P&&!(Ve(O.o)&2),_[l]=O.o}P=(P?8:0)|1,l=Ve(_),(l&P)!==P&&(Object.isFrozen(_)&&(_=Array.prototype.slice.call(_)),mn(_,l|P)),h.h||(h.h={}),h.h[p]=k}else h.h&&(h.h[p]=void 0);es(h,p,_,w)}else gn(h,p,ef(k,P,_),w)}function nf(l){return Ve(l.o)&2||(l=rf(l,!0),Di(l.o,2)),l}function rf(l,h){var p=l.o,k=[];Di(k,16);var w=l.constructor.h;if(w&&k.push(w),w=l.B,w){k.length=p.length,k.fill(void 0,k.length,p.length);var P={};k[k.length-1]=P}Ve(p)&128&&Lc(k),h=h||l.C()?yo:mk,P=l.constructor,To=k,k=new P(k),To=void 0,l.R&&(k.R=l.R.slice()),P=!!(Ve(p)&16);for(var _=w?p.length-1:p.length,O=0;O<_;O++)tf(l,k,O-l.G,p[O],!1,P,h);if(w)for(var L in w)tf(l,k,+L,w[L],!0,P,h);return k}function wt(l,h,p){l==null&&(l=To),To=void 0;var k=this.constructor.i||0,w=0<k,P=this.constructor.h,_=!1;if(l==null){l=P?[P]:[];var O=48,L=!0;w&&(k=0,O|=128),mn(l,O)}else{if(!Array.isArray(l)||P&&P!==l[0])throw Error();var W=O=Di(l,0);if((L=(16&W)!==0)&&((_=(32&W)!==0)||(W|=32)),w){if(128&W)k=0;else if(0<l.length){var J=l[l.length-1];if(ko(J)&&"g"in J){k=0,W|=128,delete J.g;var oe=!0,te;for(te in J){oe=!1;break}oe&&l.pop()}}}else if(128&W)throw Error();O!==W&&mn(l,W)}this.G=(P?0:-1)-k,this.h=void 0,this.o=l;e:{if(P=this.o.length,k=P-1,P&&(P=this.o[k],ko(P))){this.B=P,this.i=k-this.G;break e}h!==void 0&&-1<h?(this.i=Math.max(h,k+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!w&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(p){h=L&&!_&&!0,w=this.i;var X;for(L=0;L<p.length;L++)_=p[L],_<w?(_+=this.G,(k=l[_])?sf(k,h):l[_]=Zr):(X||(X=Qh(this)),(k=X[_])?sf(k,h):X[_]=Zr)}}wt.prototype.toJSON=function(){return Bc(this.o,vk,yk)},wt.prototype.C=function(){return!!(Ve(this.o)&2)};function sf(l,h){if(Array.isArray(l)){var p=Ve(l),k=1;!h||p&2||(k|=16),(p&k)!==k&&mn(l,p|k)}}wt.prototype.ja=Dc,wt.prototype.toString=function(){return this.o.toString()};function of(l,h,p){if(p){var k={},w;for(w in p){var P=p[w],_=P.ra;_||(k.J=P.xa||P.oa.W,P.ia?(k.aa=df(P.ia),_=function(O){return function(L,W,J){return O.J(L,W,J,O.aa)}}(k)):P.ka?(k.Z=hf(P.da.P,P.ka),_=function(O){return function(L,W,J){return O.J(L,W,J,O.Z)}}(k)):_=k.J,P.ra=_),_(h,l,P.da),k={J:k.J,aa:k.aa,Z:k.Z}}}pk(h,l)}var Co=Symbol();function af(l,h,p){return l[Co]||(l[Co]=function(k,w){return h(k,w,p)})}function cf(l){var h=l[Co];if(!h){var p=zc(l);h=function(k,w){return ff(k,w,p)},l[Co]=h}return h}function kk(l){var h=l.ia;if(h)return cf(h);if(h=l.wa)return af(l.da.P,h,l.ka)}function Sk(l){var h=kk(l),p=l.da,k=l.oa.U;return h?function(w,P){return k(w,P,p,h)}:function(w,P){return k(w,P,p)}}function lf(l,h){var p=l[h];return typeof p=="function"&&p.length===0&&(p=p(),l[h]=p),Array.isArray(p)&&(ns in p||ts in p||0<p.length&&typeof p[0]=="function")?p:void 0}function uf(l,h,p,k,w,P){h.P=l[0];var _=1;if(l.length>_&&typeof l[_]!="number"){var O=l[_++];p(h,O)}for(;_<l.length;){p=l[_++];for(var L=_+1;L<l.length&&typeof l[L]!="number";)L++;switch(O=l[_++],L-=_,L){case 0:k(h,p,O);break;case 1:(L=lf(l,_))?(_++,w(h,p,O,L)):k(h,p,O,l[_++]);break;case 2:L=_++,L=lf(l,L),w(h,p,O,L,l[_++]);break;case 3:P(h,p,O,l[_++],l[_++],l[_++]);break;case 4:P(h,p,O,l[_++],l[_++],l[_++],l[_++]);break;default:throw Error("unexpected number of binary field arguments: "+L)}}return h}var bo=Symbol();function df(l){var h=l[bo];if(!h){var p=Vc(l);h=function(k,w){return pf(k,w,p)},l[bo]=h}return h}function hf(l,h){var p=l[bo];return p||(p=function(k,w){return of(k,w,h)},l[bo]=p),p}var ts=Symbol();function Tk(l,h){l.push(h)}function Ck(l,h,p){l.push(h,p.W)}function bk(l,h,p,k){var w=df(k),P=Vc(k).P,_=p.W;l.push(h,function(O,L,W){return _(O,L,W,P,w)})}function wk(l,h,p,k,w,P){var _=hf(k,P),O=p.W;l.push(h,function(L,W,J){return O(L,W,J,k,_)})}function Vc(l){var h=l[ts];return h||(h=uf(l,l[ts]=[],Tk,Ck,bk,wk),ns in l&&ts in l&&(l.length=0),h)}var ns=Symbol();function Ek(l,h){l[0]=h}function _k(l,h,p,k){var w=p.U;l[h]=k?function(P,_,O){return w(P,_,O,k)}:w}function Pk(l,h,p,k,w){var P=p.U,_=cf(k),O=zc(k).P;l[h]=function(L,W,J){return P(L,W,J,O,_,w)}}function Rk(l,h,p,k,w,P,_){var O=p.U,L=af(k,w,P);l[h]=function(W,J,oe){return O(W,J,oe,k,L,_)}}function zc(l){var h=l[ns];return h||(h=uf(l,l[ns]={},Ek,_k,Pk,Rk),ns in l&&ts in l&&(l.length=0),h)}function ff(l,h,p){for(;Kh(h)&&h.i!=4;){var k=h.l,w=p[k];if(!w){var P=p[0];P&&(P=P[k])&&(w=p[k]=Sk(P))}if(!w||!w(h,l,k)){w=h,k=l,P=w.j,go(w);var _=w;if(!_.ca){if(w=_.h.h-P,_.h.h=P,_=_.h,w==0)w=Ic();else{if(P=qh(_,w),_.S&&_.m)w=_.i.subarray(P,P+w);else{_=_.i;var O=P;w=P+w,w=O===w?_c():ck?_.slice(O,w):new Uint8Array(_.subarray(O,w))}w=w.length==0?Ic():new Yr(w,Qr)}(P=k.R)?P.push(w):k.R=[w]}}}return l}function pf(l,h,p){for(var k=p.length,w=k%2==1,P=w?1:0;P<k;P+=2)(0,p[P+1])(h,l,p[P]);of(l,h,w?p[0]:void 0)}function is(l,h){return{U:l,W:h}}var Zt=is(function(l,h,p){if(l.i!==5)return!1;l=l.h;var k=l.i,w=l.h,P=k[w],_=k[w+1],O=k[w+2];return k=k[w+3],Mi(l,l.h+4),_=(P<<0|_<<8|O<<16|k<<24)>>>0,l=2*(_>>31)+1,P=_>>>23&255,_&=8388607,gn(h,p,P==255?_?NaN:1/0*l:P==0?l*Math.pow(2,-149)*_:l*Math.pow(2,P-150)*(_+Math.pow(2,23))),!0},function(l,h,p){if(h=Fc(h,p),h!=null){Ai(l.h,8*p+5),l=l.h;var k=+h;k===0?0<1/k?Ke=pt=0:(pt=0,Ke=2147483648):isNaN(k)?(pt=0,Ke=2147483647):(k=(p=0>k?-2147483648:0)?-k:k,34028234663852886e22<k?(pt=0,Ke=(p|2139095040)>>>0):11754943508222875e-54>k?(k=Math.round(k/Math.pow(2,-149)),pt=0,Ke=(p|k)>>>0):(h=Math.floor(Math.log(k)/Math.LN2),k*=Math.pow(2,-h),k=Math.round(8388608*k),16777216<=k&&++h,pt=0,Ke=(p|h+127<<23|k&8388607)>>>0)),p=Ke,l.h.push(p>>>0&255),l.h.push(p>>>8&255),l.h.push(p>>>16&255),l.h.push(p>>>24&255)}}),Ik=is(function(l,h,p){if(l.i!==0)return!1;var k=l.h,w=0,P=l=0,_=k.i,O=k.h;do{var L=_[O++];w|=(L&127)<<P,P+=7}while(32>P&&L&128);for(32<P&&(l|=(L&127)>>4),P=3;32>P&&L&128;P+=7)L=_[O++],l|=(L&127)<<P;if(Mi(k,O),128>L)k=w>>>0,L=l>>>0,(l=L&2147483648)&&(k=~k+1>>>0,L=~L>>>0,k==0&&(L=L+1>>>0)),k=4294967296*L+(k>>>0);else throw Pc();return gn(h,p,l?-k:k),!0},function(l,h,p){h=Xt(h,p),h!=null&&(typeof h=="string"&&Dh(h),h!=null&&(Ai(l.h,8*p),typeof h=="number"?(l=l.h,Oh(h),Gh(l,Ke,pt)):(p=Dh(h),Gh(l.h,p.i,p.h))))}),xk=is(function(l,h,p){return l.i!==0?!1:(gn(h,p,Xr(l.h)),!0)},function(l,h,p){if(h=Xt(h,p),h!=null&&h!=null)if(Ai(l.h,8*p),l=l.h,p=h,0<=p)Ai(l,p);else{for(h=0;9>h;h++)l.h.push(p&127|128),p>>=7;l.h.push(1)}}),mf=is(function(l,h,p){if(l.i!==2)return!1;var k=Xr(l.h)>>>0;l=l.h;var w=qh(l,k);if(l=l.i,uk){var P=l,_;(_=Rc)||(_=Rc=new TextDecoder("utf-8",{fatal:!0})),l=w+k,P=w===0&&l===P.length?P:P.subarray(w,l);try{var O=_.decode(P)}catch(oe){if(mo===void 0){try{_.decode(new Uint8Array([128]))}catch{}try{_.decode(new Uint8Array([97])),mo=!0}catch{mo=!1}}throw!mo&&(Rc=void 0),oe}}else{O=w,k=O+k,w=[];for(var L=null,W,J;O<k;)W=l[O++],128>W?w.push(W):224>W?O>=k?Oi():(J=l[O++],194>W||(J&192)!==128?(O--,Oi()):w.push((W&31)<<6|J&63)):240>W?O>=k-1?Oi():(J=l[O++],(J&192)!==128||W===224&&160>J||W===237&&160<=J||((P=l[O++])&192)!==128?(O--,Oi()):w.push((W&15)<<12|(J&63)<<6|P&63)):244>=W?O>=k-2?Oi():(J=l[O++],(J&192)!==128||(W<<28)+(J-144)>>30||((P=l[O++])&192)!==128||((_=l[O++])&192)!==128?(O--,Oi()):(W=(W&7)<<18|(J&63)<<12|(P&63)<<6|_&63,W-=65536,w.push((W>>10&1023)+55296,(W&1023)+56320))):Oi(),8192<=w.length&&(L=Fh(L,w),w.length=0);O=Fh(L,w)}return gn(h,p,O),!0},function(l,h,p){if(h=Xt(h,p),h!=null){var k=!1;if(k=k===void 0?!1:k,dk){if(k&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(h))throw Error("Found an unpaired surrogate");h=(jh||(jh=new TextEncoder)).encode(h)}else{for(var w=0,P=new Uint8Array(3*h.length),_=0;_<h.length;_++){var O=h.charCodeAt(_);if(128>O)P[w++]=O;else{if(2048>O)P[w++]=O>>6|192;else{if(55296<=O&&57343>=O){if(56319>=O&&_<h.length){var L=h.charCodeAt(++_);if(56320<=L&&57343>=L){O=1024*(O-55296)+L-56320+65536,P[w++]=O>>18|240,P[w++]=O>>12&63|128,P[w++]=O>>6&63|128,P[w++]=O&63|128;continue}else _--}if(k)throw Error("Found an unpaired surrogate");O=65533}P[w++]=O>>12|224,P[w++]=O>>6&63|128}P[w++]=O&63|128}}h=w===P.length?P:P.subarray(0,w)}Ai(l.h,8*p+2),Ai(l.h,h.length),nr(l,l.h.end()),nr(l,h)}}),gf=is(function(l,h,p,k,w){if(l.i!==2)return!1;h=Xh(h,p,k),p=l.h.j,k=Xr(l.h)>>>0;var P=l.h.h+k,_=P-p;if(0>=_&&(l.h.j=P,w(h,l,void 0,void 0,void 0),_=P-l.h.h),_)throw Error("Message parsing ended unexpectedly. Expected to read "+(k+" bytes, instead read "+(k-_)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return l.h.h=P,l.h.j=p,!0},function(l,h,p,k,w){if(h=jc(h,k,p),h!=null)for(k=0;k<h.length;k++){var P=l;Ai(P.h,8*p+2);var _=P.h.end();nr(P,_),_.push(P.i),P=_,w(h[k],l),_=l;var O=P.pop();for(O=_.i+_.h.length()-O;127<O;)P.push(O&127|128),O>>>=7,_.i++;P.push(O),_.i++}});function Wc(l){return function(h,p){e:{if(vo.length){var k=vo.pop();k.setOptions(p),xc(k.h,h,p),h=k}else h=new Mc(h,p);try{var w=zc(l),P=ff(new w.P,h,w);break e}finally{w=h.h,w.i=null,w.m=!1,w.l=0,w.j=0,w.h=0,w.S=!1,h.l=-1,h.i=-1,100>vo.length&&vo.push(h)}P=void 0}return P}}function qc(l){return function(){var h=new fk;pf(this,h,Vc(l)),nr(h,h.h.end());for(var p=new Uint8Array(h.i),k=h.j,w=k.length,P=0,_=0;_<w;_++){var O=k[_];p.set(O,P),P+=O.length}return h.j=[p],p}}function ir(l){wt.call(this,l)}E(ir,wt);var vf=[ir,1,xk,2,Zt,3,mf,4,mf];ir.prototype.l=qc(vf);function Hc(l){wt.call(this,l,-1,Ok)}E(Hc,wt),Hc.prototype.addClassification=function(l,h){return Xh(this,1,ir,l,h),this};var Ok=[1],Mk=Wc([Hc,1,gf,vf]);function rs(l){wt.call(this,l)}E(rs,wt);var yf=[rs,1,Zt,2,Zt,3,Zt,4,Zt,5,Zt];rs.prototype.l=qc(yf);function kf(l){wt.call(this,l,-1,Ak)}E(kf,wt);var Ak=[1],Dk=Wc([kf,1,gf,yf]);function wo(l){wt.call(this,l)}E(wo,wt);var Sf=[wo,1,Zt,2,Zt,3,Zt,4,Zt,5,Zt,6,Ik],Nk=Wc(Sf);wo.prototype.l=qc(Sf);function Tf(l,h,p){if(p=l.createShader(p===0?l.VERTEX_SHADER:l.FRAGMENT_SHADER),l.shaderSource(p,h),l.compileShader(p),!l.getShaderParameter(p,l.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+l.getShaderInfoLog(p));return p}function Lk(l){return jc(l,ir,1).map(function(h){var p=Xt(h,1);return{index:p??0,qa:yn(h,2),label:Xt(h,3)!=null?So(Xt(h,3),""):void 0,displayName:Xt(h,4)!=null?So(Xt(h,4),""):void 0}})}function Uk(l){return{x:yn(l,1),y:yn(l,2),z:yn(l,3),visibility:Fc(l,4)!=null?yn(l,4):void 0}}function Gc(l){return jc(Dk(l),rs,1).map(Uk)}function Kc(l,h){this.i=l,this.h=h,this.m=0}function Cf(l,h,p){return Fk(l,h),typeof l.h.canvas.transferToImageBitmap=="function"?Promise.resolve(l.h.canvas.transferToImageBitmap()):p?Promise.resolve(l.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(l.h.canvas):(l.j===void 0&&(l.j=document.createElement("canvas")),new Promise(function(k){l.j.height=l.h.canvas.height,l.j.width=l.h.canvas.width,l.j.getContext("2d",{}).drawImage(l.h.canvas,0,0,l.h.canvas.width,l.h.canvas.height),k(l.j)}))}function Fk(l,h){var p=l.h;if(l.s===void 0){var k=Tf(p,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),w=Tf(p,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),P=p.createProgram();if(p.attachShader(P,k),p.attachShader(P,w),p.linkProgram(P),!p.getProgramParameter(P,p.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+p.getProgramInfoLog(P));k=l.s=P,p.useProgram(k),w=p.getUniformLocation(k,"sampler0"),l.l={O:p.getAttribLocation(k,"aVertex"),N:p.getAttribLocation(k,"aTex"),ya:w},l.v=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,l.v),p.enableVertexAttribArray(l.l.O),p.vertexAttribPointer(l.l.O,2,p.FLOAT,!1,0,0),p.bufferData(p.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),p.STATIC_DRAW),p.bindBuffer(p.ARRAY_BUFFER,null),l.u=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,l.u),p.enableVertexAttribArray(l.l.N),p.vertexAttribPointer(l.l.N,2,p.FLOAT,!1,0,0),p.bufferData(p.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),p.STATIC_DRAW),p.bindBuffer(p.ARRAY_BUFFER,null),p.uniform1i(w,0)}k=l.l,p.useProgram(l.s),p.canvas.width=h.width,p.canvas.height=h.height,p.viewport(0,0,h.width,h.height),p.activeTexture(p.TEXTURE0),l.i.bindTexture2d(h.glName),p.enableVertexAttribArray(k.O),p.bindBuffer(p.ARRAY_BUFFER,l.v),p.vertexAttribPointer(k.O,2,p.FLOAT,!1,0,0),p.enableVertexAttribArray(k.N),p.bindBuffer(p.ARRAY_BUFFER,l.u),p.vertexAttribPointer(k.N,2,p.FLOAT,!1,0,0),p.bindFramebuffer(p.DRAW_FRAMEBUFFER?p.DRAW_FRAMEBUFFER:p.FRAMEBUFFER,null),p.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT),p.colorMask(!0,!0,!0,!0),p.drawArrays(p.TRIANGLE_FAN,0,4),p.disableVertexAttribArray(k.O),p.disableVertexAttribArray(k.N),p.bindBuffer(p.ARRAY_BUFFER,null),l.i.bindTexture2d(0)}function jk(l){this.h=l}var Bk=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Vk(l,h){return h+l}function bf(l,h){window[l]=h}function zk(l){var h=document.createElement("script");return h.setAttribute("src",l),h.setAttribute("crossorigin","anonymous"),new Promise(function(p){h.addEventListener("load",function(){p()},!1),h.addEventListener("error",function(){p()},!1),document.body.appendChild(h)})}function Wk(){return M(function(l){switch(l.h){case 1:return l.s=2,C(l,WebAssembly.instantiate(Bk),4);case 4:l.h=3,l.s=0;break;case 2:return l.s=0,l.l=null,l.return(!1);case 3:return l.return(!0)}})}function $c(l){if(this.h=l,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=l&&l.locateFile||Vk,typeof window=="object")var h=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")h=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=h,l.options){h=a(Object.keys(l.options));for(var p=h.next();!p.done;p=h.next()){p=p.value;var k=l.options[p].default;k!==void 0&&(this.l[p]=typeof k=="function"?k():k)}}}t=$c.prototype,t.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function qk(l){var h,p,k,w,P,_,O,L,W,J,oe;return M(function(te){switch(te.h){case 1:return l.ga?(h=l.h.files===void 0?[]:typeof l.h.files=="function"?l.h.files(l.l):l.h.files,C(te,Wk(),2)):te.return();case 2:if(p=te.i,typeof window=="object")return bf("createMediapipeSolutionsWasm",{locateFile:l.locateFile}),bf("createMediapipeSolutionsPackedAssets",{locateFile:l.locateFile}),_=h.filter(function(X){return X.data!==void 0}),O=h.filter(function(X){return X.data===void 0}),L=Promise.all(_.map(function(X){var ae=Eo(l,X.url);if(X.path!==void 0){var de=X.path;ae=ae.then(function(Re){return l.overrideFile(de,Re),Promise.resolve(Re)})}return ae})),W=Promise.all(O.map(function(X){return X.simd===void 0||X.simd&&p||!X.simd&&!p?zk(l.locateFile(X.url,l.ha)):Promise.resolve()})).then(function(){var X,ae,de;return M(function(Re){if(Re.h==1)return X=window.createMediapipeSolutionsWasm,ae=window.createMediapipeSolutionsPackedAssets,de=l,C(Re,X(ae),2);de.i=Re.i,Re.h=0})}),J=function(){return M(function(X){return l.h.graph&&l.h.graph.url?X=C(X,Eo(l,l.h.graph.url),0):(X.h=0,X=void 0),X})}(),C(te,Promise.all([W,L,J]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return k=h.filter(function(X){return X.simd===void 0||X.simd&&p||!X.simd&&!p}).map(function(X){return l.locateFile(X.url,l.ha)}),importScripts.apply(null,c(k)),w=l,C(te,createMediapipeSolutionsWasm(Module),6);case 6:w.i=te.i,l.m=new OffscreenCanvas(1,1),l.i.canvas=l.m,P=l.i.GL.createContext(l.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),l.i.GL.makeContextCurrent(P),te.h=4;break;case 7:if(l.m=document.createElement("canvas"),oe=l.m.getContext("webgl2",{}),!oe&&(oe=l.m.getContext("webgl",{}),!oe))return alert("Failed to create WebGL canvas context when passing video frame."),te.return();l.K=oe,l.i.canvas=l.m,l.i.createContext(l.m,!0,!0,{});case 4:l.j=new l.i.SolutionWasm,l.ga=!1,te.h=0}})}function Hk(l){var h,p,k,w,P,_,O,L;return M(function(W){if(W.h==1){if(l.h.graph&&l.h.graph.url&&l.fa===l.h.graph.url)return W.return();if(l.u=!0,!l.h.graph||!l.h.graph.url){W.h=2;return}return l.fa=l.h.graph.url,C(W,Eo(l,l.h.graph.url),3)}for(W.h!=2&&(h=W.i,l.j.loadGraph(h)),p=a(Object.keys(l.D)),k=p.next();!k.done;k=p.next())w=k.value,l.j.overrideFile(w,l.D[w]);if(l.D={},l.h.listeners)for(P=a(l.h.listeners),_=P.next();!_.done;_=P.next())O=_.value,Jk(l,O);L=l.l,l.l={},l.setOptions(L),W.h=0})}t.reset=function(){var l=this;return M(function(h){l.j&&(l.j.reset(),l.s={},l.v={}),h.h=0})},t.setOptions=function(l,h){var p=this;if(h=h||this.h.options){for(var k=[],w=[],P={},_=a(Object.keys(l)),O=_.next();!O.done;P={X:P.X,Y:P.Y},O=_.next())if(O=O.value,!(O in this.l&&this.l[O]===l[O])){this.l[O]=l[O];var L=h[O];L!==void 0&&(L.onChange&&(P.X=L.onChange,P.Y=l[O],k.push(function(W){return function(){var J;return M(function(oe){if(oe.h==1)return C(oe,W.X(W.Y),2);J=oe.i,J===!0&&(p.u=!0),oe.h=0})}}(P))),L.graphOptionXref&&(O=Object.assign({},{calculatorName:"",calculatorIndex:0},L.graphOptionXref,{valueNumber:L.type===1?l[O]:0,valueBoolean:L.type===0?l[O]:!1,valueString:L.type===2?l[O]:""}),w.push(O)))}(k.length!==0||w.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(w),this.F=(this.F===void 0?[]:this.F).concat(k))}};function Gk(l){var h,p,k,w,P,_,O;return M(function(L){switch(L.h){case 1:if(!l.u)return L.return();if(!l.F){L.h=2;break}h=a(l.F),p=h.next();case 3:if(p.done){L.h=5;break}return k=p.value,C(L,k(),4);case 4:p=h.next(),L.h=3;break;case 5:l.F=void 0;case 2:if(l.H){for(w=new l.i.GraphOptionChangeRequestList,P=a(l.H),_=P.next();!_.done;_=P.next())O=_.value,w.push_back(O);l.j.changeOptions(w),w.delete(),l.H=void 0}l.u=!1,L.h=0}})}t.initialize=function(){var l=this;return M(function(h){return h.h==1?C(h,qk(l),2):h.h!=3?C(h,Hk(l),3):C(h,Gk(l),0)})};function Eo(l,h){var p,k;return M(function(w){return h in l.L?w.return(l.L[h]):(p=l.locateFile(h,""),k=fetch(p).then(function(P){return P.arrayBuffer()}),l.L[h]=k,w.return(k))})}t.overrideFile=function(l,h){this.j?this.j.overrideFile(l,h):this.D[l]=h},t.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},t.send=function(l,h){var p=this,k,w,P,_,O,L,W,J,oe;return M(function(te){switch(te.h){case 1:return p.h.inputs?(k=1e3*(h??performance.now()),C(te,p.I,2)):te.return();case 2:return C(te,p.initialize(),3);case 3:for(w=new p.i.PacketDataList,P=a(Object.keys(l)),_=P.next();!_.done;_=P.next())if(O=_.value,L=p.h.inputs[O]){e:{var X=l[O];switch(L.type){case"video":var ae=p.s[L.stream];if(ae||(ae=new Kc(p.i,p.K),p.s[L.stream]=ae),ae.m===0&&(ae.m=ae.i.createTexture()),typeof HTMLVideoElement<"u"&&X instanceof HTMLVideoElement)var de=X.videoWidth,Re=X.videoHeight;else typeof HTMLImageElement<"u"&&X instanceof HTMLImageElement?(de=X.naturalWidth,Re=X.naturalHeight):(de=X.width,Re=X.height);Re={glName:ae.m,width:de,height:Re},de=ae.h,de.canvas.width=Re.width,de.canvas.height=Re.height,de.activeTexture(de.TEXTURE0),ae.i.bindTexture2d(ae.m),de.texImage2D(de.TEXTURE_2D,0,de.RGBA,de.RGBA,de.UNSIGNED_BYTE,X),ae.i.bindTexture2d(0),ae=Re;break e;case"detections":for(ae=p.s[L.stream],ae||(ae=new jk(p.i),p.s[L.stream]=ae),ae.data||(ae.data=new ae.h.DetectionListData),ae.data.reset(X.length),Re=0;Re<X.length;++Re){de=X[Re];var _e=ae.data,nt=_e.setBoundingBox,zt=Re,Et=de.la,ke=new wo;if(vn(ke,1,Et.sa),vn(ke,2,Et.ta),vn(ke,3,Et.height),vn(ke,4,Et.width),vn(ke,5,Et.rotation),gn(ke,6,Et.pa),Et=ke.l(),nt.call(_e,zt,Et),de.ea)for(_e=0;_e<de.ea.length;++_e){ke=de.ea[_e],nt=ae.data,zt=nt.addNormalizedLandmark,Et=Re,ke=Object.assign({},ke,{visibility:ke.visibility?ke.visibility:0});var it=new rs;vn(it,1,ke.x),vn(it,2,ke.y),vn(it,3,ke.z),ke.visibility&&vn(it,4,ke.visibility),ke=it.l(),zt.call(nt,Et,ke)}if(de.ba)for(_e=0;_e<de.ba.length;++_e)nt=ae.data,zt=nt.addClassification,Et=Re,ke=de.ba[_e],it=new ir,vn(it,2,ke.qa),ke.index&&gn(it,1,ke.index),ke.label&&gn(it,3,ke.label),ke.displayName&&gn(it,4,ke.displayName),ke=it.l(),zt.call(nt,Et,ke)}ae=ae.data;break e;default:ae={}}}switch(W=ae,J=L.stream,L.type){case"video":w.pushTexture2d(Object.assign({},W,{stream:J,timestamp:k}));break;case"detections":oe=W,oe.stream=J,oe.timestamp=k,w.pushDetectionList(oe);break;default:throw Error("Unknown input config type: '"+L.type+"'")}}return p.j.send(w),C(te,p.I,4);case 4:w.delete(),te.h=0}})};function Kk(l,h,p){var k,w,P,_,O,L,W,J,oe,te,X,ae,de,Re;return M(function(_e){switch(_e.h){case 1:if(!p)return _e.return(h);for(k={},w=0,P=a(Object.keys(p)),_=P.next();!_.done;_=P.next())O=_.value,L=p[O],typeof L!="string"&&L.type==="texture"&&h[L.stream]!==void 0&&++w;1<w&&(l.M=!1),W=a(Object.keys(p)),_=W.next();case 2:if(_.done){_e.h=4;break}if(J=_.value,oe=p[J],typeof oe=="string")return de=k,Re=J,C(_e,$k(l,J,h[oe]),14);if(te=h[oe.stream],oe.type==="detection_list"){if(te){for(var nt=te.getRectList(),zt=te.getLandmarksList(),Et=te.getClassificationsList(),ke=[],it=0;it<nt.size();++it){var Xn=Nk(nt.get(it)),Qk=yn(Xn,1),Yk=yn(Xn,2),Xk=yn(Xn,3),Zk=yn(Xn,4),eS=yn(Xn,5,0),_o=void 0;_o=_o===void 0?0:_o,Xn={la:{sa:Qk,ta:Yk,height:Xk,width:Zk,rotation:eS,pa:So(Xt(Xn,6),_o)},ea:Gc(zt.get(it)),ba:Lk(Mk(Et.get(it)))},ke.push(Xn)}nt=ke}else nt=[];k[J]=nt,_e.h=7;break}if(oe.type==="proto_list"){if(te){for(nt=Array(te.size()),zt=0;zt<te.size();zt++)nt[zt]=te.get(zt);te.delete()}else nt=[];k[J]=nt,_e.h=7;break}if(te===void 0){_e.h=3;break}if(oe.type==="float_list"){k[J]=te,_e.h=7;break}if(oe.type==="proto"){k[J]=te,_e.h=7;break}if(oe.type!=="texture")throw Error("Unknown output config type: '"+oe.type+"'");return X=l.v[J],X||(X=new Kc(l.i,l.K),l.v[J]=X),C(_e,Cf(X,te,l.M),13);case 13:ae=_e.i,k[J]=ae;case 7:oe.transform&&k[J]&&(k[J]=oe.transform(k[J])),_e.h=3;break;case 14:de[Re]=_e.i;case 3:_=W.next(),_e.h=2;break;case 4:return _e.return(k)}})}function $k(l,h,p){var k;return M(function(w){return typeof p=="number"||p instanceof Uint8Array||p instanceof l.i.Uint8BlobList?w.return(p):p instanceof l.i.Texture2dDataOut?(k=l.v[h],k||(k=new Kc(l.i,l.K),l.v[h]=k),w.return(Cf(k,p,l.M))):w.return(void 0)})}function Jk(l,h){for(var p=h.name||"$",k=[].concat(c(h.wants)),w=new l.i.StringList,P=a(h.wants),_=P.next();!_.done;_=P.next())w.push_back(_.value);P=l.i.PacketListener.implement({onResults:function(O){for(var L={},W=0;W<h.wants.length;++W)L[k[W]]=O.get(W);var J=l.listeners[p];J&&(l.I=Kk(l,L,h.outs).then(function(oe){oe=J(oe);for(var te=0;te<h.wants.length;++te){var X=L[k[te]];typeof X=="object"&&X.hasOwnProperty&&X.hasOwnProperty("delete")&&X.delete()}oe&&(l.I=oe)}))}}),l.j.attachMultiListener(w,P),w.delete()}t.onResults=function(l,h){this.listeners[h||"$"]=l},le("Solution",$c),le("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function wf(l){switch(l===void 0&&(l=0),l){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Ef(l){var h=this;l=l||{},this.h=new $c({locateFile:l.locateFile,files:function(p){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:wf(p.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:Gc},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:Gc},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(p){var k,w,P;return M(function(_){return _.h==1?(k=wf(p),w="third_party/mediapipe/modules/pose_landmark/"+k,C(_,Eo(h.h,k),2)):(P=_.i,h.h.overrideFile(w,P),_.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}t=Ef.prototype,t.reset=function(){this.h.reset()},t.close=function(){return this.h.close(),Promise.resolve()},t.onResults=function(l){this.h.onResults(l)},t.initialize=function(){var l=this;return M(function(h){return C(h,l.h.initialize(),0)})},t.send=function(l,h){var p=this;return M(function(k){return C(k,p.h.send(l,h),0)})},t.setOptions=function(l){this.h.setOptions(l)},le("Pose",Ef),le("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),le("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),le("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),le("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),le("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),le("VERSION","0.5.1675469404")}).call(wn);var xC={};(function(){function t(R){var M=0;return function(){return M<R.length?{done:!1,value:R[M++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(R,M,K){return R==Array.prototype||R==Object.prototype||(R[M]=K.value),R};function n(R){R=[typeof globalThis=="object"&&globalThis,R,typeof window=="object"&&window,typeof self=="object"&&self,typeof wn=="object"&&wn];for(var M=0;M<R.length;++M){var K=R[M];if(K&&K.Math==Math)return K}throw Error("Cannot find global object")}var i=n(this);function r(R,M){if(M)e:{var K=i;R=R.split(".");for(var Y=0;Y<R.length-1;Y++){var se=R[Y];if(!(se in K))break e;K=K[se]}R=R[R.length-1],Y=K[R],M=M(Y),M!=Y&&M!=null&&e(K,R,{configurable:!0,writable:!0,value:M})}}r("Symbol",function(R){function M(le){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new K(Y+(le||"")+"_"+se++,le)}function K(le,H){this.g=le,e(this,"description",{configurable:!0,writable:!0,value:H})}if(R)return R;K.prototype.toString=function(){return this.g};var Y="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",se=0;return M}),r("Symbol.iterator",function(R){if(R)return R;R=Symbol("Symbol.iterator");for(var M="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),K=0;K<M.length;K++){var Y=i[M[K]];typeof Y=="function"&&typeof Y.prototype[R]!="function"&&e(Y.prototype,R,{configurable:!0,writable:!0,value:function(){return s(t(this))}})}return R});function s(R){return R={next:R},R[Symbol.iterator]=function(){return this},R}function o(R){var M=typeof Symbol<"u"&&Symbol.iterator&&R[Symbol.iterator];return M?M.call(R):{next:t(R)}}function a(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function c(R){if(R.i)throw new TypeError("Generator is already running");R.i=!0}a.prototype.l=function(R){this.o=R};function u(R,M){R.h={F:M,G:!0},R.j=R.m}a.prototype.return=function(R){this.h={return:R},this.j=this.m};function d(R){this.g=new a,this.h=R}function f(R,M){c(R.g);var K=R.g.g;return K?m(R,"return"in K?K.return:function(Y){return{value:Y,done:!0}},M,R.g.return):(R.g.return(M),S(R))}function m(R,M,K,Y){try{var se=M.call(R.g.g,K);if(!(se instanceof Object))throw new TypeError("Iterator result "+se+" is not an object");if(!se.done)return R.g.i=!1,se;var le=se.value}catch(H){return R.g.g=null,u(R.g,H),S(R)}return R.g.g=null,Y.call(R.g,le),S(R)}function S(R){for(;R.g.j;)try{var M=R.h(R.g);if(M)return R.g.i=!1,{value:M.value,done:!1}}catch(K){R.g.o=void 0,u(R.g,K)}if(R.g.i=!1,R.g.h){if(M=R.g.h,R.g.h=null,M.G)throw M.F;return{value:M.return,done:!0}}return{value:void 0,done:!0}}function y(R){this.next=function(M){return c(R.g),R.g.g?M=m(R,R.g.g.next,M,R.g.l):(R.g.l(M),M=S(R)),M},this.throw=function(M){return c(R.g),R.g.g?M=m(R,R.g.g.throw,M,R.g.l):(u(R.g,M),M=S(R)),M},this.return=function(M){return f(R,M)},this[Symbol.iterator]=function(){return this}}function g(R){function M(Y){return R.next(Y)}function K(Y){return R.throw(Y)}return new Promise(function(Y,se){function le(H){H.done?Y(H.value):Promise.resolve(H.value).then(M,K).then(le,se)}le(R.next())})}r("Promise",function(R){function M(H){this.h=0,this.i=void 0,this.g=[],this.o=!1;var re=this.j();try{H(re.resolve,re.reject)}catch(B){re.reject(B)}}function K(){this.g=null}function Y(H){return H instanceof M?H:new M(function(re){re(H)})}if(R)return R;K.prototype.h=function(H){if(this.g==null){this.g=[];var re=this;this.i(function(){re.l()})}this.g.push(H)};var se=i.setTimeout;K.prototype.i=function(H){se(H,0)},K.prototype.l=function(){for(;this.g&&this.g.length;){var H=this.g;this.g=[];for(var re=0;re<H.length;++re){var B=H[re];H[re]=null;try{B()}catch(Z){this.j(Z)}}}this.g=null},K.prototype.j=function(H){this.i(function(){throw H})},M.prototype.j=function(){function H(Z){return function(ne){B||(B=!0,Z.call(re,ne))}}var re=this,B=!1;return{resolve:H(this.A),reject:H(this.l)}},M.prototype.A=function(H){if(H===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(H instanceof M)this.C(H);else{e:switch(typeof H){case"object":var re=H!=null;break e;case"function":re=!0;break e;default:re=!1}re?this.v(H):this.m(H)}},M.prototype.v=function(H){var re=void 0;try{re=H.then}catch(B){this.l(B);return}typeof re=="function"?this.D(re,H):this.m(H)},M.prototype.l=function(H){this.u(2,H)},M.prototype.m=function(H){this.u(1,H)},M.prototype.u=function(H,re){if(this.h!=0)throw Error("Cannot settle("+H+", "+re+"): Promise already settled in state"+this.h);this.h=H,this.i=re,this.h===2&&this.B(),this.H()},M.prototype.B=function(){var H=this;se(function(){if(H.I()){var re=i.console;typeof re<"u"&&re.error(H.i)}},1)},M.prototype.I=function(){if(this.o)return!1;var H=i.CustomEvent,re=i.Event,B=i.dispatchEvent;return typeof B>"u"?!0:(typeof H=="function"?H=new H("unhandledrejection",{cancelable:!0}):typeof re=="function"?H=new re("unhandledrejection",{cancelable:!0}):(H=i.document.createEvent("CustomEvent"),H.initCustomEvent("unhandledrejection",!1,!0,H)),H.promise=this,H.reason=this.i,B(H))},M.prototype.H=function(){if(this.g!=null){for(var H=0;H<this.g.length;++H)le.h(this.g[H]);this.g=null}};var le=new K;return M.prototype.C=function(H){var re=this.j();H.s(re.resolve,re.reject)},M.prototype.D=function(H,re){var B=this.j();try{H.call(re,B.resolve,B.reject)}catch(Z){B.reject(Z)}},M.prototype.then=function(H,re){function B(ge,qe){return typeof ge=="function"?function(lt){try{Z(ge(lt))}catch(Dt){ne(Dt)}}:qe}var Z,ne,Te=new M(function(ge,qe){Z=ge,ne=qe});return this.s(B(H,Z),B(re,ne)),Te},M.prototype.catch=function(H){return this.then(void 0,H)},M.prototype.s=function(H,re){function B(){switch(Z.h){case 1:H(Z.i);break;case 2:re(Z.i);break;default:throw Error("Unexpected state: "+Z.h)}}var Z=this;this.g==null?le.h(B):this.g.push(B),this.o=!0},M.resolve=Y,M.reject=function(H){return new M(function(re,B){B(H)})},M.race=function(H){return new M(function(re,B){for(var Z=o(H),ne=Z.next();!ne.done;ne=Z.next())Y(ne.value).s(re,B)})},M.all=function(H){var re=o(H),B=re.next();return B.done?Y([]):new M(function(Z,ne){function Te(lt){return function(Dt){ge[lt]=Dt,qe--,qe==0&&Z(ge)}}var ge=[],qe=0;do ge.push(void 0),qe++,Y(B.value).s(Te(ge.length-1),ne),B=re.next();while(!B.done)})},M});var E=typeof Object.assign=="function"?Object.assign:function(R,M){for(var K=1;K<arguments.length;K++){var Y=arguments[K];if(Y)for(var se in Y)Object.prototype.hasOwnProperty.call(Y,se)&&(R[se]=Y[se])}return R};r("Object.assign",function(R){return R||E});var v=this||self,T={facingMode:"user",width:640,height:480};function b(R,M){this.video=R,this.i=0,this.h=Object.assign(Object.assign({},T),M)}b.prototype.stop=function(){var R=this,M,K,Y,se;return g(new y(new d(function(le){if(R.g){for(M=R.g.getTracks(),K=o(M),Y=K.next();!Y.done;Y=K.next())se=Y.value,se.stop();R.g=void 0}le.j=0})))},b.prototype.start=function(){var R=this,M;return g(new y(new d(function(K){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),M=R.h,K.return(navigator.mediaDevices.getUserMedia({video:{facingMode:M.facingMode,width:M.width,height:M.height}}).then(function(Y){x(R,Y)}).catch(function(Y){var se="Failed to acquire camera feed: "+Y;throw console.error(se),alert(se),Y}))})))};function C(R){window.requestAnimationFrame(function(){A(R)})}function x(R,M){R.g=M,R.video.srcObject=M,R.video.onloadedmetadata=function(){R.video.play(),C(R)}}function A(R){var M=null;R.video.paused||R.video.currentTime===R.i||(R.i=R.video.currentTime,M=R.h.onFrame()),M?M.then(function(){C(R)}):C(R)}var D=["Camera"],U=v;D[0]in U||typeof U.execScript>"u"||U.execScript("var "+D[0]);for(var V;D.length&&(V=D.shift());)D.length||b===void 0?U[V]&&U[V]!==Object.prototype[V]?U=U[V]:U=U[V]={}:U[V]=b}).call(wn);var Lp={};(function(){function t(y){var g=0;return function(){return g<y.length?{done:!1,value:y[g++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(y,g,E){return y==Array.prototype||y==Object.prototype||(y[g]=E.value),y};function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof wn=="object"&&wn];for(var g=0;g<y.length;++g){var E=y[g];if(E&&E.Math==Math)return E}throw Error("Cannot find global object")}var i=n(this);function r(y,g){if(g)e:{var E=i;y=y.split(".");for(var v=0;v<y.length-1;v++){var T=y[v];if(!(T in E))break e;E=E[T]}y=y[y.length-1],v=E[y],g=g(v),g!=v&&g!=null&&e(E,y,{configurable:!0,writable:!0,value:g})}}function s(y){var g=typeof Symbol<"u"&&Symbol.iterator&&y[Symbol.iterator];return g?g.call(y):{next:t(y)}}var o=typeof Object.assign=="function"?Object.assign:function(y,g){for(var E=1;E<arguments.length;E++){var v=arguments[E];if(v)for(var T in v)Object.prototype.hasOwnProperty.call(v,T)&&(y[T]=v[T])}return y};r("Object.assign",function(y){return y||o}),r("Array.prototype.fill",function(y){return y||function(g,E,v){var T=this.length||0;for(0>E&&(E=Math.max(0,T+E)),(v==null||v>T)&&(v=T),v=Number(v),0>v&&(v=Math.max(0,T+v)),E=Number(E||0);E<v;E++)this[E]=g;return this}});function a(y){return y||Array.prototype.fill}r("Int8Array.prototype.fill",a),r("Uint8Array.prototype.fill",a),r("Uint8ClampedArray.prototype.fill",a),r("Int16Array.prototype.fill",a),r("Uint16Array.prototype.fill",a),r("Int32Array.prototype.fill",a),r("Uint32Array.prototype.fill",a),r("Float32Array.prototype.fill",a),r("Float64Array.prototype.fill",a);var c=this||self;function u(y,g){y=y.split(".");var E=c;y[0]in E||typeof E.execScript>"u"||E.execScript("var "+y[0]);for(var v;y.length&&(v=y.shift());)y.length||g===void 0?E[v]&&E[v]!==Object.prototype[v]?E=E[v]:E=E[v]={}:E[v]=g}var d={color:"white",lineWidth:4,radius:6,visibilityMin:.5};function f(y){return y=y||{},Object.assign({},d,{fillColor:y.color},y)}function m(y,g){return y instanceof Function?y(g):y}function S(y,g,E){return Math.max(Math.min(g,E),Math.min(Math.max(g,E),y))}u("clamp",S),u("drawLandmarks",function(y,g,E){if(g){E=f(E),y.save();var v=y.canvas,T=0;g=s(g);for(var b=g.next();!b.done;b=g.next())if(b=b.value,b!==void 0&&(b.visibility===void 0||b.visibility>E.visibilityMin)){y.fillStyle=m(E.fillColor,{index:T,from:b}),y.strokeStyle=m(E.color,{index:T,from:b}),y.lineWidth=m(E.lineWidth,{index:T,from:b});var C=new Path2D;C.arc(b.x*v.width,b.y*v.height,m(E.radius,{index:T,from:b}),0,2*Math.PI),y.fill(C),y.stroke(C),++T}y.restore()}}),u("drawConnectors",function(y,g,E,v){if(g&&E){v=f(v),y.save();var T=y.canvas,b=0;E=s(E);for(var C=E.next();!C.done;C=E.next()){var x=C.value;y.beginPath(),C=g[x[0]],x=g[x[1]],C&&x&&(C.visibility===void 0||C.visibility>v.visibilityMin)&&(x.visibility===void 0||x.visibility>v.visibilityMin)&&(y.strokeStyle=m(v.color,{index:b,from:C,to:x}),y.lineWidth=m(v.lineWidth,{index:b,from:C,to:x}),y.moveTo(C.x*T.width,C.y*T.height),y.lineTo(x.x*T.width,x.y*T.height)),++b,y.stroke()}y.restore()}}),u("drawRectangle",function(y,g,E){E=f(E),y.save();var v=y.canvas;y.beginPath(),y.lineWidth=m(E.lineWidth,{}),y.strokeStyle=m(E.color,{}),y.fillStyle=m(E.fillColor,{}),y.translate(g.xCenter*v.width,g.yCenter*v.height),y.rotate(g.rotation*Math.PI/180),y.rect(-g.width/2*v.width,-g.height/2*v.height,g.width*v.width,g.height*v.height),y.translate(-g.xCenter*v.width,-g.yCenter*v.height),y.stroke(),y.fill(),y.restore()}),u("lerp",function(y,g,E,v,T){return S(v*(1-(y-g)/(E-g))+T*(1-(E-y)/(E-g)),v,T)})}).call(wn);const OC=({onPoseDetected:t})=>{const e=Ce.useRef(null),n=Ce.useRef(null);Ce.useEffect(()=>{const r=new Np.Pose({locateFile:s=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${s}`});r.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!1,minDetectionConfidence:.5,minTrackingConfidence:.5}),r.onResults(i),e.current&&e.current.video&&new xC.Camera(e.current.video,{onFrame:async()=>{e.current&&e.current.video&&await r.send({image:e.current.video})},width:1280,height:720}).start()},[]);const i=r=>{if(!n.current||!e.current||!e.current.video)return;const s=e.current.video.videoWidth,o=e.current.video.videoHeight;n.current.width=s,n.current.height=o;const a=n.current.getContext("2d");a.save(),a.clearRect(0,0,n.current.width,n.current.height),r.poseLandmarks&&(t(r.poseLandmarks),Lp.drawConnectors(a,r.poseLandmarks,Np.POSE_CONNECTIONS,{color:"#00FF00",lineWidth:4}),Lp.drawLandmarks(a,r.poseLandmarks,{color:"#FF0000",lineWidth:2})),a.restore()};return ie.jsxs("div",{className:"relative w-full h-full rounded-2xl overflow-hidden shadow-2xl border-2 border-slate-700",children:[ie.jsx(IC,{ref:e,className:"absolute top-0 left-0 w-full h-full object-cover",mirrored:!0}),ie.jsx("canvas",{ref:n,className:"absolute top-0 left-0 w-full h-full object-cover",style:{transform:"scaleX(-1)"}})]})};var Up={};function MC(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var AC=Object.defineProperty,DC=(t,e,n)=>e in t?AC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Fp=(t,e,n)=>DC(t,typeof e!="symbol"?e+"":e,n);let kt=class{constructor(){Fp(this,"_locking"),Fp(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function je(t,e){if(!t)throw new Error(e)}const NC=34028234663852886e22,LC=-34028234663852886e22,UC=4294967295,FC=2147483647,jC=-2147483648;function sa(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>FC||t<jC)throw new Error("invalid int 32: "+t)}function Au(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>UC||t<0)throw new Error("invalid uint 32: "+t)}function cy(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>NC||t<LC))throw new Error("invalid float 32: "+t)}const ly=Symbol("@bufbuild/protobuf/enum-type");function BC(t){const e=t[ly];return je(e,"missing enum type on enum object"),e}function uy(t,e,n,i){t[ly]=dy(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function dy(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=hy(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function VC(t,e,n){const i={};for(const r of e){const s=hy(r);i[s.localName]=s.no,i[s.no]=s.localName}return uy(i,t,e),i}function hy(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class nh{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function zC(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new nh),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function WC(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Tl(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const oa=4294967296;function jp(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=oa&&(r=r+(i/oa|0),i=i%oa)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?py(i,r):ih(i,r)}function qC(t,e){let n=ih(t,e);const i=n.hi&2147483648;i&&(n=py(n.lo,n.hi));const r=fy(n.lo,n.hi);return i?"-"+r:r}function fy(t,e){if({lo:t,hi:e}=HC(t,e),e<=2097151)return String(oa*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+Bp(o)+Bp(s)}function HC(t,e){return{lo:t>>>0,hi:e>>>0}}function ih(t,e){return{lo:t|0,hi:e|0}}function py(t,e){return e=~e,t?t=~t+1:e+=1,ih(t,e)}const Bp=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Vp(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function GC(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function KC(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Up!="object"||Up.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const u=typeof c=="bigint"?c:BigInt(c);if(u>s||u<r)throw new Error("int64 invalid: ".concat(c));return u},uParse(c){const u=typeof c=="bigint"?c:BigInt(c);if(u>a||u<o)throw new Error("uint64 invalid: ".concat(c));return u},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,u){return t.setInt32(0,c,!0),t.setInt32(4,u,!0),t.getBigInt64(0,!0)},uDec(c,u){return t.setInt32(0,c,!0),t.setInt32(4,u,!0),t.getBigUint64(0,!0)}}}const n=r=>je(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>je(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),jp(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),jp(r)},dec(r,s){return qC(r,s)},uDec(r,s){return fy(r,s)}}}const Ae=KC();var j;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(j||(j={}));var wi;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(wi||(wi={}));function ei(t,e,n){if(e===n)return!0;if(t==j.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case j.UINT64:case j.FIXED64:case j.INT64:case j.SFIXED64:case j.SINT64:return e==n}return!1}function Wr(t,e){switch(t){case j.BOOL:return!1;case j.UINT64:case j.FIXED64:case j.INT64:case j.SFIXED64:case j.SINT64:return e==0?Ae.zero:"0";case j.DOUBLE:case j.FLOAT:return 0;case j.BYTES:return new Uint8Array(0);case j.STRING:return"";default:return 0}}function my(t,e){switch(t){case j.BOOL:return e===!1;case j.STRING:return e==="";case j.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var We;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(We||(We={}));class $C{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Au(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return sa(e),Vp(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){cy(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Au(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){sa(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return sa(e),e=(e<<1^e>>31)>>>0,Vp(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=Ae.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=Ae.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=Ae.enc(e);return Tl(n.lo,n.hi,this.buf),this}sint64(e){let n=Ae.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Tl(r,s,this.buf),this}uint64(e){let n=Ae.uEnc(e);return Tl(n.lo,n.hi,this.buf),this}}class JC{constructor(e,n){this.varint64=WC,this.uint32=GC,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case We.Varint:for(;this.buf[this.pos++]&128;);break;case We.Bit64:this.pos+=4;case We.Bit32:this.pos+=4;break;case We.LengthDelimited:let r=this.uint32();this.pos+=r;break;case We.StartGroup:for(;;){const[s,o]=this.tag();if(o===We.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Ae.dec(...this.varint64())}uint64(){return Ae.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,Ae.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Ae.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Ae.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function QC(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function gy(t){const e=t.field.localName,n=Object.create(null);return n[e]=YC(t),[n,()=>n[e]]}function YC(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Wr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function XC(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Fn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),vc=[];for(let t=0;t<Fn.length;t++)vc[Fn[t].charCodeAt(0)]=t;vc[45]=Fn.indexOf("+");vc[95]=Fn.indexOf("/");const vy={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=vc[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=Fn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Fn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Fn[r|i>>6],e+=Fn[i&63],n=0;break}return n&&(e+=Fn[r],e+="=",n==1&&(e+="=")),e}};function ZC(t,e,n){ky(e,t);const i=e.runtime.bin.makeReadOptions(n),r=XC(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=gy(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function eb(t,e,n,i){ky(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(yy(t,e)){const u=t.getType().runtime.bin.listUnknownFields(t).filter(d=>d.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const d of u)t.getType().runtime.bin.onUnknownField(t,d.no,d.wireType,d.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[u,d]=c.tag(),f=c.skip(d,u);t.getType().runtime.bin.onUnknownField(t,u,d,f)}}function yy(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function ky(t,e){je(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function Sy(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!my(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function zp(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Wr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function jn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(nh.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Ty(t,e){return jn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}j.DOUBLE,j.FLOAT,j.INT64,j.UINT64,j.INT32,j.UINT32,j.BOOL,j.STRING,j.BYTES;const Wp={ignoreUnknownFields:!1},qp={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function tb(t){return t?Object.assign(Object.assign({},Wp),t):Wp}function nb(t){return t?Object.assign(Object.assign({},qp),t):qp}const za=Symbol(),aa=Symbol();function ib(){return{makeReadOptions:tb,makeWriteOptions:nb,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Cn(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const u=r.get(c.oneof);if(u!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(u,'", "').concat(o,'"'));r.set(c.oneof,o)}Hp(i,a,c,n,t)}else{let u=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const d=s.findExtension(o.substring(1,o.length-1));if(d&&d.extendee.typeName==t.typeName){u=!0;const[f,m]=gy(d);Hp(f,a,d.field,n,d),eb(i,d,m(),n)}}if(!u&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!Sy(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!sb(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Gp(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&yy(t,a)){const c=ZC(t,a,e),u=Gp(a.field,c,e);u!==void 0&&(i[a.field.jsonName]=u)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Ds(t,e,n??wi.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||my(t,e)))return ca(t,e)},debug:Cn}}function Cn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Hp(t,e,n,i,r){let s=n.localName;if(n.repeated){if(je(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Cn(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Cn(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Cl(n.T,a,i.ignoreUnknownFields,!0);c!==aa&&o.push(c);break;case"scalar":try{o.push(Ds(n.T,a,n.L,!0))}catch(u){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Cn(a));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Cn(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let u;try{u=rb(n.K,a)}catch(d){let f="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Cn(e));throw d instanceof Error&&d.message.length>0&&(f+=": ".concat(d.message)),new Error(f)}switch(n.V.kind){case"message":o[u]=n.V.T.fromJson(c,i);break;case"enum":const d=Cl(n.V.T,c,i.ignoreUnknownFields,!0);d!==aa&&(o[u]=d);break;case"scalar":try{o[u]=Ds(n.V.T,c,wi.BIGINT,!0)}catch(f){let m="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Cn(e));throw f instanceof Error&&f.message.length>0&&(m+=": ".concat(f.message)),new Error(m)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];jn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Cl(n.T,e,i.ignoreUnknownFields,!1);switch(c){case za:zp(n,t);break;case aa:break;default:t[s]=c;break}break;case"scalar":try{const u=Ds(n.T,e,n.L,!1);switch(u){case za:zp(n,t);break;default:t[s]=u;break}}catch(u){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Cn(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}break}}function rb(t,e){if(t===j.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ds(t,e,wi.BIGINT,!0).toString()}function Ds(t,e,n,i){if(e===null)return i?Wr(t,n):za;switch(t){case j.DOUBLE:case j.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==j.FLOAT&&cy(r),r;case j.INT32:case j.FIXED32:case j.SFIXED32:case j.SINT32:case j.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==j.UINT32||t==j.FIXED32?Au(s):sa(s),s;case j.INT64:case j.SFIXED64:case j.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=Ae.parse(e);return n?o.toString():o;case j.FIXED64:case j.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=Ae.uParse(e);return n?a.toString():a;case j.BOOL:if(typeof e!="boolean")break;return e;case j.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case j.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return vy.dec(e)}throw new Error}function Cl(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:za;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return aa;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Cn(e)))}function sb(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Gp(t,e,n){if(t.kind=="map"){je(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=ca(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=bl(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){je(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(ca(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(bl(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return ca(t.T,e);case"enum":return bl(t.T,e,n.enumAsInteger);case"message":return Ty(t.T,e).toJson(n)}}function bl(t,e,n){var i;if(je(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function ca(t,e){switch(t){case j.INT32:case j.SFIXED32:case j.SINT32:case j.FIXED32:case j.UINT32:return je(typeof e=="number"),e;case j.FLOAT:case j.DOUBLE:return je(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case j.STRING:return je(typeof e=="string"),e;case j.BOOL:return je(typeof e=="boolean"),e;case j.UINT64:case j.FIXED64:case j.INT64:case j.SFIXED64:case j.SINT64:return je(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case j.BYTES:return je(e instanceof Uint8Array),vy.enc(e)}}const sr=Symbol("@bufbuild/protobuf/unknown-fields"),Kp={readUnknownFields:!0,readerFactory:t=>new JC(t)},$p={writeUnknownFields:!0,writerFactory:()=>new $C};function ob(t){return t?Object.assign(Object.assign({},Kp),t):Kp}function ab(t){return t?Object.assign(Object.assign({},$p),t):$p}function cb(){return{makeReadOptions:ob,makeWriteOptions:ab,listUnknownFields(t){var e;return(e=t[sr])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[sr]},writeUnknownFields(t,e){const i=t[sr];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[sr])||(r[sr]=[]),r[sr].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==We.EndGroup));){const u=s.fields.find(a);if(!u){const d=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,d);continue}Jp(t,e,u,c,i)}if(r&&(c!=We.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Jp,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!Sy(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Qp(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Qp(t,e,n,i)}}}function Jp(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?j.INT32:n.T;let c=Wa;if(n.kind=="scalar"&&n.L>0&&(c=ub),s){let m=t[o];if(i==We.LengthDelimited&&a!=j.STRING&&a!=j.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)m.push(c(e,a))}else m.push(c(e,a))}else t[o]=c(e,a);break;case"message":const u=n.T;s?t[o].push(la(e,new u,r,n)):jn(t[o])?la(e,t[o],r,n):(t[o]=la(e,new u,r,n),u.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=u.fieldWrapper.unwrapField(t[o])));break;case"map":let[d,f]=lb(n,e,r);t[o][d]=f;break}}function la(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function lb(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=Wa(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=Wa(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=la(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Wr(t.K,wi.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Wr(t.V.T,wi.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function ub(t,e){const n=Wa(t,e);return typeof n=="bigint"?n.toString():n}function Wa(t,e){switch(e){case j.STRING:return t.string();case j.BOOL:return t.bool();case j.DOUBLE:return t.double();case j.FLOAT:return t.float();case j.INT32:return t.int32();case j.INT64:return t.int64();case j.UINT64:return t.uint64();case j.FIXED64:return t.fixed64();case j.BYTES:return t.bytes();case j.FIXED32:return t.fixed32();case j.SFIXED32:return t.sfixed32();case j.SFIXED64:return t.sfixed64();case j.SINT64:return t.sint64();case j.UINT32:return t.uint32();case j.SINT32:return t.sint32()}}function Qp(t,e,n,i){je(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?j.INT32:t.T;if(r)if(je(Array.isArray(e)),t.packed)hb(n,s,t.no,e);else for(const o of e)Ns(n,s,t.no,o);else Ns(n,s,t.no,e);break;case"message":if(r){je(Array.isArray(e));for(const o of e)Yp(n,i,t,o)}else Yp(n,i,t,e);break;case"map":je(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))db(n,i,t,o,a);break}}function db(t,e,n,i,r){t.tag(n.no,We.LengthDelimited),t.fork();let s=i;switch(n.K){case j.INT32:case j.FIXED32:case j.UINT32:case j.SFIXED32:case j.SINT32:s=Number.parseInt(i);break;case j.BOOL:je(i=="true"||i=="false"),s=i=="true";break}switch(Ns(t,n.K,1,s),n.V.kind){case"scalar":Ns(t,n.V.T,2,r);break;case"enum":Ns(t,j.INT32,2,r);break;case"message":je(r!==void 0),t.tag(2,We.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Yp(t,e,n,i){const r=Ty(n.T,i);n.delimited?t.tag(n.no,We.StartGroup).raw(r.toBinary(e)).tag(n.no,We.EndGroup):t.tag(n.no,We.LengthDelimited).bytes(r.toBinary(e))}function Ns(t,e,n,i){je(i!==void 0);let[r,s]=Cy(e);t.tag(n,r)[s](i)}function hb(t,e,n,i){if(!i.length)return;t.tag(n,We.LengthDelimited).fork();let[,r]=Cy(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function Cy(t){let e=We.Varint;switch(t){case j.BYTES:case j.STRING:e=We.LengthDelimited;break;case j.DOUBLE:case j.FIXED64:case j.SFIXED64:e=We.Bit64;break;case j.FIXED32:case j.SFIXED32:case j.FLOAT:e=We.Bit32;break}const n=j[t].toLowerCase();return[e,n]}function fb(){return{setEnumType:uy,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let u=o[r].value;c&&c.kind=="message"&&!jn(u,c.T)?u=new c.T(u):c&&c.kind==="scalar"&&c.T===j.BYTES&&(u=fs(u)),s[r]={case:a,value:u};break;case"scalar":case"enum":let d=o[r];i.T===j.BYTES&&(d=i.repeated?d.map(fs):fs(d)),s[r]=d;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===j.BYTES)for(const[S,y]of Object.entries(o[r]))s[r][S]=fs(y);else Object.assign(s[r],o[r]);break;case"message":const m=i.V.T;for(const S of Object.keys(o[r])){let y=o[r][S];m.fieldWrapper||(y=new m(y)),s[r][S]=y}break}break;case"message":const f=i.T;if(i.repeated)s[r]=o[r].map(m=>jn(m,f)?m:new f(m));else{const m=o[r];f.fieldWrapper?f.typeName==="google.protobuf.BytesValue"?s[r]=fs(m):s[r]=m:s[r]=jn(m,f)?m:new f(m)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>ei(i.T,o,s[a]));case"enum":return r.every((o,a)=>ei(j.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!jn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!jn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return ei(j.INT32,r,s);case"scalar":return ei(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return ei(j.INT32,r.value,s.value);case"scalar":return ei(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const u=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const d=i.V.T;return u.every(m=>d.equals(r[m],s[m]));case"enum":return u.every(m=>ei(j.INT32,r[m],s[m]));case"scalar":const f=i.V.T;return u.every(m=>ei(f,r[m],s[m]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(qo);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=qo(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:qo(s.value)}:{case:void 0}:o=qo(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function qo(t){if(t===void 0)return t;if(jn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function fs(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function pb(t,e,n){return{syntax:t,json:ib(),bin:cb(),util:Object.assign(Object.assign({},fb()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return zC(this,i,r,s)},makeEnum:VC,makeEnumType:dy,getEnumType:BC,makeExtension(i,r,s){return QC(this,i,r,s)}}}class mb{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function by(t,e){const n=wy(t);return e?n:Tb(Sb(n))}function gb(t){return by(t,!1)}const vb=wy;function wy(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const yb=new Set(["constructor","toString","toJSON","valueOf"]),kb=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Ey=t=>"".concat(t,"$"),Sb=t=>kb.has(t)?Ey(t):t,Tb=t=>yb.has(t)?Ey(t):t;class Cb{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=gb(e)}addField(e){je(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function bb(t,e){var n,i,r,s,o,a;const c=[];let u;for(const d of typeof t=="function"?t():t){const f=d;if(f.localName=by(d.name,d.oneof!==void 0),f.jsonName=(n=d.jsonName)!==null&&n!==void 0?n:vb(d.name),f.repeated=(i=d.repeated)!==null&&i!==void 0?i:!1,d.kind=="scalar"&&(f.L=(r=d.L)!==null&&r!==void 0?r:wi.BIGINT),f.delimited=(s=d.delimited)!==null&&s!==void 0?s:!1,f.req=(o=d.req)!==null&&o!==void 0?o:!1,f.opt=(a=d.opt)!==null&&a!==void 0?a:!1,d.packed===void 0&&(f.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=j.BYTES&&d.T!=j.STRING),d.oneof!==void 0){const m=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!u||u.name!=m)&&(u=new Cb(m)),f.oneof=u,u.addField(f)}c.push(f)}return c}const N=pb("proto3",t=>new mb(t,e=>bb(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Wr(e.T,e.L);break}}});class Pt extends nh{constructor(e){super(),this.seconds=Ae.zero,this.nanos=0,N.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(N.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Ae.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Pt.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Pt({seconds:Ae.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Pt().fromBinary(e,n)}static fromJson(e,n){return new Pt().fromJson(e,n)}static fromJsonString(e,n){return new Pt().fromJsonString(e,n)}static equals(e,n){return N.util.equals(Pt,e,n)}}Pt.runtime=N;Pt.typeName="google.protobuf.Timestamp";Pt.fields=N.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const wb=N.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Pt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Eb,repeated:!0},{no:5,name:"events",kind:"message",T:Pb,repeated:!0}]),Eb=N.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:_b,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),_b=N.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Pt},{no:3,name:"value",kind:"scalar",T:2}]),Pb=N.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Pt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Pt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),_y=N.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),an=N.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),He=N.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),rh=N.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),bs=N.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),no=N.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),un=N.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Ui=N.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Rb=N.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ze=N.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),yc=N.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:qa,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:jy}]),qa=N.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Ib=N.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:N.getEnumType(He),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ji=N.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:N.getEnumType(Rr)},{no:4,name:"tracks",kind:"message",T:kr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Ib},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:N.getEnumType(io)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:N.getEnumType(un)},{no:18,name:"kind_details",kind:"enum",T:N.getEnumType(xb),repeated:!0}]),Rr=N.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),io=N.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),xb=N.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Qe=N.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Ob=N.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ki,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:N.getEnumType(Py)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),kr=N.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:N.getEnumType(an)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:N.getEnumType(He)},{no:10,name:"layers",kind:"message",T:ki,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Ob,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:N.getEnumType(Qe)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:jy},{no:19,name:"audio_features",kind:"enum",T:N.getEnumType(Ze),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:N.getEnumType(_y)}]),ki=N.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:N.getEnumType(rh)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Py=N.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),vt=N.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:N.getEnumType(he)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:sh,oneof:"value"},{no:3,name:"speaker",kind:"message",T:Mb,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Oy,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Ab,oneof:"value"},{no:8,name:"metrics",kind:"message",T:wb,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Ha,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:oh,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:ah,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:ch,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Ga,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ka,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:$a,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Ry,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),he=N.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Ry=N.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:N.getEnumType(Qe)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Iy=N.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:sh,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Ha,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:oh,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:ah,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:ch,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Ga,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Ka,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:$a,oneof:"value"}]),Mb=N.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:xy,repeated:!0}]),xy=N.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),sh=N.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Oy=N.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Ab=N.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Db,repeated:!0}]),Db=N.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Ha=N.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),oh=N.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),ah=N.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),ch=N.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:My,oneof:"value"}]),My=N.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Ay=N.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Dy=N.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:N.getEnumType(Ny)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Ny=N.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Ly=N.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:N.getEnumType(Uy)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Uy=N.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Fy=N.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Xp},{no:2,name:"screen",kind:"message",T:Xp},{no:3,name:"resume_connection",kind:"enum",T:N.getEnumType(no)},{no:4,name:"disabled_codecs",kind:"message",T:Nb},{no:5,name:"force_relay",kind:"enum",T:N.getEnumType(no)}]),Xp=N.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:N.getEnumType(no)}]),Nb=N.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:qa,repeated:!0},{no:2,name:"publish",kind:"message",T:qa,repeated:!0}]),jy=N.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Du=N.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),By=N.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:N.getEnumType(Du)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Vy=N.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Ga=N.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:N.getEnumType(Qe)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:By,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Vy,oneof:"content_header"}],{localName:"DataStream_Header"}),Ka=N.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),$a=N.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),Lb=N.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),cn=N.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Nu=N.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Ub=N.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Fb=N.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Ei,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ei,oneof:"message"},{no:3,name:"trickle",kind:"message",T:kc,oneof:"message"},{no:4,name:"add_track",kind:"message",T:ro,oneof:"message"},{no:5,name:"mute",kind:"message",T:Sc,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Tc,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:zy,oneof:"message"},{no:8,name:"leave",kind:"message",T:Cc,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:qy,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Ky,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:fh,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Sn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:dh,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Qy,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:uh,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Wy,oneof:"message"}]),Zp=N.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:jb,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ei,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ei,oneof:"message"},{no:4,name:"trickle",kind:"message",T:kc,oneof:"message"},{no:5,name:"update",kind:"message",T:zb,oneof:"message"},{no:6,name:"track_published",kind:"message",T:lh,oneof:"message"},{no:8,name:"leave",kind:"message",T:Cc,oneof:"message"},{no:9,name:"mute",kind:"message",T:Sc,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Wb,oneof:"message"},{no:11,name:"room_update",kind:"message",T:qb,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Gb,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:$b,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Qb,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Xb,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Vb,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Bb,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:ew,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:iw,oneof:"message"},{no:22,name:"request_response",kind:"message",T:rw,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:sw,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Zb,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:lw,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:Yb,oneof:"message"}]),Lu=N.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ki,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:N.getEnumType(Py)}]),ro=N.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:N.getEnumType(an)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:N.getEnumType(He)},{no:9,name:"layers",kind:"message",T:ki,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Lu,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:N.getEnumType(Qe)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:N.getEnumType(_y)},{no:17,name:"audio_features",kind:"enum",T:N.getEnumType(Ze),repeated:!0}]),kc=N.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:N.getEnumType(cn)},{no:3,name:"final",kind:"scalar",T:8}]),Sc=N.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),jb=N.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:yc},{no:2,name:"participant",kind:"message",T:Ji},{no:3,name:"other_participants",kind:"message",T:Ji,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Hy,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Fy},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Dy},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:qa,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Bb=N.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Hy,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Fy},{no:3,name:"server_info",kind:"message",T:Dy},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),lh=N.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:kr}]),Vb=N.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Ei=N.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),zb=N.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ji,repeated:!0}]),Tc=N.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Ay,repeated:!0}]),zy=N.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:N.getEnumType(rh)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),uh=N.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:N.getEnumType(Ze),repeated:!0}]),Wy=N.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Cc=N.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:N.getEnumType(un)},{no:3,name:"action",kind:"enum",T:N.getEnumType(Ir)},{no:4,name:"regions",kind:"message",T:tw}]),Ir=N.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),qy=N.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ki,repeated:!0}]),dh=N.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Hy=N.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Wb=N.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:xy,repeated:!0}]),qb=N.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:yc}]),Hb=N.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:N.getEnumType(bs)},{no:3,name:"score",kind:"scalar",T:2}]),Gb=N.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:Hb,repeated:!0}]),Kb=N.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:N.getEnumType(Nu)}]),$b=N.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Kb,repeated:!0}]),hh=N.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:N.getEnumType(rh)},{no:2,name:"enabled",kind:"scalar",T:8}]),Jb=N.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:hh,repeated:!0}]),Qb=N.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:hh,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Jb,repeated:!0}]),Yb=N.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:Lb,repeated:!0}]),Gy=N.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Ky=N.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Gy,repeated:!0}]),Xb=N.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Zb=N.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:yc},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ji},{no:4,name:"other_participants",kind:"message",T:Ji,repeated:!0}]),fh=N.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Ei},{no:2,name:"subscription",kind:"message",T:Tc},{no:3,name:"publish_tracks",kind:"message",T:lh,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Jy,repeated:!0},{no:5,name:"offer",kind:"message",T:Ei},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:$y,repeated:!0}]),$y=N.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Jy=N.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:N.getEnumType(cn)}]),Sn=N.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:N.getEnumType(Ub),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Qy=N.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),ew=N.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),tw=N.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:nw,repeated:!0}]),nw=N.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),iw=N.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:N.getEnumType(Rb)}]),rw=N.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:N.getEnumType(ph)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:kc,oneof:"request"},{no:5,name:"add_track",kind:"message",T:ro,oneof:"request"},{no:6,name:"mute",kind:"message",T:Sc,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:dh,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:uh,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Wy,oneof:"request"}]),ph=N.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),sw=N.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Yy=N.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),ow=N.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Ly},{no:2,name:"connection_settings",kind:"message",T:Yy},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:ro,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Ei},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:N.getEnumType(Ui)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:fh}]),aw=N.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:N.getEnumType(cw)},{no:2,name:"join_request",kind:"scalar",T:12}]),cw=N.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),lw=N.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function uw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ua={exports:{}},dw=ua.exports,em;function hw(){return em||(em=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(dw,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(g,E){var v=g[E];if(typeof v.bind=="function")return v.bind(g);try{return Function.prototype.bind.call(v,g)}catch{return function(){return Function.prototype.apply.apply(v,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?c:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function d(){for(var g=this.getLevel(),E=0;E<r.length;E++){var v=r[E];this[v]=E<g?e:this.methodFactory(v,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function f(g){return function(){typeof console!==n&&(d.call(this),this[g].apply(this,arguments))}}function m(g,E,v){return u(g)||f.apply(this,arguments)}function S(g,E){var v=this,T,b,C,x="loglevel";typeof g=="string"?x+=":"+g:typeof g=="symbol"&&(x=void 0);function A(M){var K=(r[M]||"silent").toUpperCase();if(!(typeof window===n||!x)){try{window.localStorage[x]=K;return}catch{}try{window.document.cookie=encodeURIComponent(x)+"="+K+";"}catch{}}}function D(){var M;if(!(typeof window===n||!x)){try{M=window.localStorage[x]}catch{}if(typeof M===n)try{var K=window.document.cookie,Y=encodeURIComponent(x),se=K.indexOf(Y+"=");se!==-1&&(M=/^([^;]+)/.exec(K.slice(se+Y.length+1))[1])}catch{}return v.levels[M]===void 0&&(M=void 0),M}}function U(){if(!(typeof window===n||!x)){try{window.localStorage.removeItem(x)}catch{}try{window.document.cookie=encodeURIComponent(x)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function V(M){var K=M;if(typeof K=="string"&&v.levels[K.toUpperCase()]!==void 0&&(K=v.levels[K.toUpperCase()]),typeof K=="number"&&K>=0&&K<=v.levels.SILENT)return K;throw new TypeError("log.setLevel() called with invalid level: "+M)}v.name=g,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=E||m,v.getLevel=function(){return C??b??T},v.setLevel=function(M,K){return C=V(M),K!==!1&&A(C),d.call(v)},v.setDefaultLevel=function(M){b=V(M),D()||v.setLevel(M,!1)},v.resetLevel=function(){C=null,U(),d.call(v)},v.enableAll=function(M){v.setLevel(v.levels.TRACE,M)},v.disableAll=function(M){v.setLevel(v.levels.SILENT,M)},v.rebuild=function(){if(o!==v&&(T=V(o.getLevel())),d.call(v),o===v)for(var M in s)s[M].rebuild()},T=V(o?o.getLevel():"WARN");var R=D();R!=null&&(C=V(R)),d.call(v)}o=new S,o.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var v=s[E];return v||(v=s[E]=new S(E,o.methodFactory)),v};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(ua)),ua.exports}var bc=hw(),Uu;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Uu||(Uu={}));var pn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(pn||(pn={}));let ue=bc.getLogger("livekit");Object.values(pn).map(t=>bc.getLogger(t));ue.setDefaultLevel(Uu.info);function Qn(t){const e=bc.getLogger(t);return e.setDefaultLevel(ue.getLevel()),e}const fw=bc.getLogger("lk-e2ee"),ps=7e3,pw=[0,300,2*2*300,3*3*300,4*4*300,ps,ps,ps,ps,ps];class mw{constructor(e){this._retryDelays=e!==void 0?[...e]:pw}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function gw(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function I(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(i.next(d))}catch(f){o(f)}}function c(d){try{u(i.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):r(d.value).then(a,c)}u((i=i.apply(t,e||[])).next())})}function tm(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof tm=="function"?tm(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}var Ho={exports:{}},nm;function vw(){if(nm)return Ho.exports;nm=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(x,A,D){return Function.prototype.apply.call(x,A,D)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:n=function(x){return Object.getOwnPropertyNames(x)};function i(C){console&&console.warn&&console.warn(C)}var r=Number.isNaN||function(x){return x!==x};function s(){s.init.call(this)}Ho.exports=s,Ho.exports.once=v,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(C){if(typeof C!="number"||C<0||r(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");o=C}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||r(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function c(C){return C._maxListeners===void 0?s.defaultMaxListeners:C._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(x){for(var A=[],D=1;D<arguments.length;D++)A.push(arguments[D]);var U=x==="error",V=this._events;if(V!==void 0)U=U&&V.error===void 0;else if(!U)return!1;if(U){var R;if(A.length>0&&(R=A[0]),R instanceof Error)throw R;var M=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw M.context=R,M}var K=V[x];if(K===void 0)return!1;if(typeof K=="function")e(K,this,A);else for(var Y=K.length,se=y(K,Y),D=0;D<Y;++D)e(se[D],this,A);return!0};function u(C,x,A,D){var U,V,R;if(a(A),V=C._events,V===void 0?(V=C._events=Object.create(null),C._eventsCount=0):(V.newListener!==void 0&&(C.emit("newListener",x,A.listener?A.listener:A),V=C._events),R=V[x]),R===void 0)R=V[x]=A,++C._eventsCount;else if(typeof R=="function"?R=V[x]=D?[A,R]:[R,A]:D?R.unshift(A):R.push(A),U=c(C),U>0&&R.length>U&&!R.warned){R.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=C,M.type=x,M.count=R.length,i(M)}return C}s.prototype.addListener=function(x,A){return u(this,x,A,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(x,A){return u(this,x,A,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(C,x,A){var D={fired:!1,wrapFn:void 0,target:C,type:x,listener:A},U=d.bind(D);return U.listener=A,D.wrapFn=U,U}s.prototype.once=function(x,A){return a(A),this.on(x,f(this,x,A)),this},s.prototype.prependOnceListener=function(x,A){return a(A),this.prependListener(x,f(this,x,A)),this},s.prototype.removeListener=function(x,A){var D,U,V,R,M;if(a(A),U=this._events,U===void 0)return this;if(D=U[x],D===void 0)return this;if(D===A||D.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete U[x],U.removeListener&&this.emit("removeListener",x,D.listener||A));else if(typeof D!="function"){for(V=-1,R=D.length-1;R>=0;R--)if(D[R]===A||D[R].listener===A){M=D[R].listener,V=R;break}if(V<0)return this;V===0?D.shift():g(D,V),D.length===1&&(U[x]=D[0]),U.removeListener!==void 0&&this.emit("removeListener",x,M||A)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(x){var A,D,U;if(D=this._events,D===void 0)return this;if(D.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):D[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete D[x]),this;if(arguments.length===0){var V=Object.keys(D),R;for(U=0;U<V.length;++U)R=V[U],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=D[x],typeof A=="function")this.removeListener(x,A);else if(A!==void 0)for(U=A.length-1;U>=0;U--)this.removeListener(x,A[U]);return this};function m(C,x,A){var D=C._events;if(D===void 0)return[];var U=D[x];return U===void 0?[]:typeof U=="function"?A?[U.listener||U]:[U]:A?E(U):y(U,U.length)}s.prototype.listeners=function(x){return m(this,x,!0)},s.prototype.rawListeners=function(x){return m(this,x,!1)},s.listenerCount=function(C,x){return typeof C.listenerCount=="function"?C.listenerCount(x):S.call(C,x)},s.prototype.listenerCount=S;function S(C){var x=this._events;if(x!==void 0){var A=x[C];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(C,x){for(var A=new Array(x),D=0;D<x;++D)A[D]=C[D];return A}function g(C,x){for(;x+1<C.length;x++)C[x]=C[x+1];C.pop()}function E(C){for(var x=new Array(C.length),A=0;A<x.length;++A)x[A]=C[A].listener||C[A];return x}function v(C,x){return new Promise(function(A,D){function U(R){C.removeListener(x,V),D(R)}function V(){typeof C.removeListener=="function"&&C.removeListener("error",U),A([].slice.call(arguments))}b(C,x,V,{once:!0}),x!=="error"&&T(C,U,{once:!0})})}function T(C,x,A){typeof C.on=="function"&&b(C,"error",x,A)}function b(C,x,A,D){if(typeof C.on=="function")D.once?C.once(x,A):C.on(x,A);else if(typeof C.addEventListener=="function")C.addEventListener(x,function U(V){D.once&&C.removeEventListener(x,U),A(V)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return Ho.exports}var xn=vw();let Xy=!0,Zy=!0;function ws(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function er(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=u=>{const d=n(u);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function yw(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Xy=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function kw(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Zy=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function e0(){if(typeof window=="object"){if(Xy)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function mh(t,e){Zy&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Sw(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ws(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ws(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ws(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ws(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function im(t){return Object.prototype.toString.call(t)==="[object Object]"}function t0(t){return im(t)?Object.keys(t).reduce(function(e,n){const i=im(t[n]),r=i?t0(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function Fu(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Fu(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Fu(t,t.get(r),n)})}))}function rm(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&Fu(t,a,r)})}),r}const sm=e0;function n0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof a[u]=="object"?a[u]:{ideal:a[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const f=function(m,S){return m?m+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(d.ideal!==void 0){c.optional=c.optional||[];let m={};typeof d.ideal=="number"?(m[f("min",u)]=d.ideal,c.optional.push(m),m={},m[f("max",u)]=d.ideal,c.optional.push(m)):(m[f("",u)]=d.ideal,c.optional.push(m))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[f("",u)]=d.exact):["min","max"].forEach(m=>{d[m]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[f(m,u)]=d[m])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(d,f,m){f in d&&!(m in d)&&(d[m]=d[f],delete d[f])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(m=>{m=m.filter(y=>y.kind==="videoinput");let S=m.find(y=>f.some(g=>y.label.toLowerCase().includes(g)));return!S&&m.length&&f.includes("back")&&(S=m[m.length-1]),S&&(a.video.deviceId=u.exact?{exact:S.deviceId}:{ideal:S.deviceId}),a.video=i(a.video),sm("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return sm("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,u){r(a,d=>{n.webkitGetUserMedia(d,c,f=>{u&&u(s(f))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,u=>a(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(s(d))))}}}function i0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function r0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else er(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function s0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let u=r.apply(this,arguments);return u||(u=e(this,a),this._senders.push(u)),u};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function o0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>rm(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),er(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>rm(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function a0(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function c0(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return a0(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(f=>this._reverseStreams[f.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(S=>S.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const f=new t.MediaStream(d.getTracks());this._streams[d.id]=f,this._reverseStreams[f.id]=d,d=f}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(g=>g===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[f.id];if(y)y.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([d]);this._streams[f.id]=g,this._reverseStreams[g.id]=f,this.addStream(g)}return this.getSenders().find(g=>g.track===d)};function s(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const S=u._reverseStreams[m],y=u._streams[S.id];f=f.replace(new RegExp(y.id,"g"),S.id)}),new RTCSessionDescription({type:d.type,sdp:f})}function o(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const S=u._reverseStreams[m],y=u._streams[S.id];f=f.replace(new RegExp(S.id,"g"),y.id)}),new RTCSessionDescription({type:d.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const d=t.RTCPeerConnection.prototype[u],f={[u](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[y=>{const g=s(this,y);m[0].apply(null,[g])},y=>{m[1]&&m[1].apply(null,y)},arguments[2]]):d.apply(this,arguments).then(y=>s(this,y))}};t.RTCPeerConnection.prototype[u]=f[u]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:s(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(g=>d.track===g)&&(m=this._streams[S])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ju(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function l0(t,e){er(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var om=Object.freeze({__proto__:null,fixNegotiationNeeded:l0,shimAddTrackRemoveTrack:c0,shimAddTrackRemoveTrackWithNative:a0,shimGetSendersWithDtmf:s0,shimGetUserMedia:n0,shimMediaStream:i0,shimOnTrack:r0,shimPeerConnection:ju,shimSenderReceiverGetStats:o0});function u0(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){mh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function Tw(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function d0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Bu(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((d,f)=>{c.set(f,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,a)}}function h0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function f0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),er(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function p0(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){mh("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function m0(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function g0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function v0(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function y0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function k0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var am=Object.freeze({__proto__:null,shimAddTransceiver:g0,shimCreateAnswer:k0,shimCreateOffer:y0,shimGetDisplayMedia:Tw,shimGetParameters:v0,shimGetUserMedia:u0,shimOnTrack:d0,shimPeerConnection:Bu,shimRTCDataChannel:m0,shimReceiverGetStats:f0,shimRemoveStream:p0,shimSenderGetStats:h0});function S0(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function T0(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function C0(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[f]);return d?(m.then(u,d),Promise.resolve()):m},e.createAnswer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[f]);return d?(m.then(u,d),Promise.resolve()):m};let a=function(c,u,d){const f=r.apply(this,[c]);return d?(f.then(u,d),Promise.resolve()):f};e.setLocalDescription=a,a=function(c,u,d){const f=s.apply(this,[c]);return d?(f.then(u,d),Promise.resolve()):f},e.setRemoteDescription=a,a=function(c,u,d){const f=o.apply(this,[c]);return d?(f.then(u,d),Promise.resolve()):f},e.addIceCandidate=a}function b0(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(w0(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function w0(t){return t&&t.video!==void 0?Object.assign({},t,{video:t0(t.video)}):t}function E0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(mh("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function _0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function P0(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function R0(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var cm=Object.freeze({__proto__:null,shimAudioContext:R0,shimCallbacksAPI:C0,shimConstraints:w0,shimCreateOfferLegacy:P0,shimGetUserMedia:b0,shimLocalStreamsAPI:S0,shimRTCIceServerUrls:E0,shimRemoteStreamsAPI:T0,shimTrackEventTransceiver:_0}),wl={exports:{}},lm;function Cw(){return lm||(lm=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],u=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const d=e.parseRtpMap(u),f=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=f.length?e.parseFmtp(f[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(m=>e.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),c=a.length>0&&a[0].ssrc;let u;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(y=>parseInt(y,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(u=d[0][1]),r.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let S={ssrc:c,codecPayloadType:parseInt(m.parameters.apt,10)};c&&u&&(S.rtx={ssrc:u}),i.push(S),s&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(S))}}),i.length===0&&c&&i.push({ssrc:c});let f=e.matchPrefix(n,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,i.forEach(m=>{m.maxBitrate=f})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(wl)),wl.exports}var I0=Cw(),xr=uw(I0),bw=MC({__proto__:null,default:xr},[I0]);function da(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=xr.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,er(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Vu(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||er(t,"icecandidate",e=>{if(e.candidate){const n=xr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function ha(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=xr.splitSections(a.sdp);return c.shift(),c.some(u=>{const d=xr.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const d=xr.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),u=r(c),d=s(arguments[0],c);let f;u===0&&d===0?f=Number.POSITIVE_INFINITY:u===0||d===0?f=Math.max(u,d):f=Math.min(u,d);const m={};Object.defineProperty(m,"maxMessageSize",{get(){return f}}),this._sctp=m}return o.apply(this,arguments)}}function fa(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},er(t,"datachannel",i=>(e(i.channel,i.target),i))}function zu(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Wu(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function pa(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ma(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var ww=Object.freeze({__proto__:null,removeExtmapAllowMixed:Wu,shimAddIceCandidateNullOrEmpty:pa,shimConnectionState:zu,shimMaxMessageSize:ha,shimParameterlessSetLocalDescription:ma,shimRTCIceCandidate:da,shimRTCIceCandidateRelayProtocol:Vu,shimSendThrowTypeError:fa});function Ew(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=e0,i=Sw(t),r={browserDetails:i,commonShim:ww,extractVersion:ws,disableLog:yw,disableWarnings:kw,sdp:bw};switch(i.browser){case"chrome":if(!om||!ju||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=om,pa(t,i),ma(t),n0(t,i),i0(t),ju(t,i),r0(t),c0(t,i),s0(t),o0(t),l0(t,i),da(t),Vu(t),zu(t),ha(t,i),fa(t),Wu(t,i);break;case"firefox":if(!am||!Bu||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=am,pa(t,i),ma(t),u0(t,i),Bu(t,i),d0(t),p0(t),h0(t),f0(t),m0(t),g0(t),v0(t),y0(t),k0(t),da(t),zu(t),ha(t,i),fa(t);break;case"safari":if(!cm||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=cm,pa(t,i),ma(t),E0(t),P0(t),C0(t),S0(t),T0(t),_0(t),b0(t),R0(t),da(t),Vu(t),ha(t,i),fa(t),Wu(t,i);break;default:n("Unsupported browser!");break}return r}Ew({window:typeof window>"u"?void 0:window});const _w=/version\/(\d+(\.?_?\d+)+)/i;let El;function At(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(El===void 0||e){const i=Pw.find(r=>{let{test:s}=r;return s.test(n)});El=i==null?void 0:i.describe(n)}return El}const Pw=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:ga(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:_l(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:ga(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:_l(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:ga(_w,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:_l(t)}}}];function ga(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function _l(t){return t.includes("mac os")?ga(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var Rw="2.16.1";const Iw=Rw,xw=16;class On extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var xe;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(xe||(xe={}));class ce extends On{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=xe[n]}static notAllowed(e,n,i){return new ce(e,xe.NotAllowed,n,i)}static timeout(e){return new ce(e,xe.Timeout)}static leaveRequest(e,n){return new ce(e,xe.LeaveRequest,void 0,n)}static internal(e,n){return new ce(e,xe.InternalError,void 0,n)}static cancelled(e){return new ce(e,xe.Cancelled)}static serverUnreachable(e,n){return new ce(e,xe.ServerUnreachable,n)}static websocket(e,n,i){return new ce(e,xe.WebSocket,n,i)}}class gh extends On{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Vn extends On{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class Ow extends On{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class $e extends On{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class qu extends On{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class um extends On{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class dm extends On{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:ph[n]}}var gt;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(gt||(gt={}));class qt extends On{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=gt[n]}}class or extends On{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Ja;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Ja||(Ja={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Ja||(Ja={}));class st{}st.setTimeout=function(){return setTimeout(...arguments)};st.setInterval=function(){return setInterval(...arguments)};st.clearTimeout=function(){return clearTimeout(...arguments)};st.clearInterval=function(){return clearInterval(...arguments)};var z;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(z||(z={}));var Q;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(Q||(Q={}));var $;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})($||($={}));var G;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(G||(G={}));function Mw(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class we{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Aw=["vp8","h264"],Dw=["vp8","h264","vp9","av1","h265"];function Nw(t){return!!Aw.find(e=>e===t)}const Lw=Nw;var hm;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(hm||(hm={}));var Hu;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Hu||(Hu={}));const so={h90:new we(160,90,9e4,20),h180:new we(320,180,16e4,20),h216:new we(384,216,18e4,20),h360:new we(640,360,45e4,20),h540:new we(960,540,8e5,25),h720:new we(1280,720,17e5,30),h1080:new we(1920,1080,3e6,30),h1440:new we(2560,1440,5e6,30),h2160:new we(3840,2160,8e6,30)},Gu={h120:new we(160,120,7e4,20),h180:new we(240,180,125e3,20),h240:new we(320,240,14e4,20),h360:new we(480,360,33e4,20),h480:new we(640,480,5e5,20),h540:new we(720,540,6e5,25),h720:new we(960,720,13e5,30),h1080:new we(1440,1080,23e5,30),h1440:new we(1920,1440,38e5,30)},vh={h360fps3:new we(640,360,2e5,3,"medium"),h360fps15:new we(640,360,4e5,15,"medium"),h720fps5:new we(1280,720,8e5,5,"medium"),h720fps15:new we(1280,720,15e5,15,"medium"),h720fps30:new we(1280,720,2e6,30,"medium"),h1080fps15:new we(1920,1080,25e5,15,"medium"),h1080fps30:new we(1920,1080,5e6,30,"medium"),original:new we(0,0,7e6,30,"medium")};function x0(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:u}=A0(t??{}),d=e==null?void 0:e.processor,f=n==null?void 0:n.processor,m=a??{};return m.audio===!0&&(m.audio={}),m.video===!0&&(m.video={}),m.audio&&(Ku(m.audio,e),(i=(s=m.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||d)&&(m.audio.processor=c??d)),m.video&&(Ku(m.video,n),(r=(o=m.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(u||f)&&(m.video.processor=u??f)),m}function Ku(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function yh(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(u=>{switch(u){case"resolution":Ku(a,c.resolution);break;default:a[u]=c[u]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function O0(t){return I(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=M0();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield ot(n),r.getByteTimeDomainData(o);const c=o.some(u=>u!==128&&u!==0);return i.close(),!c}return!1}()})}function M0(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>I(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function Uw(t){return t==="audioinput"?F.Source.Microphone:t==="videoinput"?F.Source.Camera:F.Source.Unknown}function $u(t){return t===F.Source.Microphone?"audioinput":t===F.Source.Camera?"videoinput":void 0}function Fw(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Yi()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Ls(t){return t.split("/")[1].toLowerCase()}function jw(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new lh({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function fe(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?fe(t.track):{})}}function Bw(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Vw(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function A0(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:Mw(e)}}function zw(t){switch(t){case He.CAMERA:return F.Source.Camera;case He.MICROPHONE:return F.Source.Microphone;case He.SCREEN_SHARE:return F.Source.ScreenShare;case He.SCREEN_SHARE_AUDIO:return F.Source.ScreenShareAudio;default:return F.Source.Unknown}}function fm(t,e){return t.width*t.height<e.width*e.height}function Ww(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const qw=5e3,ms=[];var Ut;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Ut||(Ut={}));class F extends xn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=F.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ue,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),qw):this.handleAppVisibilityChanged()},this.log=Qn((r=i.loggerName)!==null&&r!==void 0?r:pn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=F.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),fe(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===F.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===F.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(ms.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&ms.splice(ms.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Sr(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?G.AudioPlaybackStarted:G.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?G.AudioPlaybackFailed:G.VideoPlaybackFailed,s):s.name==="AbortError"?ue.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):ue.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(G.ElementAttached,e),e}detach(e){try{if(e){Or(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(G.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Or(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(G.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Qn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),ms.forEach(i=>{i.parentElement||(n=!1)}),n&&ms.push(e)}}handleAppVisibilityChanged(){return I(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===F.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){It()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){It()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Sr(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Yi()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Yi()||Qi())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Or(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(u){u.Audio="audio",u.Video="video",u.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(u){u.Camera="camera",u.Microphone="microphone",u.ScreenShare="screen_share",u.ScreenShareAudio="screen_share_audio",u.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(u){u.Active="active",u.Paused="paused",u.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(u){switch(u){case e.Audio:return an.AUDIO;case e.Video:return an.VIDEO;default:return an.DATA}}t.kindToProto=r;function s(u){switch(u){case an.AUDIO:return e.Audio;case an.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(u){switch(u){case n.Camera:return He.CAMERA;case n.Microphone:return He.MICROPHONE;case n.ScreenShare:return He.SCREEN_SHARE;case n.ScreenShareAudio:return He.SCREEN_SHARE_AUDIO;default:return He.UNKNOWN}}t.sourceToProto=o;function a(u){switch(u){case He.CAMERA:return n.Camera;case He.MICROPHONE:return n.Microphone;case He.SCREEN_SHARE:return n.ScreenShare;case He.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(u){switch(u){case Nu.ACTIVE:return i.Active;case Nu.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(F||(F={}));const Hw="|",pm="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Gw(t){const e=t.split(Hw);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function ot(t){return I(this,void 0,void 0,function*(){return new Promise(e=>st.setTimeout(e,t))})}function Ju(){return"addTransceiver"in RTCPeerConnection.prototype}function Qu(){return"addTrack"in RTCPeerConnection.prototype}function Kw(){if(!("getCapabilities"in RTCRtpSender)||Yi()||Qi())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function $w(){if(!("getCapabilities"in RTCRtpSender)||Qi())return!1;if(Yi()){const n=At();if(n!=null&&n.version&&In(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&In(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function ln(t){return t==="av1"||t==="vp9"}function Yu(t){return!document||oo()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function Jw(){return typeof RTCPeerConnection>"u"?!1:Ju()||Qu()}function Qi(){var t;return((t=At())===null||t===void 0?void 0:t.name)==="Firefox"}function mm(){const t=At();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Yi(){var t;return((t=At())===null||t===void 0?void 0:t.name)==="Safari"}function oo(){const t=At();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function Qw(){const t=At();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&In(t.osVersion,"17")>=0}function Yw(t){return t||(t=At()),(t==null?void 0:t.name)==="Safari"&&In(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&In(t.osVersion,"18.3")>0}function D0(){var t,e;return It()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Xw(){const t=At(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&In(t.osVersion,e)>=0?!0:t.name==="Safari"&&In(t.version,e)>=0}function It(){return typeof document<"u"}function Rn(){return navigator.product=="ReactNative"}function qr(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Pl(t){return qr(t)?t.hostname.split(".")[0]:null}function N0(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function L0(){if(!Rn())return;let t=N0();if(t)return t.platform}function gm(){if(It())return window.devicePixelRatio;if(Rn()){let t=N0();if(t)return t.devicePixelRatio}return 1}function In(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function Zw(t){for(const e of t)e.target.handleResize(e)}function eE(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Rl=null;const vm=()=>(Rl||(Rl=new ResizeObserver(Zw)),Rl);let Il=null;const ym=()=>(Il||(Il=new IntersectionObserver(eE,{root:null,rootMargin:"0px"})),Il);function tE(){var t;const e=new Ly({sdk:Uy.JS,protocol:xw,version:Iw});return Rn()&&(e.os=(t=L0())!==null&&t!==void 0?t:""),e}function km(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let gs;function xl(){if(!gs){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[gs]=i.stream.getAudioTracks(),!gs)throw Error("Could not get empty media stream audio track");gs.enabled=!1}return gs.clone()}class $t{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>I(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function nE(t){return Dw.includes(t)}function Si(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function iE(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function ao(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function rE(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var u;const d=(u=e.get(i))!==null&&u!==void 0?u:Date.now(),f=Date.now();return c?e.delete(i):e.set(i,d),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:d,lastReceivedTime:f}})}function sE(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Sm(t){switch(t.reason){case xe.LeaveRequest:return t.context;case xe.Cancelled:return un.CLIENT_INITIATED;case xe.NotAllowed:return un.USER_REJECTED;case xe.ServerUnreachable:return un.JOIN_FAILURE;default:return un.UNKNOWN_REASON}}function va(t){return t!==void 0?Number(t):void 0}function Fi(t){return t!==void 0?BigInt(t):void 0}function Mr(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Pn(t){return!!t&&t.kind==F.Kind.Audio}function Ii(t){return!!t&&t.kind==F.Kind.Video}function ti(t){return Mr(t)&&Ii(t)}function An(t){return Mr(t)&&Pn(t)}function Xu(t){return!!t&&!t.isLocal}function oE(t){return!!t&&!t.isLocal}function Ol(t){return Xu(t)&&Ii(t)}function aE(t){return t.isLocal}function cE(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function lE(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function uE(t,e){const n=new URL(iE(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),F0(n,"rtc")}function dE(t){const e=new URL(ao(t));return F0(e,"validate")}function U0(t){return t.endsWith("/")?t:"".concat(t,"/")}function F0(t,e){return t.pathname="".concat(U0(t.pathname)).concat(e),t.toString()}function Tm(t){if(typeof t=="string")return Zp.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Zp.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function hE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const fE=10,vs="lk_e2ee",pE="LKFrameEncryptionKey",mE={sharedKey:!1,ratchetSalt:pE,ratchetWindowSize:8,failureTolerance:fE,keyringSize:16};var Ti;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Ti||(Ti={}));var Cm;(function(t){t.KeyRatcheted="keyRatcheted"})(Cm||(Cm={}));var ui;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(ui||(ui={}));var bm;(function(t){t.Error="cryptorError"})(bm||(bm={}));function gE(){return vE()||Zu()}function Zu(){return typeof window.RTCRtpScriptTransform<"u"}function vE(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function yE(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new Iy({value:t.value})}class v1 extends xn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{ue.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},mE),e),this.on(Ti.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Ti.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Ti.RatchetRequest,e,n)}}var wm;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(wm||(wm={}));class kE extends xn.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(ue.error(a.error.message),a.uuid){const d=this.decryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}const f=this.encryptDataRequests.get(a.uuid);if(f!=null&&f.reject){f.reject(a.error);break}}this.emit(ui.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(ui.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const d=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!d)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(ui.ParticipantEncryptionStatusChanged,a.enabled,d)}break;case"ratchetKey":this.keyProvider.emit(Ti.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break;case"encryptDataResponse":const u=this.encryptDataRequests.get(a.uuid);u!=null&&u.resolve&&u.resolve(a);break}},this.onWorkerError=i=>{ue.error("e2ee worker encountered an error:",{error:i.error}),this.emit(ui.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!gE())throw new gh("tried to setup end-to-end encryption on an unsupported browser");if(ue.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:fw.getLevel()}};this.worker&&(ue.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ue.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ue.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on($.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(z.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Qe.NONE,r.identity)),e.on(z.ConnectionStateChanged,i=>{i===Se.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Qe.NONE,r.identity)})})}).on(z.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(z.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(z.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Q.LocalSenderCreated,(i,r)=>I(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(Q.LocalTrackPublished,i=>{if(!Ii(i.track)||!oo())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Ls(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(Ti.SetKey,i=>this.postKey(i)).on(Ti.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return I(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new $t;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new $t;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Ls(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Mr(e)||!n){n||ue.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return I(this,void 0,void 0,function*(){if(this.worker){if(Zu()&&!mm()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(vs in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:vs in e}};this.worker.postMessage(a,[o,s])}e[vs]=!0}})}handleSender(e,n,i){var r;if(!(vs in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Zu()&&!mm()){ue.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{ue.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[vs]=!0}}}const SE=500,TE=15e3;class Ar{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Ar),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=Pl(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,ot(Math.min(SE*Math.pow(2,s),TE)))}getBackOffPromise(e){const n=new URL(e),i=n&&Pl(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Pl(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Ar._instance=null;const Ml="default";class et{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new et),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=et.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){ue.debug("awaiting getUserMedia promise");try{n?yield et.userMediaPromiseMap.get(n):yield Promise.all(et.userMediaPromiseMap.values())}catch{ue.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Yi()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const u=c.label==="",d=n?c.kind===n:!0;return u&&d}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},u=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),u.getTracks().forEach(d=>{d.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return I(this,void 0,void 0,function*(){if(n!==Ml)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===Ml);if(!s){ue.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==Ml&&a.groupId===(i??s.groupId));if(!o){ue.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?et.userMediaPromiseMap.has(e):et.userMediaPromiseMap.size>0}}et.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];et.userMediaPromiseMap=new Map;var Us;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Us||(Us={}));class CE{constructor(){this.pendingTasks=new Map,this.taskMutex=new kt,this.nextTaskIndex=0}run(e){return I(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Us.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Us.RUNNING,yield e()}finally{n.status=Us.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return I(this,void 0,void 0,function*(){return this.run(()=>I(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class bE{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,c)};this.opened=new Promise((a,c)=>{s.onopen=()=>{a({readable:new ReadableStream({start(u){s.onmessage=d=>{let{data:f}=d;return u.enqueue(f)},s.onerror=d=>u.error(d)},cancel:o}),writable:new WritableStream({write(u){s.send(u)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Promise((a,c)=>{const u=()=>I(this,void 0,void 0,function*(){const d=new Promise(m=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",S=>{m(S)},{once:!0})}),f=yield Promise.race([ot(250),d]);f?a(f):c(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=d=>{let{code:f,reason:m}=d;a({closeCode:f,reason:m}),s.removeEventListener("error",u)},s.addEventListener("error",u)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}const wE=["syncState","trickle","offer","answer","simulate","leave"];function EE(t){const e=wE.indexOf(t.case)>=0;return ue.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Ee;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Ee||(Ee={}));const _E=250;class kh{get currentState(){return this.state}get isDisconnected(){return this.state===Ee.DISCONNECTING||this.state===Ee.DISCONNECTED}get isEstablishingConnection(){return this.state===Ee.CONNECTING||this.state===Ee.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Ee.DISCONNECTED,this.log=ue,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Qn((i=n.loggerName)!==null&&i!==void 0?i:pn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new CE,this.queuedRequests=[],this.closingLock=new kt,this.connectionLock=new kt,this.state=Ee.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return I(this,void 0,void 0,function*(){return this.state=Ee.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return I(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ee.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return I(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=i;const o=tE(),a=i.singlePeerConnection?RE(n,o,i):PE(n,o,i),c=uE(e,a),u=dE(c);return new Promise((d,f)=>I(this,void 0,void 0,function*(){var m,S;try{let y=!1;const g=C=>I(this,void 0,void 0,function*(){if(y)return;y=!0;const x=C instanceof Event?C.currentTarget:C,A=hE(x,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(A)).catch(D=>{this.log.error(D),this.close()}):this.close(),E(),f(ce.cancelled(A))});r==null||r.addEventListener("abort",g);const E=()=>{clearTimeout(v),r==null||r.removeEventListener("abort",g)},v=setTimeout(()=>{g(ce.timeout("room connection has timed out (signal)"))},i.websocketTimeout),T=(C,x)=>{this.handleSignalConnected(C,v,x)},b=new URL(c);b.searchParams.has("access_token")&&b.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(b),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new bE(c);try{this.ws.closed.then(R=>{var M;this.isEstablishingConnection&&f(ce.internal("Websocket got closed during a (re)connection attempt: ".concat(R.reason))),R.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:R.reason,code:R.closeCode,wasClean:R.closeCode===1e3,state:this.state})),this.state===Ee.CONNECTED&&this.handleOnClose((M=R.reason)!==null&&M!==void 0?M:"Unexpected WS error"))}).catch(R=>{this.isEstablishingConnection&&f(ce.internal("Websocket error during a (re)connection attempt: ".concat(R)))});const C=yield this.ws.opened.catch(R=>I(this,void 0,void 0,function*(){if(this.state!==Ee.CONNECTED){this.state=Ee.DISCONNECTED,clearTimeout(v);const M=yield this.handleConnectionError(R,u);f(M);return}this.handleWSError(R),f(R)}));if(clearTimeout(v),!C)return;const x=C.readable.getReader();this.streamWriter=C.writable.getWriter();const A=yield x.read();if(x.releaseLock(),!A.value)throw ce.internal("no message received as first message");const D=Tm(A.value),U=this.validateFirstMessage(D,(m=i.reconnect)!==null&&m!==void 0?m:!1);if(!U.isValid){f(U.error);return}((S=D.message)===null||S===void 0?void 0:S.case)==="join"&&(this.pingTimeoutDuration=D.message.value.pingTimeout,this.pingIntervalDuration=D.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const V=U.shouldProcessFirstMessage?D:void 0;T(C,V),d(U.response)}catch(C){f(C)}finally{E()}}finally{s()}}))})}startReadingLoop(e,n){return I(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield ot(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=Tm(r);this.handleSignalResponse(s)}})}close(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([Ee.DISCONNECTING||Ee.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Ee.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,ot(_E)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=Ee.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Tr(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Tr(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new kc({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Sc({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return I(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new dh({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new qy({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Ky({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Ae.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Qy({timestamp:Ae.parse(Date.now()),rtt:Ae.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new uh({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Cc({reason:un.CLIENT_INITIATED,action:Ir.DISCONNECT})})}sendRequest(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!EE(n)&&i.state===Ee.RECONNECTING){i.queuedRequests.push(()=>I(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield ot(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new Fb({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=Em(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=Em(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return I(this,void 0,void 0,function*(){if(this.state===Ee.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=st.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&st.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=st.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&st.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=Ee.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Ee.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:ce.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:ce.internal("Unexpected first message")}:{isValid:!1,error:ce.internal("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(e,n){return I(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return ce.notAllowed(r,i.status)}else return e instanceof ce?e:ce.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof ce?i:ce.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function Em(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Tr(t,e){return new Ei({sdp:t.sdp,type:t.type,id:e})}function PE(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Rn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function RE(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new ow({clientInfo:e,connectionSettings:new Yy({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new aw({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class _m{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class IE{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var tn={},Al={},Dl={exports:{}},Pm;function Sh(){if(Pm)return Dl.exports;Pm=1;var t=Dl.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Dl.exports}var Rm;function xE(){return Rm||(Rm=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,u,d){if(d&&!u)c[d]=e(a[1]);else for(var f=0;f<u.length;f+=1)a[f+1]!=null&&(c[u[f]]=e(a[f+1]))},i=function(a,c,u){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var f=a.push?{}:d?c[a.name]:c;n(u.match(a.reg),f,a.names,a.name),a.push&&c[a.push].push(f)},r=Sh(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},u=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(f){var m=f[0],S=f.slice(2);m==="m"&&(u.push({rtp:[],fmtp:[]}),d=u[u.length-1]);for(var y=0;y<(r[m]||[]).length;y+=1){var g=r[m][y];if(g.reg.test(S))return i(g,d,S)}}),c.media=u,c};var o=function(a,c){var u=c.split(/=(.+)/,2);return u.length===2?a[u[0]]=e(u[1]):u.length===1&&c.length>1&&(a[u[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],u=a.split(" ").map(e),d=0;d<u.length;d+=3)c.push({component:u[d],ip:u[d+1],port:u[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(u){var d,f=!1;return u[0]!=="~"?d=e(u):(d=e(u.substring(1,u.length)),f=!0),{scid:d,paused:f}})})}}(Al)),Al}var Nl,Im;function OE(){if(Im)return Nl;Im=1;var t=Sh(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,u=c.length;return o.replace(e,function(d){if(a>=u)return d;var f=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(f);case"%d":return Number(f);case"%v":return""}})},i=function(o,a,c){var u=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+u];if(a.names)for(var f=0;f<a.names.length;f+=1){var m=a.names[f];a.name?d.push(c[a.name][m]):d.push(c[a.names[f]])}else d.push(c[a.name]);return n.apply(null,d)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Nl=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(f){f.payloads==null&&(f.payloads="")});var c=a.outerOrder||r,u=a.innerOrder||s,d=[];return c.forEach(function(f){t[f].forEach(function(m){m.name in o&&o[m.name]!=null?d.push(i(f,m,o)):m.push in o&&o[m.push]!=null&&o[m.push].forEach(function(S){d.push(i(f,m,S))})})}),o.media.forEach(function(f){d.push(i("m",t.m[0],f)),u.forEach(function(m){t[m].forEach(function(S){S.name in f&&f[S.name]!=null?d.push(i(m,S,f)):S.push in f&&f[S.push]!=null&&f[S.push].forEach(function(y){d.push(i(m,S,y))})})})}),d.join(`\r
`)+`\r
`},Nl}var xm;function ME(){if(xm)return tn;xm=1;var t=xE(),e=OE(),n=Sh();return tn.grammar=n,tn.write=e,tn.parse=t.parse,tn.parseParams=t.parseParams,tn.parseFmtpConfig=t.parseFmtpConfig,tn.parsePayloads=t.parsePayloads,tn.parseRemoteCandidates=t.parseRemoteCandidates,tn.parseImageAttributes=t.parseImageAttributes,tn.parseSimulcastStreamList=t.parseSimulcastStreamList,tn}var ni=ME();function Th(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,u=Date.now(),d=[];function f(){if(c!==void 0){var S=Date.now()-u;if(S+e>=c)return c-S}return e}var m=function(){var S=[].slice.call(arguments),y=this;return new Promise(function(g,E){var v=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,u=Date.now(),!o){var b=t.apply(y,S);a&&a(b),d.forEach(function(C){return(0,C.resolve)(b)}),d=[]}},f()),v){var T=t.apply(y,S);return a&&a(T),g(T)}d.push({resolve:g,reject:E})})};return m.cancel=function(S){s!==void 0&&clearTimeout(s),d.forEach(function(y){return(0,y.reject)(S)}),d=[]},m}const AE=.7,DE=20,Dr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Om extends xn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=ue,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Th(r=>I(this,void 0,void 0,function*(){this.emit(Dr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),DE),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Qn((i=n.loggerName)!==null&&i!==void 0?i:pn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new kt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return I(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return I(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=NE(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=ni.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=Ch(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let u=0;if(o.rtp.some(f=>f.codec.toUpperCase()===c.codec.toUpperCase()?(u=f.payload,!0):!1),u===0)return!0;let d=!1;for(const f of o.fmtp)if(f.payload===u){f.config=f.config.split(";").filter(m=>!m.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(f.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),d=!0;break}return d||c.maxbr>0&&o.fmtp.push({payload:u,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=ni.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Dr.NegotiationComplete),e.sdp&&ni.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Dr.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return I(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=ni.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{Am(a),a.type==="audio"?Mm(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let u=0;if(a.rtp.some(f=>f.codec.toUpperCase()===c.codec.toUpperCase()?(u=f.payload,!0):!1),u===0||(ln(c.codec)&&!Yi()&&this.ensureVideoDDExtensionForSVC(a,o),!ln(c.codec)))return!0;const d=Math.round(c.maxbr*AE);for(const f of a.fmtp)if(f.payload===u){f.config.includes("x-google-start-bitrate")||(f.config+=";x-google-start-bitrate=".concat(d));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,ni.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=ni.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Am(r),r.type==="audio"&&Mm(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,ni.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new $e("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new $e("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return I(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return I(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new qu(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===pm))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(u=>{u.value>o&&(o=u.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:pm})}}}function Mm(t,e,n){const i=Ch(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function NE(t){var e;const n=[],i=[],r=ni.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const c=Ch(o.mid);o.type==="audio"&&(o.rtp.some(u=>u.codec==="opus"?(s=u.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(u=>u.payload===s&&u.type==="nack")&&i.push(c),o.fmtp.some(u=>u.payload===s?(u.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function Am(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Ch(t){return typeof t=="number"?t.toFixed(0):t}const ed="vp8",LE={audioPreset:Hu.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:vh.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:ed,backupCodec:!0,preConnectBuffer:!1},j0={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},B0={deviceId:{ideal:"default"},resolution:so.h720.resolution},UE={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new mw,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},bh={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ue;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Ue||(Ue={}));class FE{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=bh.peerConnectionTimeout,this.log=ue,this.updateState=()=>{var s,o;const a=this.state,c=this.requiredTransports.map(u=>u.getConnectionState());c.every(u=>u==="connected")?this.state=Ue.CONNECTED:c.some(u=>u==="failed")?this.state=Ue.FAILED:c.some(u=>u==="connecting")?this.state=Ue.CONNECTING:c.every(u=>u==="closed")?this.state=Ue.CLOSED:c.some(u=>u==="closed")?this.state=Ue.CLOSING:c.every(u=>u==="new")&&(this.state=Ue.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(Ue[a]," to ").concat(Ue[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=Qn((r=i.loggerName)!==null&&r!==void 0?r:pn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new Om(e,i),n!=="publisher-only"&&(this.subscriber=new Om(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,cn.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,cn.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=Ue.NEW,this.connectionLock=new kt,this.remoteOfferLock=new kt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return I(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return I(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return I(this,void 0,void 0,function*(){var i;n===cn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return I(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return I(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return I(this,void 0,void 0,function*(){return new Promise((n,i)=>I(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Dr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Dr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===cn.PUBLISHER?this.publisher.getConnectedAddress():e===cn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return I(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,u)=>I(s,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),st.clearTimeout(f),u(ce.cancelled("room connection has been cancelled"))};r!=null&&r.signal.aborted&&d(),r==null||r.signal.addEventListener("abort",d);const f=st.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",d),u(ce.internal("could not establish pc connection"))},o);for(;this.state!==Ue.CONNECTED;)if(yield ot(50),r!=null&&r.signal.aborted){u(ce.cancelled("room connection has been cancelled"));return}st.clearTimeout(f),r==null||r.signal.removeEventListener("abort",d),c()}))}()})}}const V0=5e3,jE=3e4;class ve{static fetchRegionSettings(e,n,i){return I(this,void 0,void 0,function*(){const r=yield ve.fetchLock.lock();try{const s=yield fetch("".concat(BE(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=lE(s.headers),a=o?o*1e3:V0;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw s.status===401?ce.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):ce.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof ce?s:i!=null&&i.aborted?ce.cancelled("Region fetching was aborted"):ce.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{r()}})}static scheduleRefetch(e,n,i){return I(this,void 0,void 0,function*(){const r=ve.settingsTimeouts.get(e.hostname);clearTimeout(r),ve.settingsTimeouts.set(e.hostname,setTimeout(()=>I(this,void 0,void 0,function*(){try{const s=yield ve.fetchRegionSettings(e,n);ve.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof ce&&s.reason===xe.NotAllowed){ue.debug("token is not valid, cancelling auto region refresh");return}ue.debug("auto refetching of region settings failed",{error:s}),ve.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){ve.cache.set(e.hostname,i),ve.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=ve.settingsTimeouts.get(e);n&&(clearTimeout(n),ve.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=ve.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=ve.connectionTrackers.get(e);i&&i.connectionCount===0&&(ue.debug("stopping region refetch after disconnect delay",{hostname:e}),ve.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},jE))}static cancelCleanup(e){const n=ve.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=ve.connectionTrackers.get(e);n||(n={connectionCount:0},ve.connectionTrackers.set(e,n)),n.connectionCount++,ve.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=ve.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&ve.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return qr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return I(this,void 0,void 0,function*(){return ve.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return I(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=ve.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),ve.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),ue.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){ve.updateCachedRegionSettings(this.serverUrl,this.token,e)}}ve.cache=new Map;ve.settingsTimeouts=new Map;ve.connectionTrackers=new Map;ve.fetchLock=new kt;function BE(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Be extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Dm(n,Be.MAX_MESSAGE_BYTES),this.data=i?Dm(i,Be.MAX_DATA_BYTES):void 0}static fromProto(e){return new Be(e.code,e.message,e.data)}toProto(){return new My({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Be(Be.ErrorCode[e],Be.ErrorMessage[e],n)}}Be.MAX_MESSAGE_BYTES=256;Be.MAX_DATA_BYTES=15360;Be.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Be.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const z0=15360;function wh(t){return new TextEncoder().encode(t).length}function Dm(t,e){if(wh(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Eh=2e3;function wc(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const _h=typeof MediaRecorder<"u";class VE{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const zE=_h?MediaRecorder:VE;class WE extends zE{constructor(e,n){if(!_h)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=u=>I(this,void 0,void 0,function*(){let d;if(u.data.arrayBuffer){const f=yield u.data.arrayBuffer();d=new Uint8Array(f)}else if(u.data.byteArray)d=u.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(d)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function qE(){return _h}const HE=1e3,GE=1e4;class W0 extends F{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Th(()=>I(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>I(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(G.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new kt,this.pauseUpstreamLock=new kt,this.trackChangeLock=new kt,this.trackChangeLock.lock().then(o=>I(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==F.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return I(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Or(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Sr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Sr(r??e,s)}))})}waitForDimensions(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:HE;return function*(){var i;if(e.kind===F.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=At())===null||i===void 0?void 0:i.os)==="iOS"&&(yield ot(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield ot(50)}throw new Vn("unable to get track dimensions after timeout")}()})}setDeviceId(e){return I(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Si(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Si(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===F.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===F.Kind.Audio?"audioinput":"videoinput";return n?et.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return I(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return I(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return I(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Vn("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return I(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=gw(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===F.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(u=>{Or(this.mediaStreamTrack,u)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===F.Kind.Video&&(yield c.applyConstraints(s)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(G.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?G.Muted:G.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),D0()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(G.UpstreamPaused,this);const i=At();if((i==null?void 0:i.name)==="Safari"&&In(i.version,"12.0")<0)throw new gh("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(G.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return I(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Sr(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(u=>{u instanceof DOMException&&u.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:u})),setTimeout(()=>{a.play().catch(d=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:d}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:u}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const u of i.attachedElements)u!==i.processorElement&&r&&(Or(i._mediaStreamTrack,u),Sr(i.processor.processedTrack,u));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(G.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(G.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!qE()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new WE(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},GE)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Qa extends W0{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,F.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>I(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=wc(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(G.AudioTrackFeatureUpdate,this,Ze.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(G.AudioTrackFeatureUpdate,this,Ze.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===F.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Si(this._constraints.deviceId);return this.source===F.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return I(this,void 0,void 0,function*(){let n;if(e){const i=yh({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return I(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){It()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Eh)))}setProcessor(e){return I(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!Rn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(G.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return I(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return I(this,void 0,void 0,function*(){const e=yield O0(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(G.AudioSilenceDetected)),e})}}function KE(t,e,n){switch(t.kind){case"audio":return new Qa(t,e,!1,void 0,n);case"video":return new Ya(t,e,!1,n);default:throw new Vn("unsupported track type: ".concat(t.kind))}}const $E=Object.values(so),JE=Object.values(Gu),QE=Object.values(vh),YE=[so.h180,so.h360],XE=[Gu.h180,Gu.h360],ZE=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new we(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),td=["q","h","f"];function nd(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,u=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=t_(t,e,n,u),ue.debug("using video encoding",o));const d=o.maxFramerate,f=new we(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&ln(u)){const y=new q0(c),g=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const E=At();if(oo()||Rn()||(E==null?void 0:E.name)==="Chrome"&&In(E==null?void 0:E.version,"113")<0){const v=y.suffix=="h"?2:3,T=Yw(E);for(let b=0;b<y.spatial;b+=1)g.push({rid:td[2-b],maxBitrate:o.maxBitrate/Math.pow(v,b),maxFramerate:f.encoding.maxFramerate,scaleResolutionDownBy:T?Math.pow(2,b):void 0});g[0].scalabilityMode=c}else g.push({maxBitrate:o.maxBitrate,maxFramerate:f.encoding.maxFramerate,scalabilityMode:c});return f.encoding.priority&&(g[0].priority=f.encoding.priority,g[0].networkPriority=f.encoding.priority),ue.debug("using svc encoding",{encodings:g}),g}if(!a)return[o];let m=[];t?m=(r=Lm(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Nm(t,f):m=(s=Lm(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:Nm(t,f);let S;if(m.length>0){const y=m[0];m.length>1&&([,S]=m);const g=Math.max(e,n);if(g>=960&&S)return Ll(e,n,[y,S,f],d);if(g>=480)return Ll(e,n,[y,f],d)}return Ll(e,n,[f])}function e_(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ue.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,u=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===F.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),nd(t.source===F.Source.ScreenShare,c,u,n)}function t_(t,e,n,i){const r=n_(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function n_(t,e,n){if(t)return QE;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?$E:JE}function Nm(t,e){if(t)return ZE(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?YE:XE}function Ll(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=td.length)return;const a=Math.min(t,e),u={rid:td[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},d=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;d&&(u.maxFramerate=d);const f=Qi()||o===0;s.encoding.priority&&f&&(u.priority=s.encoding.priority,u.networkPriority=s.encoding.priority),r.push(u)}),Rn()&&L0()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,ue.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ue.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Lm(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class q0{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function i_(t){return t.source===F.Source.ScreenShare||t.constraints.height&&Si(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const r_=5e3;class Ya extends W0{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,F.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>I(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(G.CpuConstrained)),this.prevStats){let c=0;o.forEach((u,d)=>{var f;const m=(f=this.prevStats)===null||f===void 0?void 0:f.get(d);c+=wc(u,m)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new kt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!It())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Eh))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return I(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Bn(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;a=!0)s=u.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return I(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Bn(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;a=!0){s=u.value,a=!1;const d=s;yield(o=d.sender)===null||o===void 0?void 0:o.replaceTrack(d.mediaStreamTrack)}}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===F.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===F.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return I(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=Ut.LOW;i<=Ut.HIGH;i+=1)n.push(new hh({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(ln(this.codec),n)}restartTrack(e){return I(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const f=yh({video:e});typeof f.video!="boolean"&&(a=f.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,u=Bn(this.simulcastCodecs.values()),d;d=yield u.next(),n=d.done,!n;c=!0){s=d.value,c=!1;const f=s;f.sender&&((o=f.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(f.mediaStreamTrack=this.mediaStreamTrack.clone(),yield f.sender.replaceTrack(f.mediaStreamTrack))}}catch(f){i={error:f}}finally{try{!c&&!n&&(r=u.return)&&(yield r.call(u))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return I(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,u,d,f;if(yield n.setProcessor.call(r,i,s),!((d=r.processor)===null||d===void 0)&&d.processedTrack)try{for(var m=!0,S=Bn(r.simulcastCodecs.values()),y;y=yield S.next(),o=y.done,!o;m=!0)u=y.value,m=!1,yield(f=u.sender)===null||f===void 0?void 0:f.replaceTrack(r.processor.processedTrack)}catch(g){a={error:g}}finally{try{!m&&!o&&(c=S.return)&&(yield c.call(S))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return I(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},r_))}setPublishingCodecs(e){return I(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(ln(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const u=[];try{for(n=!0,i=Bn(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const d=c;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(ln(d.codec),d.qualities);else{const f=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:f})),!f||!f.sender){for(const m of d.qualities)if(m.enabled){u.push(d.codec);break}}else f.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield Um(f.sender,f.encodings,d.qualities,this.senderLock,ln(d.codec),this.log,this.logContext))}}}catch(d){o={error:d}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return u})}setPublishingLayers(e,n){return I(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Um(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return I(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&ln(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),D0()&&this.isInBackground&&this.source===F.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Um(t,e,n,i,r,s,o){return I(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:u}=c;if(!u)return;if(u.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:u,senderEncodings:e}));return}let d=!1;!1&&u[0].scalabilityMode||(r&&n.some(S=>S.enabled)&&n.forEach(S=>S.enabled=!0),u.forEach((m,S)=>{var y;let g=(y=m.rid)!==null&&y!==void 0?y:"";g===""&&(g="q");const E=H0(g),v=n.find(T=>T.quality===E);v&&m.active!==v.enabled&&(d=!0,m.active=v.enabled,s.debug("setting layer ".concat(v.quality," to ").concat(m.active?"enabled":"disabled"),o),Qi()&&(v.enabled?(m.scaleResolutionDownBy=e[S].scaleResolutionDownBy,m.maxBitrate=e[S].maxBitrate,m.maxFrameRate=e[S].maxFrameRate):(m.scaleResolutionDownBy=4,m.maxBitrate=10,m.maxFrameRate=2)))})),d&&(c.encodings=u,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function H0(t){switch(t){case"f":return Ut.HIGH;case"h":return Ut.MEDIUM;case"q":return Ut.LOW;default:return Ut.HIGH}}function Fm(t,e,n,i){if(!n)return[new ki({quality:Ut.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new q0(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let u=0;u<s.spatial;u+=1)o.push(new ki({quality:Math.min(Ut.HIGH,s.spatial-1)-u,width:Math.ceil(t/Math.pow(a,u)),height:Math.ceil(e/Math.pow(a,u)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,u)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let u=H0((o=r.rid)!==null&&o!==void 0?o:"");return new ki({quality:u,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const jm="_lossy",Bm="_reliable",s_=2*1e3,Ul="leave-reconnect",o_=3e4,a_=8*1024,c_=256*1024;var Wt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Wt||(Wt={}));class l_ extends xn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=bh.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Wt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ue,this.reliableDataSequence=1,this.reliableMessageBuffer=new _m,this.reliableReceivedState=new IE(o_),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>I(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===Bm)s.reliableDCSub=o;else if(o.label===jm)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>I(this,void 0,void 0,function*(){var r,s,o,a,c;const u=yield this.dataProcessLock.lock();try{let d;if(i.data instanceof ArrayBuffer)d=i.data;else if(i.data instanceof Blob)d=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const f=vt.fromBinary(new Uint8Array(d));if(f.sequence>0&&f.participantSid!==""){const m=this.reliableReceivedState.get(f.participantSid);if(m&&f.sequence<=m)return;this.reliableReceivedState.set(f.participantSid,f.sequence)}if(((r=f.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit($.ActiveSpeakersUpdate,f.value.value.speakers);else if(((s=f.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const m=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(f.value.value.encryptedValue,f.value.value.iv,f.participantIdentity,f.value.value.keyIndex),S=Iy.fromBinary(m.payload),y=new vt({value:S.value,participantIdentity:f.participantIdentity,participantSid:f.participantSid});((a=y.value)===null||a===void 0?void 0:a.case)==="user"&&Vm(y,y.value.value),this.emit($.DataPacketReceived,y,f.value.value.encryptionType)}else((c=f.value)===null||c===void 0?void 0:c.case)==="user"&&Vm(f,f.value.value),this.emit($.DataPacketReceived,f,Qe.NONE)}finally{u()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?he.LOSSY:he.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit($.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===Ul&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=st.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Wt.Connected&&i();const s=()=>{this.off($.Disconnected,o),i()},o=()=>{this.off($.Restarted,s),r()};this.once($.Restarted,s),this.once($.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===he.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit($.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>I(this,void 0,void 0,function*(){!this.url||!(yield fetch(ao(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Ee.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Ee.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Ui.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>I(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(ao(this.url),{method:"HEAD"}),ot(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Qn((n=e.loggerName)!==null&&n!==void 0?n:pn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new kh(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new kt,this.dataProcessLock=new kt,this.dcBufferStatus=new Map([[he.LOSSY,!0],[he.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit($.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit($.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit($.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit($.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit($.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit($.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit($.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit($.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return I(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{ue.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit($.SignalConnected,s),s}catch(s){if(s instanceof ce&&s.reason===xe.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return I(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit($.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return I(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new _m,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return I(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Vn("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(ce.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return I(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return I(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Ue.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new FE(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit($.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>I(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===Ue.CONNECTED){const d=this.pcState===Wt.New;this.pcState=Wt.Connected,d&&this.emit($.Connected,e)}else s===Ue.FAILED&&(this.pcState===Wt.Connected||this.pcState===Wt.Reconnecting)&&(this.pcState=Wt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?Ui.RR_SUBSCRIBER_FAILED:Ui.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===Ee.RECONNECTING,u=[Ue.FAILED,Ue.CLOSING,Ue.CLOSED].includes(s);c&&u&&!this._isClosed&&this.emit($.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit($.MediaTrackAdded,s.track,s.streams[0],s.receiver)},u_((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>I(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>I(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit($.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit($.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit($.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit($.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit($.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Ui.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:V0,regionSettings:e.regions})),e.action){case Ir.DISCONNECT:this.emit($.Disconnected,e==null?void 0:e.reason),this.close();break;case Ir.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Ul);break;case Ir.RESUME:this.handleDisconnect(Ul)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===no.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(jm,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Bm,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(he.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,a_),c_)}},1e3))}createSender(e,n,i){return I(this,void 0,void 0,function*(){if(Ju())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Qu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new $e("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return I(this,void 0,void 0,function*(){if(Ju())return this.createSimulcastTransceiverSender(e,n,i,r);if(Qu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new $e("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new $e("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Ii(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new $e("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new $e("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return I(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){ue.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===no.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:Ue.NEW)===Ue.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof $e?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof or||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Ui.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit($.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return I(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new $e("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit($.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new or;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof ce&&o.reason===xe.NotAllowed?new $e("could not reconnect, token might be expired"):new or}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit($.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==Ee.CONNECTED)throw new or("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit($.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return I(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new $e("could not reconnect, url or token not saved");if(!this.pcManager)throw new $e("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit($.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof ce&&r.reason===xe.NotAllowed?new $e("could not reconnect, token might be expired"):r instanceof ce&&r.reason===xe.LeaveRequest?r:new or(s)}if(this.emit($.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ee.CONNECTED)throw new or("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit($.Resumed)})}waitForPCInitialConnection(e,n){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new $e("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return I(this,void 0,void 0,function*(){this.pcState=Wt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield ot(s_),!this.pcManager)throw new $e("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Wt.Connected}catch(e){throw this.pcState=Wt.Disconnected,ce.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return I(this,void 0,void 0,function*(){const s=new vt({destinationIdentities:[e],kind:he.RELIABLE,value:{case:"rpcResponse",value:new ch({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,he.RELIABLE)})}publishRpcAck(e,n){return I(this,void 0,void 0,function*(){const i=new vt({destinationIdentities:[e],kind:he.RELIABLE,value:{case:"rpcAck",value:new ah({requestId:n})}});yield this.sendDataPacket(i,he.RELIABLE)})}sendDataPacket(e,n){return I(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=yE(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new Ry({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===he.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===he.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return I(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(he.RELIABLE);const n=this.dataChannelForKind(he.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(he.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>I(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once($.Closing,r);!this.dcBufferStatus.get(e);)yield ot(10);this.off($.Closing,r),n()}}))}ensureDataTransportConnected(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new $e("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw ce.internal("".concat(a," connection not set"));let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(f=>{ue.error(f,i.logContext)});const u=i.dataChannelForKind(n,r);if((u==null?void 0:u.readyState)==="open")return;const d=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<d;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield ot(50)}throw ce.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return I(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Ue.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return I(this,void 0,void 0,function*(){return new Promise((e,n)=>I(this,void 0,void 0,function*(){if(!this.pcManager){n(new qu("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on($.Closing,r),this.pcManager.publisher.once(Dr.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();nE(c)&&o.set(a.payload,c)}),this.emit($.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof qu&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Ui.RR_UNKNOWN),n(s)}finally{this.off($.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===he.LOSSY)return this.lossyDCSub;if(e===he.RELIABLE)return this.reliableDCSub}else{if(e===he.LOSSY)return this.lossyDC;if(e===he.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),u=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),d=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),f=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,m=new Array,S=new Array;e.forEach(y=>{y.isDesired!==f&&m.push(y.trackSid),y.isEnabled||S.push(y.trackSid)}),this.client.sendSyncState(new fh({answer:this.options.singlePeerConnection?c?Tr({sdp:c.sdp,type:c.type}):void 0:d?Tr({sdp:d.sdp,type:d.type}):void 0,offer:this.options.singlePeerConnection?a?Tr({sdp:a.sdp,type:a.type}):void 0:u?Tr({sdp:u.sdp,type:u.type}):void 0,subscription:new Tc({trackSids:m,subscribe:!f,participantTracks:[]}),publishTracks:jw(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:S,datachannelReceiveStates:this.reliableReceivedState.map((y,g)=>new $y({publisherSid:g,lastSeq:y}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new Jy({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(he.LOSSY),cn.PUBLISHER),n(this.dataChannelForKind(he.RELIABLE),cn.PUBLISHER),n(this.dataChannelForKind(he.LOSSY,!0),cn.SUBSCRIBER),n(this.dataChannelForKind(he.RELIABLE,!0),cn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&st.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){It()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){It()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}function u_(t){return t!==void 0&&t>13}function Vm(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class G0{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new qt("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),gt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new qt("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),gt.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class d_ extends G0{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new $t,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>I(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:u}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(u),{done:!1,value:u.content})}catch(c){throw s(),c}}),return(){return I(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var u=!0,d=Bn(c),f;f=yield d.next(),i=f.done,!i;u=!0){o=f.value,u=!1;const m=o;a.add(m)}}catch(m){r={error:m}}finally{try{!u&&!i&&(s=d.return)&&(yield s.call(d))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class h_ extends G0{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=va(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new $t,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>I(this,void 0,void 0,function*(){var a,c;try{const{done:u,value:d}=yield Promise.race([e.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(u)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(d);let f;try{f=n.decode(d.content)}catch(m){throw new qt("Cannot decode datastream chunk ".concat(d.chunkIndex," as text: ").concat(m),gt.DecodeFailed)}return{done:!1,value:f}}}catch(u){throw o(),u}}),return(){return I(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var u=!0,d=Bn(c),f;f=yield d.next(),i=f.done,!i;u=!0)o=f.value,u=!1,a+=o}catch(m){r={error:m}}finally{try{!u&&!i&&(s=d.return)&&(yield s.call(d))}finally{if(r)throw r.error}}return a}()})}}class f_{constructor(){this.log=ue,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new qt('A text stream handler for topic "'.concat(e,'" has already been set.'),gt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new qt('A byte stream handler for topic "'.concat(e,'" has already been set.'),gt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new qt("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),gt.AbnormalEnd);for(const[u,d]of a)(i=(n=d.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(u);for(const[u,d]of o)(s=(r=d.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,c),this.textStreamControllers.delete(u)}}handleDataStreamPacket(e,n){return I(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return I(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new $t;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:va(e.timestamp),attributes:e.attributes,encryptionType:i},u=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new qt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),gt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new d_(c,u,va(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new $t;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},u=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new qt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),gt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new h_(c,u,va(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new qt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),gt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new qt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),gt.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new qt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),gt.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new qt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),gt.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class K0{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return I(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class p_ extends K0{}class m_ extends K0{}const zm=15e3;class g_{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return I(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),u=(f,m)=>{var S;c[m]=f;const y=c.reduce((g,E)=>g+E,0);(S=n==null?void 0:n.onProgress)===null||S===void 0||S.call(n,y)},d=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield d.write(e),u(1,0),yield d.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((f,m)=>I(this,void 0,void 0,function*(){return this._sendFile(a[m],f,{topic:n.topic,mimeType:f.type,onProgress:S=>{u(S,m+1)}})})))),d.info})}streamText(e){return I(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Qe.GCM:Qe.NONE},a=new Ga({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:Fi(o.timestamp),totalLength:Fi(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new By({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Du.UPDATE:Du.CREATE})}}),c=e==null?void 0:e.destinationIdentities,u=new vt({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(u,he.RELIABLE);let d=0;const f=this.engine,m=new WritableStream({write(g){return I(this,void 0,void 0,function*(){for(const E of cE(g,zm)){const v=new Ka({content:E,streamId:s,chunkIndex:Fi(d)}),T=new vt({destinationIdentities:c,value:{case:"streamChunk",value:v}});yield f.sendDataPacket(T,he.RELIABLE),d+=1}})},close(){return I(this,void 0,void 0,function*(){const g=new $a({streamId:s}),E=new vt({destinationIdentities:c,value:{case:"streamTrailer",value:g}});yield f.sendDataPacket(E,he.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let S=()=>I(this,void 0,void 0,function*(){yield y.close()});f.once($.Closing,S);const y=new p_(m,o,()=>this.engine.off($.Closing,S));return y})}sendFile(e,n){return I(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return I(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return I(this,void 0,void 0,function*(){var n,i,r,s,o,a;const c=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),u=e==null?void 0:e.destinationIdentities,d={id:c,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?Qe.GCM:Qe.NONE},f=new Ga({totalLength:Fi((a=d.size)!==null&&a!==void 0?a:0),mimeType:d.mimeType,streamId:c,topic:d.topic,timestamp:Fi(Date.now()),attributes:d.attributes,contentHeader:{case:"byteHeader",value:new Vy({name:d.name})}}),m=new vt({destinationIdentities:u,value:{case:"streamHeader",value:f}});yield this.engine.sendDataPacket(m,he.RELIABLE);let S=0;const y=new kt,g=this.engine,E=this.log,v=new WritableStream({write(b){return I(this,void 0,void 0,function*(){const C=yield y.lock();let x=0;try{for(;x<b.byteLength;){const A=b.slice(x,x+zm),D=new vt({destinationIdentities:u,value:{case:"streamChunk",value:new Ka({content:A,streamId:c,chunkIndex:Fi(S)})}});yield g.sendDataPacket(D,he.RELIABLE),S+=1,x+=A.byteLength}}finally{C()}})},close(){return I(this,void 0,void 0,function*(){const b=new $a({streamId:c}),C=new vt({destinationIdentities:u,value:{case:"streamTrailer",value:b}});yield g.sendDataPacket(C,he.RELIABLE)})},abort(b){E.error("Sink error:",b)}});return new m_(v,d)})}}class $0 extends F{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?G.Muted:G.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(G.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return I(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Eh)),Bw()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(G.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class v_ extends $0{constructor(e,n,i,r,s,o){super(e,n,F.Kind.Audio,i,o),this.monitorReceiver=()=>I(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=wc(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;Rn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Rn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return I(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(Yu(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Yu(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(G.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(G.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return I(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const Fl=100;class y_ extends $0{constructor(e,n,i,r,s){super(e,n,F.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>I(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=wc(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=Th(()=>{this.updateDimensions()},Fl),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===F.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Or(this._mediaStreamTrack,n):Sr(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new k_(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return I(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,u)=>Math.max(c,u.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<Fl){st.setTimeout(()=>{this.updateVisibility()},Fl);return}this.lastVisible=a,this.emit(G.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(G.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?gm():n||(gm()>2?2:1)}}class k_{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=ys(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=ys(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=ys(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??id(e),this.isPiP=It()&&ys(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=id(this.element),this.isPiP=ys(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,ym().observe(this.element),vm().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=ym())===null||e===void 0||e.unobserve(this.element),(n=vm())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function ys(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?id(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function id(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class Ln extends xn.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Qe.NONE,this.log=ue,this.handleMuted=()=>{this.emit(G.Muted)},this.handleUnmuted=()=>{this.emit(G.Unmuted)},this.log=Qn((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:pn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=F.Source.Unknown}setTrack(e){this.track&&(this.track.off(G.Muted,this.handleMuted),this.track.off(G.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(G.Muted,this.handleMuted),e.on(G.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),fe(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Qe.NONE}get audioTrack(){if(Pn(this.track))return this.track}get videoTrack(){if(Ii(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=F.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===F.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Ln||(Ln={}));class rd extends Ln{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(G.Ended)},this.handleCpuConstrained=()=>{this.track&&Ii(this.track)&&this.emit(G.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(G.Ended,this.handleTrackEnded),this.track.off(G.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(G.Ended,this.handleTrackEnded),e.on(G.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return I(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return I(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return I(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return I(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Pn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Ze.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Ze.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Ze.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Ze.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Ze.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Ze.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Ec(t,e){return I(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=A0(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const f=s.audio.deviceId;s.audio.deviceId={exact:f},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:f}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const f=s.video.deviceId;s.video.deviceId={exact:f},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:f}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=x0(s,j0,B0),u=yh(c),d=navigator.mediaDevices.getUserMedia(u);s.audio&&(et.userMediaPromiseMap.set("audioinput",d),d.catch(()=>et.userMediaPromiseMap.delete("audioinput"))),s.video&&(et.userMediaPromiseMap.set("videoinput",d),d.catch(()=>et.userMediaPromiseMap.delete("videoinput")));try{const f=yield d;return yield Promise.all(f.getTracks().map(m=>I(this,void 0,void 0,function*(){const S=m.kind==="audio";let y=S?c.audio:c.video;(typeof y=="boolean"||!y)&&(y={});let g;const E=S?u.audio:u.video;typeof E!="boolean"&&(g=E);const v=m.getSettings().deviceId;g!=null&&g.deviceId&&Si(g.deviceId)!==v?g.deviceId=v:g||(g={deviceId:v});const T=KE(m,g,e);return T.kind===F.Kind.Video?T.source=F.Source.Camera:T.kind===F.Kind.Audio&&(T.source=F.Source.Microphone),T.mediaStream=f,Pn(T)&&i?yield T.setProcessor(i):Ii(T)&&r&&(yield T.setProcessor(r)),T})))}catch(f){if(!n)throw f;return Ec(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function S_(t){return I(this,void 0,void 0,function*(){return(yield Ec({audio:!1,video:!0}))[0]})}function J0(t){return I(this,void 0,void 0,function*(){return(yield Ec({audio:t??!0,video:!1}))[0]})}var ai;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(ai||(ai={}));function T_(t){switch(t){case bs.EXCELLENT:return ai.Excellent;case bs.GOOD:return ai.Good;case bs.POOR:return ai.Poor;case bs.LOST:return ai.Lost;default:return ai.Unknown}}class Q0 extends xn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===io.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Rr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:io.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ai.Unknown,this.log=ue,this.log=Qn((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:pn.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new $t,this.once(Q.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(F.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(F.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(F.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Rr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Rr.ACTIVE&&this.emit(Q.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(Q.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(Q.ParticipantNameChanged,e)}_setAttributes(e){const n=Vw(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(Q.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,u=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((d,f)=>{var m;return d!==((m=this.permissions)===null||m===void 0?void 0:m.canPublishSources[f])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,u&&this.emit(Q.ParticipantPermissionsChanged,c),u}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Q.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=T_(e),n!==this._connectionQuality&&this.emit(Q.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Pn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(G.Muted,()=>{this.emit(Q.TrackMuted,e)}),e.on(G.Unmuted,()=>{this.emit(Q.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case F.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case F.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function C_(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Gy({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class b_ extends Q0{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Qe.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new $t)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,u,d,f,m;this.reconnectFuture&&(this.reconnectFuture.promise.catch(S=>this.log.warn(S.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((d=(u=this.signalConnectedFuture).reject)===null||d===void 0||d.call(u,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(m=(f=this.activeAgentFuture)===null||f===void 0?void 0:f.reject)===null||m===void 0||m.call(f,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,u;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new $t),(u=(c=this.signalConnectedFuture).resolve)===null||u===void 0||u.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:u,message:d}=a,f=this.pendingSignalRequests.get(c);f&&(u!==ph.OK&&f.reject(new dm(d,u)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,u=null,d=null;c.value.case==="payload"?u=c.value.value:c.value.case==="error"&&(d=Be.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,u,d);break;case"rpcAck":let f=a.value.value;this.handleIncomingRpcAck(f.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>C_(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),fe(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),fe(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),fe(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),fe(c))),this.emit(Q.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>I(this,void 0,void 0,function*(){var c,u,d,f,m;if(!(!((m=this.roomOptions)===null||m===void 0)&&m.dynacast))return;const S=this.videoTrackPublications.get(a.trackSid);if(!S){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!S.videoTrack)return;const y=yield S.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var g=!0,E=Bn(y),v;v=yield E.next(),c=v.done,!c;g=!0){f=v.value,g=!1;const T=f;Lw(T)&&(this.log.debug("publish ".concat(T," for ").concat(S.videoTrack.sid),Object.assign(Object.assign({},this.logContext),fe(S))),yield this.publishAdditionalCodecForTrack(S.videoTrack,T,S.options))}}catch(T){u={error:T}}finally{try{!g&&!c&&(d=E.return)&&(yield d.call(E))}finally{if(u)throw u.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>I(this,void 0,void 0,function*(){if(a.source===F.Source.ScreenShare||a.source===F.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),fe(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(An(a)||ti(a))try{if(It())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===F.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),fe(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),fe(a))),An(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),fe(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Qe.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on($.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on($.Connected,this.handleReconnected).on($.SignalConnected,this.handleSignalConnected).on($.SignalRestarted,this.handleReconnected).on($.SignalResumed,this.handleReconnected).on($.Restarting,this.handleReconnecting).on($.Resuming,this.handleReconnecting).on($.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on($.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on($.Closing,this.handleClosing).on($.SignalRequestResponse,this.handleSignalRequestResponse).on($.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return I(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>I(i,void 0,void 0,function*(){var u,d;try{let f=!1;const m=yield this.engine.client.sendUpdateLocalMetadata((u=r??this.metadata)!==null&&u!==void 0?u:"",(d=s??this.name)!==null&&d!==void 0?d:"",o),S=performance.now();for(this.pendingSignalRequests.set(m,{resolve:a,reject:y=>{c(y),f=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-S<5e3&&!f;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(y=>{let[g,E]=y;return this.attributes[g]===E||E===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(m),a();return}yield ot(50)}c(new dm("Request to update local metadata timed out","TimeoutError"))}catch(f){f instanceof Error&&c(f)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(F.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(F.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(F.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return I(this,void 0,void 0,function*(){this.encryptionType=e?Qe.GCM:Qe.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return I(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const u=yield this.waitForPendingPublicationOfSource(e);return u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield u==null?void 0:u.unmute(),u}this.pendingPublishing.add(e);try{switch(e){case F.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case F.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case F.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Vn(e)}}catch(u){throw c==null||c.forEach(d=>{d.stop()}),u instanceof Error&&this.emit(Q.MediaDevicesError,u,$u(e)),this.pendingPublishing.delete(e),u}for(const u of c){const d=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===F.Source.Microphone&&Pn(u)&&d.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),u.startPreConnectBuffer())}try{const u=[];for(const f of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),fe(f))),u.push(this.publishTrack(f,r));[a]=yield Promise.all(u)}catch(u){throw c==null||c.forEach(d=>{d.stop()}),u}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===F.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(F.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return I(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(F.Source.Camera)||this.pendingPublishing.has(F.Source.Microphone))){this.pendingPublishing.add(F.Source.Camera),this.pendingPublishing.add(F.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(F.Source.Camera),this.pendingPublishing.delete(F.Source.Microphone)}}})}createTracks(e){return I(this,void 0,void 0,function*(){var n,i;e??(e={});const r=x0(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Ec(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Pn(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=F.Source.Microphone,this.emit(Q.AudioStreamAcquired)),Ii(a)&&(this.cameraError=void 0,a.source=F.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return I(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new gh("getDisplayMedia not supported");e.resolution===void 0&&!Qw()&&(e.resolution=vh.h1080fps30.resolution);const n=Fw(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Vn("no video track found");const s=new Ya(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=F.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(Q.AudioStreamAcquired);const a=new Qa(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=F.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return I(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return I(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,u,d;An(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Mr(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let f;if(i instanceof MediaStreamTrack)f=i.getConstraints();else{f=i.constraints;let v;switch(i.source){case F.Source.Microphone:v="audioinput";break;case F.Source.Camera:v="videoinput"}v&&s.activeDeviceMap.has(v)&&(f=Object.assign(Object.assign({},f),{deviceId:s.activeDeviceMap.get(v)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Qa(i,f,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Ya(i,f,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new Vn("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let m;if(s.trackPublications.forEach(v=>{v.track&&v.track===i&&(m=v)}),m)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),fe(m))),m;const S=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),y="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(c=S.forceStereo)!==null&&c!==void 0?c:y;g&&(S.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),fe(i))),S.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(u=S.dtx)!==null&&u!==void 0||(S.dtx=!1),(d=S.red)!==null&&d!==void 0||(S.red=!1)),!Xw()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),S.simulcast=!1),S.source&&(i.source=S.source);const E=new Promise((v,T)=>I(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ee.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:fe(i)}));let b=!1;const C=setTimeout(()=>{b=!0,i.stop(),T(new um("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(C),b)return;const x=yield this.publish(i,S,g);v(x)}else try{const b=yield this.publish(i,S,g);v(b)}catch(b){T(b)}}catch(b){T(b)}}));s.pendingPublishPromises.set(i,E);try{return yield E}catch(v){throw v}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new $t),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),fe(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>zw(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),fe(e))),!1)}publish(e,n,i){return I(this,void 0,void 0,function*(){var r,s,o,a,c,u,d,f,m,S;if(!this.hasPermissionsToPublish(e))throw new um("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(V=>Mr(e)&&V.source===e.source)&&e.source!==F.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),fe(e))),n.stopMicTrackOnMute&&Pn(e)&&(e.stopOnMute=!0),e.source===F.Source.ScreenShare&&Qi()&&(n.simulcast=!1),n.videoCodec==="av1"&&!Kw()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!$w()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=ed),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(V=>n.videoCodec===Ls(V.mime))||(n.videoCodec=Ls(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(G.Muted,this.onTrackMuted),e.on(G.Unmuted,this.onTrackUnmuted),e.on(G.Ended,this.handleTrackEnded),e.on(G.UpstreamPaused,this.onTrackUpstreamPaused),e.on(G.UpstreamResumed,this.onTrackUpstreamResumed),e.on(G.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const E=[],v=!(!((r=n.dtx)!==null&&r!==void 0)||r),T=e.getSourceTrackSettings();T.autoGainControl&&E.push(Ze.TF_AUTO_GAIN_CONTROL),T.echoCancellation&&E.push(Ze.TF_ECHO_CANCELLATION),T.noiseSuppression&&E.push(Ze.TF_NOISE_SUPPRESSION),T.channelCount&&T.channelCount>1&&E.push(Ze.TF_STEREO),v&&E.push(Ze.TF_NO_DTX),An(e)&&e.hasPreConnectBuffer&&E.push(Ze.TF_PRECONNECT_BUFFER);const b=new ro({cid:e.mediaStreamTrack.id,name:n.name,type:F.kindToProto(e.kind),muted:e.isMuted,source:F.sourceToProto(e.source),disableDtx:v,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:E});let C;if(e.kind===F.Kind.Video){let V={width:0,height:0};try{V=yield e.waitForDimensions()}catch{const M=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:so.h720.resolution;V={width:M.width,height:M.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),fe(e)),{dims:V}))}b.width=V.width,b.height=V.height,ti(e)&&(ln(g)&&(e.source===F.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),fe(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),b.simulcastCodecs=[new Lu({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:ed}),n.backupCodec&&g!==n.backupCodec.codec&&b.encryption===Qe.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),b.simulcastCodecs.push(new Lu({codec:n.backupCodec.codec,cid:""})))),C=nd(e.source===F.Source.ScreenShare,b.width,b.height,n),b.layers=Fm(b.width,b.height,C,ln(n.videoCodec))}else e.kind===F.Kind.Audio&&(C=[{maxBitrate:(u=n.audioPreset)===null||u===void 0?void 0:u.maxBitrate,priority:(f=(d=n.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&f!==void 0?f:"high",networkPriority:(S=(m=n.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&S!==void 0?S:"high"}]);if(!this.engine||this.engine.isClosed)throw new $e("cannot publish track when not connected");const x=()=>I(this,void 0,void 0,function*(){var V,R,M;if(!this.engine.pcManager)throw new $e("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,C),this.emit(Q.LocalSenderCreated,e.sender,e),ti(e)&&((V=n.degradationPreference)!==null&&V!==void 0||(n.degradationPreference=i_(e)),e.setDegradationPreference(n.degradationPreference)),C)if(Qi()&&e.kind===F.Kind.Audio){let K;for(const Y of this.engine.pcManager.publisher.getTransceivers())if(Y.sender===e.sender){K=Y;break}K&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:K,codec:"opus",maxbr:!((R=C[0])===null||R===void 0)&&R.maxBitrate?C[0].maxBitrate/1e3:0})}else e.codec&&ln(e.codec)&&(!((M=C[0])===null||M===void 0)&&M.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:b.cid,codec:e.codec,maxbr:C[0].maxBitrate/1e3});yield this.engine.negotiate()});let A;const D=new Promise((V,R)=>I(this,void 0,void 0,function*(){var M;try{A=yield this.engine.addTrack(b),V(A)}catch(K){e.sender&&(!((M=this.engine.pcManager)===null||M===void 0)&&M.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Y=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),fe(e)),{error:Y}))})),R(K)}}));if(this.enabledPublishVideoCodecs.length>0)A=(yield Promise.all([D,x()]))[0];else{A=yield D;let V;if(A.codecs.forEach(R=>{V===void 0&&(V=R.mimeType)}),V&&e.kind===F.Kind.Video){const R=Ls(V);R!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),fe(e)),{codec:R})),n.videoCodec=R,C=nd(e.source===F.Source.ScreenShare,b.width,b.height,n))}yield x()}const U=new rd(e.kind,A,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(U.on(G.CpuConstrained,V=>this.onTrackCpuConstrained(V,U)),U.options=n,e.sid=A.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:C,trackInfo:A})),ti(e)?e.startMonitor(this.engine.client):An(e)&&e.startMonitor(),this.addTrackPublication(U),this.emit(Q.LocalTrackPublished,U),An(e)&&A.audioFeatures.includes(Ze.TF_PRECONNECT_BUFFER)){const V=e.getPreConnectBuffer(),R=e.getPreConnectBufferMimeType();this.on(Q.LocalTrackSubscribed,M=>{if(M.trackSid===A.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),fe(e))),e.stopPreConnectBuffer()}}),V&&new Promise((K,Y)=>I(this,void 0,void 0,function*(){var se,le,H,re,B,Z;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),fe(e)));const qe=setTimeout(()=>{Y(new Error("agent not active within 10 seconds"))},1e4),lt=yield this.waitUntilActiveAgentPresent();clearTimeout(qe),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),fe(e)));const Dt=yield this.streamBytes({name:"preconnect-buffer",mimeType:R,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[lt.identity],attributes:{trackId:U.trackSid,sampleRate:String((B=T.sampleRate)!==null&&B!==void 0?B:"48000"),channels:String((Z=T.channelCount)!==null&&Z!==void 0?Z:"1")}});try{for(var ne=!0,Te=Bn(V),ge;ge=yield Te.next(),se=ge.done,!se;ne=!0){re=ge.value,ne=!1;const bt=re;yield Dt.write(bt)}}catch(bt){le={error:bt}}finally{try{!ne&&!se&&(H=Te.return)&&(yield H.call(Te))}finally{if(le)throw le.error}}yield Dt.close(),K()}catch(qe){Y(qe)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),fe(e)))}).catch(K=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),fe(e)),{error:K}))})}return U})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return I(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Qe.NONE)return;let s;if(this.trackPublications.forEach(S=>{S.track&&S.track===e&&(s=S)}),!s)throw new Vn("track is not published");if(!ti(e))throw new Vn("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=e_(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),fe(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const u=new ro({cid:c.mediaStreamTrack.id,type:F.kindToProto(e.kind),muted:e.isMuted,source:F.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(u.layers=Fm(u.width,u.height,a),!this.engine||this.engine.isClosed)throw new $e("cannot publish track when not connected");const d=()=>I(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),m=(yield Promise.all([this.engine.addTrack(u),d()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:m}))})}unpublishTrack(e,n){return I(this,void 0,void 0,function*(){var i,r;if(Mr(e)){const u=this.pendingPublishPromises.get(e);u&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),fe(e))),yield u)}const s=this.getPublicationForTrack(e),o=s?fe(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(G.Muted,this.onTrackMuted),e.off(G.Unmuted,this.onTrackUnmuted),e.off(G.Ended,this.handleTrackEnded),e.off(G.UpstreamPaused,this.onTrackUpstreamPaused),e.off(G.UpstreamResumed,this.onTrackUpstreamResumed),e.off(G.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ue.FAILED&&c)try{for(const u of this.engine.pcManager.publisher.getTransceivers())u.sender===c&&(u.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),ti(e)){for(const[,u]of e.simulcastCodecs)u.sender&&(this.engine.removeTrack(u.sender)&&(a=!0),u.sender=void 0);e.simulcastCodecs.clear()}}catch(u){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:u}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case F.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case F.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(Q.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return I(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>I(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>I(this,void 0,void 0,function*(){const u=c.track;yield this.unpublishTrack(u,!1),r&&!u.isMuted&&u.source!==F.Source.ScreenShare&&u.source!==F.Source.ScreenShareAudio&&(An(u)||ti(u))&&!u.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield u.restartTrack()),yield this.publishOrRepublishTrack(u,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?he.RELIABLE:he.LOSSY,o=r.destinationIdentities,a=r.topic;let c=new sh({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const u=new vt({kind:s,value:{case:"user",value:c}});yield i.engine.sendDataPacket(u,s)}()})}publishDtmf(e,n){return I(this,void 0,void 0,function*(){const i=new vt({kind:he.RELIABLE,value:{case:"sipDtmf",value:new Oy({code:e,digit:n})}});yield this.engine.sendDataPacket(i,he.RELIABLE)})}sendChatMessage(e,n){return I(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new vt({value:{case:"chatMessage",value:new Ha(Object.assign(Object.assign({},i),{timestamp:Ae.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,he.RELIABLE),this.emit(Q.ChatMessage,i),i})}editChatMessage(e,n){return I(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new vt({value:{case:"chatMessage",value:new Ha(Object.assign(Object.assign({},i),{timestamp:Ae.parse(i.timestamp),editTimestamp:Ae.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,he.RELIABLE),this.emit(Q.ChatMessage,i),i})}sendText(e,n){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return I(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=15e3}=n;return function*(){return new Promise((d,f)=>I(i,void 0,void 0,function*(){var m,S,y,g;if(wh(o)>z0){f(Be.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((S=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||S===void 0)&&S.version&&In((g=(y=this.engine.latestJoinResponse)===null||y===void 0?void 0:y.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){f(Be.builtIn("UNSUPPORTED_SERVER"));return}const E=Math.max(a,8e3),v=crypto.randomUUID();yield this.publishRpcRequest(r,v,s,o,E);const T=setTimeout(()=>{this.pendingAcks.delete(v),f(Be.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(v),clearTimeout(b)},7e3);this.pendingAcks.set(v,{resolve:()=>{clearTimeout(T)},participantIdentity:r});const b=setTimeout(()=>{this.pendingResponses.delete(v),f(Be.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(v,{resolve:(C,x)=>{clearTimeout(b),this.pendingAcks.has(v)&&(this.log.warn("RPC response received before ack",v),this.pendingAcks.delete(v),clearTimeout(T)),x?f(x):d(C??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return I(this,void 0,void 0,function*(){const o=new vt({destinationIdentities:[e],kind:he.RELIABLE,value:{case:"rpcRequest",value:new oh({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,he.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Be.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),fe(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new $t),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(An(r)||ti(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return I(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield ot(20)}})}}class w_ extends Ln{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(G.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Tc({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Ay({participantSid:"",trackSids:[this.trackSid]})]});this.emit(G.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Ln.SubscriptionStatus.Unsubscribed:super.isSubscribed?Ln.SubscriptionStatus.Subscribed:Ln.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Ln.PermissionStatus.Allowed:Ln.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Ol(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Ol(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Ut.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(G.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(G.VisibilityChanged,this.handleVisibilityChange),r.off(G.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(G.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(G.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(G.VisibilityChanged,this.handleVisibilityChange),e.on(G.Ended,this.handleEnded),this.emit(G.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(G.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?G.Muted:G.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(G.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(G.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Ol(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new zy({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===F.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)fm(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=Ww(this.trackInfo,this.requestedMaxQuality);i&&fm(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Ut.HIGH})),e.quality=Ut.HIGH)}this.emit(G.UpdateSettings,e)}}class Xa extends Q0{static fromParticipantInfo(e,n,i){return new Xa(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:io.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(G.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),fe(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(G.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(G.SubscriptionPermissionChanged,n=>{this.emit(Q.TrackSubscriptionPermissionChanged,e,n)}),e.on(G.SubscriptionStatusChanged,n=>{this.emit(Q.TrackSubscriptionStatusChanged,e,n)}),e.on(G.Subscribed,n=>{this.emit(Q.TrackSubscribed,n,e)}),e.on(G.Unsubscribed,n=>{this.emit(Q.TrackUnsubscribed,n,e)}),e.on(G.SubscriptionFailed,n=>{this.emit(Q.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:F.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:F.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(d=>{!a&&e.kind===d.kind.toString()&&(a=d)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(Q.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),fe(a))),this.emit(Q.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let u;return c?u=new y_(e,n,r,s):u=new v_(e,n,r,this.audioContext,this.audioOutput),u.source=a.source,u.isMuted=a.isMuted,u.setMediaStream(i),u.start(),a.setTrack(u),this.volumeMap.has(a.source)&&Xu(u)&&Pn(u)&&u.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=F.kindFromProto(r.type);if(!c)return;a=new w_(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const u=Array.from(this.trackPublications.values()).find(d=>d.source===(a==null?void 0:a.source));u&&a.source!==F.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:fe(u),newTrack:fe(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),fe(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(Q.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case F.Kind.Audio:this.audioTrackPublications.delete(e);break;case F.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(Q.TrackUnpublished,i)}setAudioOutput(e){return I(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;Pn(i.track)&&Xu(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Se;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Se||(Se={}));const E_=4*1e3;class Hr extends xn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s;if(super(),n=this,this.state=Se.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ue,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,c)=>I(this,void 0,void 0,function*(){var u;if(!Jw())throw Rn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===Se.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(Se.Connecting),((u=this.regionUrlProvider)===null||u===void 0?void 0:u.getServerUrl().toString())!==U0(o)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),qr(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new ve(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(S=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(S)}).catch(S=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:S}))}));const f=(S,y,g)=>I(this,void 0,void 0,function*(){var E,v;this.abortController&&this.abortController.abort();const T=new AbortController;this.abortController=T,d==null||d();try{if(yield Ar.getInstance().getBackOffPromise(o),T.signal.aborted)throw ce.cancelled("Connection attempt aborted");yield this.attemptConnection(g??o,a,c,T),this.abortController=void 0,S()}catch(b){if(this.regionUrlProvider&&b instanceof ce&&b.reason!==xe.Cancelled&&b.reason!==xe.NotAllowed){let C=null;try{this.log.debug("Fetching next region"),C=yield this.regionUrlProvider.getNextBestRegionUrl((E=this.abortController)===null||E===void 0?void 0:E.signal)}catch(x){if(x instanceof ce&&(x.status===401||x.reason===xe.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(x);return}}[xe.InternalError,xe.ServerUnreachable,xe.Timeout].includes(b.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Ar.getInstance().addFailedConnectionAttempt(o)),C&&!(!((v=this.abortController)===null||v===void 0)&&v.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(b.message,". Retrying with another region: ").concat(C),this.logContext),this.recreateEngine(),yield f(S,y,C)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Sm(b)),y(b))}else{let C=un.UNKNOWN_REASON;b instanceof ce&&(C=Sm(b)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,C),y(b)}}}),m=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new $t((S,y)=>{f(S,y,m)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,u,d,f)=>I(this,void 0,void 0,function*(){var m,S,y;const g=yield c.join(o,a,{autoSubscribe:u.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:u.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:u.websocketTimeout,singlePeerConnection:d.singlePeerConnection},f.signal);let E=g.serverInfo;if(E||(E={version:g.serverVersion,region:g.serverRegion}),this.serverInfo=E,this.log.debug("connected to Livekit Server ".concat(Object.entries(E).map(v=>{let[T,b]=v;return"".concat(T,": ").concat(b)}).join(", ")),{room:(m=g.room)===null||m===void 0?void 0:m.name,roomSid:(S=g.room)===null||S===void 0?void 0:S.sid,identity:(y=g.participant)===null||y===void 0?void 0:y.identity}),!E.version)throw new Ow("unknown server version");return E.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),g}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,u)=>I(this,void 0,void 0,function*(){var d,f;this.state===Se.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((f=this.regionUrlProvider)===null||f===void 0)&&f.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},bh),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const m=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,u);this.applyJoinResponse(m),this.setupLocalParticipantEvents(),this.emit(z.SignalConnected)}catch(m){yield this.engine.close(),this.recreateEngine();const S=u.signal.aborted?ce.cancelled("Signal connection aborted"):ce.serverUnreachable("could not establish signal connection");throw m instanceof Error&&(S.message="".concat(S.message,": ").concat(m.message)),m instanceof ce&&(S.reason=m.reason,S.status=m.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:m})),S}if(u.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),ce.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,u)}catch(m){throw yield this.engine.close(),this.recreateEngine(),m}It()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),It()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Se.Connected),this.emit(z.Connected),Ar.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return I(n,[...a],void 0,function(){var u=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var f,m,S;const y=yield u.disconnectLock.lock();try{if(u.state===Se.Disconnected){u.log.debug("already disconnected",u.logContext);return}if(u.log.info("disconnect from room",Object.assign({},u.logContext)),u.state===Se.Connecting||u.state===Se.Reconnecting||u.isResuming){const g="Abort connection attempt due to user initiated disconnect";u.log.warn(g,u.logContext),(f=u.abortController)===null||f===void 0||f.abort(g),(S=(m=u.connectFuture)===null||m===void 0?void 0:m.reject)===null||S===void 0||S.call(m,ce.cancelled("Client initiated disconnect")),u.connectFuture=void 0}u.engine&&(u.engine.client.isDisconnected||(yield u.engine.client.sendLeave()),yield u.engine.close()),u.handleDisconnect(d,un.CLIENT_INITIATED),u.engine=void 0}finally{y()}}()})},this.onPageLeave=()=>I(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>I(this,void 0,void 0,function*(){const o=[],a=At();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let u=document.getElementById(c);if(!u){u=document.createElement("audio"),u.id=c,u.autoplay=!0,u.hidden=!0;const d=xl();d.enabled=!0;const f=new MediaStream([d]);u.srcObject=f,document.addEventListener("visibilitychange",()=>{u&&(u.srcObject=document.hidden?null:f,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(u),this.once(z.Disconnected,()=>{u==null||u.remove(),u=null})}o.push(u)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(u=>{u.track&&u.track.attachedElements.forEach(d=>{o.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>I(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var u;(u=c.track)===null||u===void 0||u.attachedElements.forEach(d=>{o.includes(d)||o.push(d)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(Se.Reconnecting)&&this.emit(z.Reconnecting)},this.handleSignalRestarted=o=>I(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(Se.Connected),this.emit(z.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let u=this.remoteParticipants.get(a.identity);a.state===Rr.DISCONNECTED?this.handleParticipantDisconnected(a.identity,u):u=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(u=>{if(c[u.sid]=!0,u.sid===this.localParticipant.sid)this.localParticipant.audioLevel=u.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(u.sid);d&&(d.audioLevel=u.level,d.setIsSpeaking(!0),a.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(u=>{c[u.sid]||(u.audioLevel=0,u.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(z.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(u=>{const d=this.remoteParticipants.get(u.identity);d&&d.sid!==u.sid||a.set(u.sid,u)}),o.forEach(u=>{let d=this.getRemoteParticipantBySid(u.sid);u.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=u.level,d.setIsSpeaking(u.active),u.active?a.set(u.sid,d):a.delete(u.sid))});const c=Array.from(a.values());c.sort((u,d)=>d.audioLevel-u.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(z.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const u=c.getTrackPublicationBySid(a.trackSid);if(!u||!u.track)return;const d=F.streamStateFromProto(a.state);u.track.setStreamState(d),d!==u.track.streamState&&(c.emit(Q.TrackStreamStateChanged,u,u.track.streamState),this.emitWhenConnected(z.TrackStreamStateChanged,u,u.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(u=>u.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const u=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,u.id,u.method,u.payload,u.responseTimeoutMs,u.version)}},this.handleUserPacket=(o,a,c,u)=>{this.emit(z.DataReceived,a.payload,o,c,a.topic,u),o==null||o.emit(Q.DataReceived,a.payload,c,u)},this.handleSipDtmf=(o,a)=>{this.emit(z.SipDTMFReceived,a,o),o==null||o.emit(Q.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),u=c==null?void 0:c.trackPublications.get(a.trackId),d=rE(a,this.transcriptionReceivedTimes);u==null||u.emit(G.TranscriptionReceived,d),c==null||c.emit(Q.TranscriptionReceived,d,u),this.emit(z.TranscriptionReceived,d,c,u)},this.handleChatMessage=(o,a)=>{const c=sE(a);this.emit(z.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(z.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(z.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(z.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(z.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(z.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>I(this,void 0,void 0,function*(){var o;((o=At())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(z.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(z.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(z.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(z.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(z.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(z.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(z.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(z.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>I(this,void 0,void 0,function*(){var a,c,u,d,f,m;(a=o.track)===null||a===void 0||a.on(G.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(G.Restarted,this.onLocalTrackRestarted),(f=(d=(u=o.track)===null||u===void 0?void 0:u.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||f===void 0||f.call(d,this),this.emit(z.LocalTrackPublished,o,this.localParticipant),An(o.track)&&(yield o.track.checkForSilence())&&this.emit(z.LocalAudioSilenceDetected,o);const S=yield(m=o.track)===null||m===void 0?void 0:m.getDeviceId(!1),y=$u(o.source);y&&S&&S!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,S),this.emit(z.ActiveDeviceChanged,y,S))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(G.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(G.Restarted,this.onLocalTrackRestarted),this.emit(z.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>I(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=$u(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(z.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(z.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(z.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(z.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(z.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},UE),e),this.log=Qn((i=this.options.loggerName)!==null&&i!==void 0?i:pn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},j0),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},B0),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},LE),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new f_,this.outgoingDataStreamManager=new g_(this.engine,this.log),this.disconnectLock=new kt,this.localParticipant=new b_("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Si(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Si(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Si(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),It()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Hr.cleanupRegistry&&Hr.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return I(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new kE(i,n),this.e2eeManager.on(ui.ParticipantEncryptionStatusChanged,(r,s)=>{aE(s)&&(this.isE2EEEnabled=r),this.emit(z.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(ui.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(z.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return I(this,void 0,void 0,function*(){return this.state===Se.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off($.RoomUpdate,i),e(r.sid))};this.engine.on($.RoomUpdate,i),this.once(z.Disconnected,()=>{this.engine.off($.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new l_(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on($.ParticipantUpdate,this.handleParticipantUpdates).on($.RoomUpdate,this.handleRoomUpdate).on($.SpeakersChanged,this.handleSpeakersChanged).on($.StreamStateChanged,this.handleStreamStateUpdate).on($.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on($.SubscriptionError,this.handleSubscriptionError).on($.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on($.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on($.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on($.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on($.DataPacketReceived,this.handleDataPacket).on($.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Se.SignalReconnecting)&&this.emit(z.SignalReconnecting)}).on($.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Se.Connected)&&this.emit(z.Reconnected)}).on($.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Se.Reconnecting||this.isResuming)&&this.sendSyncState()}).on($.Restarting,this.handleRestarting).on($.SignalRestarted,this.handleSignalRestarted).on($.Offline,()=>{this.setAndEmitConnectionState(Se.Reconnecting)&&this.emit(z.Reconnecting)}).on($.DCBufferStatusChanged,(e,n)=>{this.emit(z.DCBufferStatusChanged,e,n)}).on($.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(Q.LocalTrackSubscribed,n),this.emitWhenConnected(z.LocalTrackSubscribed,n,this.localParticipant)}).on($.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(z.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return et.getInstance().getDevices(e,n)}prepareConnection(e,n){return I(this,void 0,void 0,function*(){if(this.state===Se.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(qr(new URL(e))&&n){this.regionUrlProvider=new ve(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Se.Disconnected&&(this.regionUrl=i,yield fetch(ao(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(ao(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return I(this,void 0,void 0,function*(){let i=()=>I(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Sn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Sn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Sn({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Sn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>I(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Sn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>I(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Sn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Sn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>I(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Cc({reason:un.CLIENT_INITIATED,action:Ir.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Sn({scenario:{case:"subscriberBandwidth",value:Fi(n)}});break;case"leave-full-reconnect":r=new Sn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return I(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,u,d,f,m,S;let y=!0,g=!1;const E=o?{exact:r}:r;if(i==="audioinput"){g=s.localParticipant.audioTrackPublications.size===0;const v=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=E;const T=Array.from(s.localParticipant.audioTrackPublications.values()).filter(C=>C.source===F.Source.Microphone);try{y=(yield Promise.all(T.map(C=>{var x;return(x=C.audioTrack)===null||x===void 0?void 0:x.setDeviceId(E)}))).every(C=>C===!0)}catch(C){throw s.options.audioCaptureDefaults.deviceId=v,C}const b=T.some(C=>{var x,A;return(A=(x=C.track)===null||x===void 0?void 0:x.isMuted)!==null&&A!==void 0?A:!1});y&&b&&(g=!0)}else if(i==="videoinput"){g=s.localParticipant.videoTrackPublications.size===0;const v=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=E;const T=Array.from(s.localParticipant.videoTrackPublications.values()).filter(C=>C.source===F.Source.Camera);try{y=(yield Promise.all(T.map(C=>{var x;return(x=C.videoTrack)===null||x===void 0?void 0:x.setDeviceId(E)}))).every(C=>C===!0)}catch(C){throw s.options.videoCaptureDefaults.deviceId=v,C}const b=T.some(C=>{var x,A;return(A=(x=C.track)===null||x===void 0?void 0:x.isMuted)!==null&&A!==void 0?A:!1});y&&b&&(g=!0)}else if(i==="audiooutput"){if(g=!0,!Yu()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(u=yield et.getInstance().normalizeDeviceId("audiooutput",r))!==null&&u!==void 0?u:""),(d=(S=s.options).audioOutput)!==null&&d!==void 0||(S.audioOutput={});const v=(f=s.getActiveDevice(i))!==null&&f!==void 0?f:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((m=s.audioContext)===null||m===void 0||m.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(T=>T.setAudioOutput({deviceId:r})))}catch(T){throw s.options.audioOutput.deviceId=v,T}}return g&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(z.ActiveDeviceChanged,i,r)),y}()})}setupLocalParticipantEvents(){this.localParticipant.on(Q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Q.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Q.AttributesChanged,this.onLocalAttributesChanged).on(Q.TrackMuted,this.onLocalTrackMuted).on(Q.TrackUnmuted,this.onLocalTrackUnmuted).on(Q.LocalTrackPublished,this.onLocalTrackPublished).on(Q.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Q.MediaDevicesError,this.onMediaDevicesError).on(Q.AudioStreamAcquired,this.startAudio).on(Q.ChatMessage,this.onLocalChatMessageSent).on(Q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Se.Connecting||this.state===Se.Reconnecting){const f=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(S=>S.id)}),this.onTrackAdded(e,n,i),m()},m=()=>{this.off(z.Reconnected,f),this.off(z.Connected,f),this.off(z.Disconnected,m)};this.once(z.Reconnected,f),this.once(z.Connected,f),this.once(z.Disconnected,m);return}if(this.state===Se.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=Gw(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(f=>f.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const f=this.engine.getTrackIdForReceiver(i);if(!f){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=f}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let u;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?u=this.options.adaptiveStream:u={});const d=c.addSubscribedMediaTrack(e,a,n,i,u);d!=null&&d.isEncrypted&&!this.e2eeManager&&this.emit(z.EncryptionError,new Error("Encrypted ".concat(d.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Se.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(Q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Q.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Q.AttributesChanged,this.onLocalAttributesChanged).off(Q.TrackMuted,this.onLocalTrackMuted).off(Q.TrackUnmuted,this.onLocalTrackUnmuted).off(Q.LocalTrackPublished,this.onLocalTrackPublished).off(Q.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Q.MediaDevicesError,this.onMediaDevicesError).off(Q.AudioStreamAcquired,this.startAudio).off(Q.ChatMessage,this.onLocalChatMessageSent).off(Q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),It()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Se.Disconnected),this.emit(z.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(z.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return I(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Be.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Be.builtIn("UNSUPPORTED_METHOD"));return}let c=null,u=null;try{const d=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});wh(d)>z0?(c=Be.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):u=d}catch(d){d instanceof Be?c=d:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),d),c=Be.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,u,c)})}selectDefaultDevices(){return I(this,void 0,void 0,function*(){var e,n,i;const r=et.getInstance().previousDevices,s=yield et.getInstance().getDevices(void 0,!1),o=At();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const u=r.find(d=>d.deviceId===c.deviceId);u&&u.label!==""&&u.kind===c.kind&&u.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(z.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const u=Uw(c),d=this.localParticipant.getTrackPublication(u);if(d&&(!((e=d.track)===null||e===void 0)&&e.isUserProvided))continue;const f=s.filter(S=>S.kind===c),m=this.getActiveDevice(c);if(m===((n=r.filter(S=>S.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&f.length>0&&((i=f[0])===null||i===void 0?void 0:i.deviceId)!==m){yield this.switchActiveDevice(c,f[0].deviceId);continue}c==="audioinput"&&!oo()||c==="videoinput"||f.length>0&&!f.find(S=>S.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!oo())&&(yield this.switchActiveDevice(c,f[0].deviceId))}})}acquireAudioContext(){return I(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=M0())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),ot(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(z.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Xa.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Xa(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(z.ParticipantConnected,i),i.on(Q.TrackPublished,r=>{this.emitWhenConnected(z.TrackPublished,r,i)}).on(Q.TrackSubscribed,(r,s)=>{r.kind===F.Kind.Audio?(r.on(G.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(G.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===F.Kind.Video&&(r.on(G.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(G.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(z.TrackSubscribed,r,s,i)}).on(Q.TrackUnpublished,r=>{this.emit(z.TrackUnpublished,r,i)}).on(Q.TrackUnsubscribed,(r,s)=>{this.emit(z.TrackUnsubscribed,r,s,i)}).on(Q.TrackMuted,r=>{this.emitWhenConnected(z.TrackMuted,r,i)}).on(Q.TrackUnmuted,r=>{this.emitWhenConnected(z.TrackUnmuted,r,i)}).on(Q.ParticipantMetadataChanged,r=>{this.emitWhenConnected(z.ParticipantMetadataChanged,r,i)}).on(Q.ParticipantNameChanged,r=>{this.emitWhenConnected(z.ParticipantNameChanged,r,i)}).on(Q.AttributesChanged,r=>{this.emitWhenConnected(z.ParticipantAttributesChanged,r,i)}).on(Q.ConnectionQualityChanged,r=>{this.emitWhenConnected(z.ConnectionQualityChanged,r,i)}).on(Q.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(z.ParticipantPermissionsChanged,r,i)}).on(Q.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(z.TrackSubscriptionStatusChanged,r,s,i)}).on(Q.TrackSubscriptionFailed,(r,s)=>{this.emit(z.TrackSubscriptionFailed,r,i,s)}).on(Q.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(z.TrackSubscriptionPermissionChanged,r,s,i)}).on(Q.Active,()=>{this.emitWhenConnected(z.ParticipantActive,i),i.kind===io.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&oE(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=st.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,un.STATE_MISMATCH))):e=0},E_)}clearConnectionReconcile(){this.connectionReconcileInterval&&st.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(z.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Se.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Se.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return I(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new yc({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Ae.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ji({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(z.SignalConnected),this.emit(z.Connected),this.setAndEmitConnectionState(Se.Connected),r.video){const o=new rd(F.Kind.Video,new kr({source:He.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:an.AUDIO,name:"video-dummy"}),new Ya(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:km(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(Q.LocalTrackPublished,o)}if(r.audio){const o=new rd(F.Kind.Audio,new kr({source:He.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:an.AUDIO}),new Qa(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:xl(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(Q.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new Ji({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Rr.ACTIVE,tracks:[],joinedAt:Ae.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const u=km(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),d=new kr({source:He.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:an.AUDIO});c.addSubscribedMediaTrack(u,d.sid,new MediaStream([u]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}if(s.audio){const u=xl(),d=new kr({source:He.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:an.AUDIO});c.addSubscribedMediaTrack(u,d.sid,new MediaStream([u]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==z.ActiveSpeakersChanged&&e!==z.TranscriptionReceived){const s=Y0(i).filter(o=>o!==void 0);(e===z.TrackSubscribed||e===z.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Hr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Y0(t){return t.map(e=>{if(e)return Array.isArray(e)?Y0(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var sn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(sn||(sn={}));class xi extends xn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=sn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Hr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return I(this,void 0,void 0,function*(){if(this.status!==sn.IDLE)throw Error("check is running already");this.setStatus(sn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==sn.SKIPPED&&this.setStatus(this.isSuccess()?sn.SUCCESS:sn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return I(this,void 0,void 0,function*(){return this.room.state===Se.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return I(this,void 0,void 0,function*(){this.room&&this.room.state!==Se.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(sn.SKIPPED)}switchProtocol(e){return I(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(z.Reconnecting,()=>{n=!0}),this.room.once(z.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield ot(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class __ extends xi{get description(){return"Cloud regions"}perform(){return I(this,void 0,void 0,function*(){const e=new ve(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return I(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,u="A".repeat(o),d=Date.now();for(let y=0;y<c;y++)yield s.write(u);yield s.close();const f=Date.now(),m=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),S={region:r,rtt:1e4,duration:f-d};return m==null||m.forEach(y=>{y.type==="candidate-pair"&&y.nominated&&(S.rtt=y.currentRoundTripTime*1e3)}),yield this.disconnect(),S})}}const jl=1e4;class P_ extends xi{get description(){return"Connection via UDP vs TCP"}perform(){return I(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(jl/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(jl/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return I(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],u=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,d={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},f=setInterval(()=>I(this,void 0,void 0,function*(){const m=yield u.getRTCStatsReport();m==null||m.forEach(S=>{S.type==="outbound-rtp"?(d.packetsSent=S.packetsSent,d.qualityLimitationDurations=S.qualityLimitationDurations,d.bitrateTotal+=S.targetBitrate,d.count++):S.type==="remote-inbound-rtp"&&(d.packetsLost=S.packetsLost,d.rttTotal+=S.roundTripTime,d.jitterTotal+=S.jitter)})}),1e3);return yield new Promise(m=>setTimeout(m,jl)),clearInterval(f),a.stop(),n.remove(),yield this.disconnect(),d})}}class R_ extends xi{get description(){return"Can publish audio"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield J0();if(yield O0(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class I_ extends xi{get description(){return"Can publish video"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield S_();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return I(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const u=document.createElement("canvas"),d=e.getSettings(),f=(o=(s=d.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,m=(c=(a=d.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;u.width=f,u.height=m;const S=u.getContext("2d");S.drawImage(i,0,0);const g=S.getImageData(0,0,u.width,u.height).data;let E=!0;for(let v=0;v<g.length;v+=4)if(g[v]!==0||g[v+1]!==0||g[v+2]!==0){E=!1;break}E?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class x_ extends xi{get description(){return"Resuming connection after interruption"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(u=>{setTimeout(u,5e3),s=u}),a=()=>{i=!0};n.on(z.SignalReconnecting,a).on(z.Reconnecting,a).on(z.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==Se.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class O_ extends xi{get description(){return"Can connect via TURN"}perform(){return I(this,void 0,void 0,function*(){var e,n,i;qr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new ve(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new kh,s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let o=!1,a=!1,c=!1;for(let u of s.iceServers)for(let d of u.urls)d.startsWith("turn:")?(a=!0,c=!0):d.startsWith("turns:")&&(a=!0,c=!0,o=!0),d.startsWith("stun:")&&(c=!0);c?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(u=>setTimeout(u,0)))})}}class M_ extends xi{get description(){return"Establishing WebRTC connection"}perform(){return I(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(z.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(A_(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),ue.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function A_(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class D_ extends xi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return I(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new kh,s;try{s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(o){if(qr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const c=yield new ve(this.url,this.token).getNextBestRegionUrl();c&&(s=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===Ny.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class y1 extends xn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:sn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==sn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return I(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(D_)})}checkWebRTC(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(M_)})}checkTURN(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(O_)})}checkReconnect(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(x_)})}checkPublishAudio(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(R_)})}checkPublishVideo(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(I_)})}checkConnectionProtocol(){return I(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(P_);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(__)})}}function pe(t,e,n){return(e=L_(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function N_(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function L_(t){var e=N_(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Ct extends Error{constructor(e,n){var i;super(e,n),pe(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}pe(Ct,"code","ERR_JOSE_GENERIC");class U_ extends Ct{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),pe(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),pe(this,"claim",void 0),pe(this,"reason",void 0),pe(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}pe(U_,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class F_ extends Ct{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),pe(this,"code","ERR_JWT_EXPIRED"),pe(this,"claim",void 0),pe(this,"reason",void 0),pe(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}pe(F_,"code","ERR_JWT_EXPIRED");class j_ extends Ct{constructor(){super(...arguments),pe(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}pe(j_,"code","ERR_JOSE_ALG_NOT_ALLOWED");class B_ extends Ct{constructor(){super(...arguments),pe(this,"code","ERR_JOSE_NOT_SUPPORTED")}}pe(B_,"code","ERR_JOSE_NOT_SUPPORTED");class V_ extends Ct{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),pe(this,"code","ERR_JWE_DECRYPTION_FAILED")}}pe(V_,"code","ERR_JWE_DECRYPTION_FAILED");class z_ extends Ct{constructor(){super(...arguments),pe(this,"code","ERR_JWE_INVALID")}}pe(z_,"code","ERR_JWE_INVALID");class W_ extends Ct{constructor(){super(...arguments),pe(this,"code","ERR_JWS_INVALID")}}pe(W_,"code","ERR_JWS_INVALID");class q_ extends Ct{constructor(){super(...arguments),pe(this,"code","ERR_JWT_INVALID")}}pe(q_,"code","ERR_JWT_INVALID");class H_ extends Ct{constructor(){super(...arguments),pe(this,"code","ERR_JWK_INVALID")}}pe(H_,"code","ERR_JWK_INVALID");class G_ extends Ct{constructor(){super(...arguments),pe(this,"code","ERR_JWKS_INVALID")}}pe(G_,"code","ERR_JWKS_INVALID");class K_ extends Ct{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),pe(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}pe(K_,"code","ERR_JWKS_NO_MATCHING_KEY");class $_ extends Ct{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),pe(this,Symbol.asyncIterator,void 0),pe(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}pe($_,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class J_ extends Ct{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),pe(this,"code","ERR_JWKS_TIMEOUT")}}pe(J_,"code","ERR_JWKS_TIMEOUT");class Q_ extends Ct{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),pe(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}pe(Q_,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function qn(){return qn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},qn.apply(null,arguments)}const Wm=new Uint8Array(0);class co{static getFullOptions(e){return qn({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(s){i.onError(`Unexpected error in client tool call handling: ${s instanceof Error?s.message:String(s)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_request":return void i.handleAgentToolRequest(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i==null?void 0:i.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i==null?void 0:i.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return Wm}getOutputByteFrequencyData(){return Wm}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let X0=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function Za(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const Z0="0.12.0";function sd(t){return!!t.type}const ek="conversation_initiation_client_data";function tk(t){var e;const n={type:ek};var i,r,s,o,a;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(s=t.overrides.agent)==null?void 0:s.language},tts:{voice_id:(o=t.overrides.tts)==null?void 0:o.voiceId},conversation:{text_only:(a=t.overrides.conversation)==null?void 0:a.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}let od=class nk extends X0{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",s=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:s}),0)}),this.socket.addEventListener("close",s=>{this.disconnect(s.code===1e3?{reason:"agent",context:s}:{reason:"error",message:s.reason||"The connection was closed by the server.",context:s})}),this.socket.addEventListener("message",s=>{try{const o=JSON.parse(s.data);if(!sd(o))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:s.data});this.handleMessage(o)}catch(o){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:o instanceof Error?o.message:String(o),data:s.data})}})}static async create(e){let n=null;try{var i,r,s;const a=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||Z0,d=((s=e.overrides)==null||(s=s.client)==null?void 0:s.source)||"js_sdk";if(e.signedUrl){const T=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${T}source=${d}&version=${u}`}else c=`${a}/v1/convai/conversation?agent_id=${e.agentId}&source=${d}&version=${u}`;const f=["convai"];e.authorization&&f.push(`bearer.${e.authorization}`),n=new WebSocket(c,f);const m=await new Promise((T,b)=>{n.addEventListener("open",()=>{var C;const x=tk(e);(C=n)==null||C.send(JSON.stringify(x))},{once:!0}),n.addEventListener("error",C=>{setTimeout(()=>b(C),0)}),n.addEventListener("close",b),n.addEventListener("message",C=>{const x=JSON.parse(C.data);sd(x)&&(x.type==="conversation_initiation_metadata"?T(x.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:S,agent_output_audio_format:y,user_input_audio_format:g}=m,E=Za(g??"pcm_16000"),v=Za(y);return new nk(n,S,E,v)}catch(a){var o;throw(o=n)==null||o.close(),a}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}};function ik(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function Y_(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Go=new Map;function rk(t,e){return async(n,i)=>{const r=Go.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Go.set(t,i)}catch(a){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${a}`)}const s=new Blob([e],{type:"application/javascript"}),o=URL.createObjectURL(s);try{return await n.addModule(o),void Go.set(t,o)}catch{URL.revokeObjectURL(o)}try{const a=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(a),Go.set(t,a)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const sk=rk("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class Un extends X0{constructor(e,n,i,r,s={}){super(s),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,s;const u=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||Z0,d=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",f=`${o=(s=e.origin)!=null?s:"https://api.elevenlabs.io",o.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${d}&version=${u}`,m=await fetch(f);if(!m.ok)throw new Error(`ElevenLabs API returned ${m.status} ${m.statusText}`);if(n=(await m.json()).token,!n)throw new Error("No conversation token received from API")}catch(u){let d=u instanceof Error?u.message:String(u);throw u instanceof Error&&u.message.includes("401")&&(d="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${d}`)}}var o;const a=new Hr;try{const u=`room_${Date.now()}`,d=Za("pcm_48000"),f=Za("pcm_48000"),m=new Un(a,u,d,f,e),S=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await a.connect(S,n),await new Promise(g=>{if(m.isConnected)g();else{const E=()=>{a.off(z.Connected,E),g()};a.on(z.Connected,E)}}),a.name&&(m.conversationId=((c=a.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||a.name),await a.localParticipant.setMicrophoneEnabled(!0);const y=tk(e);return m.debug({type:ek,message:y}),await m.sendMessage(y),m}catch(u){throw await a.disconnect(),u}}setupRoomEventListeners(){var e=this;this.room.on(z.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(z.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(z.ConnectionStateChanged,n=>{n===Se.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(z.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;sd(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(z.TrackSubscribed,async function(n,i,r){if(n.kind===F.Kind.Audio&&r.identity.includes("agent")){const s=n,o=s.attach();if(o.autoplay=!0,o.controls=!1,e.outputDeviceId&&o.setSinkId)try{await o.setSinkId(e.outputDeviceId)}catch(a){console.warn("Failed to set output device for new audio element:",a)}o.style.display="none",document.body.appendChild(o),e.audioElements.push(o),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(s)}}),this.room.on(z.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(z.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(F.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await sk(n.audioWorklet);const s=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(s),s.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),s.port.onmessage=o=>{const[a,c]=o.data;if(c>.01){const u=ik(a.buffer),d=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:u,event_id:d}})}},r.connect(s)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(F.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await J0(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:F.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function ok(t){const e=function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"}(t);switch(e){case"websocket":return od.create(t);case"webrtc":return Un.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function ad(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function ak(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(ad()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class Ph extends co{static async startSession(e){const n=co.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await ak(n.connectionDelay),i=await ok(e),new Ph(n,i)}catch(s){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),s}}}const qm={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class Nr{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:s,libsampleratePath:o}){let a=null,c=null;try{const f=qn({sampleRate:{ideal:e}},qm);if(ad()&&i){const v=(await window.navigator.mediaDevices.enumerateDevices()).find(T=>T.kind==="audioinput"&&["airpod","headphone","earphone"].find(b=>T.label.toLowerCase().includes(b)));v&&(f.deviceId={ideal:v.deviceId})}r&&(f.deviceId=Nr.getDeviceIdConstraint(r));const m=navigator.mediaDevices.getSupportedConstraints().sampleRate;a=new window.AudioContext(m?{sampleRate:e}:{});const S=a.createAnalyser();if(!m){const v=o||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await a.audioWorklet.addModule(v)}await sk(a.audioWorklet,s==null?void 0:s.rawAudioProcessor);const y=qn({voiceIsolation:!0},f);c=await navigator.mediaDevices.getUserMedia({audio:y});const g=a.createMediaStreamSource(c),E=new AudioWorkletNode(a,"rawAudioProcessor");return E.port.postMessage({type:"setFormat",format:n,sampleRate:e}),g.connect(S),S.connect(E),await a.resume(),new Nr(a,S,E,c,g)}catch(f){var u,d;throw(u=c)==null||u.getTracks().forEach(m=>{m.stop()}),(d=a)==null||d.close(),f}}static getDeviceIdConstraint(e){if(e)return ad()?{ideal:e}:{exact:e}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=s}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=qn({},qm);e&&(n.deviceId=Nr.getDeviceIdConstraint(e));const i=qn({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(s=>{s.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const X_=rk("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class ec{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let s=null,o=null;try{s=new AudioContext({sampleRate:e});const u=s.createAnalyser(),d=s.createGain();o=new Audio,o.src="",o.load(),o.autoplay=!0,o.style.display="none",document.body.appendChild(o);const f=s.createMediaStreamDestination();o.srcObject=f.stream,d.connect(u),u.connect(f),await X_(s.audioWorklet,r==null?void 0:r.audioConcatProcessor);const m=new AudioWorkletNode(s,"audioConcatProcessor");return m.port.postMessage({type:"setFormat",format:n}),m.connect(d),await s.resume(),i&&o.setSinkId&&await o.setSinkId(i),new ec(s,u,d,m,o)}catch(u){var a,c;throw(a=o)!=null&&a.parentNode&&o.parentNode.removeChild(o),(c=o)==null||c.pause(),s&&s.state!=="closed"&&await s.close(),u}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=s}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class Rh extends co{static async startSession(e){var n;const i=co.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,s=null,o=null,a=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var u;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await ak(i.connectionDelay),s=await ok(e),[r,o]=await Promise.all([Nr.create(qn({},s.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),ec.create(qn({},s.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(u=a)==null||u.getTracks().forEach(g=>{g.stop()}),a=null,new Rh(i,s,r,o,c)}catch(g){var d,f,m,S;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(d=a)==null||d.getTracks().forEach(E=>{E.stop()}),(f=s)==null||f.close(),await((m=r)==null?void 0:m.close()),await((S=o)==null?void 0:S.close());try{var y;await((y=c)==null?void 0:y.release()),c=null}catch{}throw g}}constructor(e,n,i,r,s){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=o=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:ik(o.data[0].buffer)})},this.onOutputWorkletMessage=({data:o})=>{o.type==="process"&&this.updateMode(o.finished?"listening":"speaking")},this.addAudioBase64Chunk=o=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:Y_(o)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=o=>{if(o.length===0)return 0;let a=0;for(let c=0;c<o.length;c++)a+=o[c]/255;return a/=o.length,a<0?0:a>1?1:a},this.setVolume=({volume:o})=>{const a=Number.isFinite(o)?Math.min(1,Math.max(0,o)):1;this.volume=a,this.connection instanceof Un?this.connection.setAudioVolume(a):this.output.gain.gain.value=a},this.input=i,this.output=r,this.wakeLock=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof Un||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof Un?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof Un?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof od)try{return await this.input.setInputDevice(r),this.input}catch(o){console.warn("Failed to change device on existing input, recreating:",o)}this.connection instanceof Un&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const s=await Nr.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(s){throw console.error("Error changing input device",s),s}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof od)try{return await this.output.setOutputDevice(i),this.output}catch(s){console.warn("Failed to change device on existing output, recreating:",s)}this.connection instanceof Un&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await ec.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var Hm;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(Hm||(Hm={}));var Gm,Km;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(Gm||(Gm={})),function(t){t.MANUAL="manual",t.VAD="vad"}(Km||(Km={}));class Z_ extends co{static startSession(e){return e.textOnly?Ph.startSession(e):Rh.startSession(e)}}function Fs(){return Fs=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Fs.apply(null,arguments)}const e1=["micMuted","volume","serverLocation"];function t1(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function n1(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function i1(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function r1(t={}){const{micMuted:e,volume:n,serverLocation:i}=t,r=function(g,E){if(g==null)return{};var v={};for(var T in g)if({}.hasOwnProperty.call(g,T)){if(E.indexOf(T)!==-1)continue;v[T]=g[T]}return v}(t,e1),s=Ce.useRef(null),o=Ce.useRef(null),[a,c]=Ce.useState("disconnected"),[u,d]=Ce.useState(!1),[f,m]=Ce.useState("listening"),S=Ce.useRef(e),y=Ce.useRef(n);return S.current=e,y.current=n,Ce.useEffect(()=>{var g;e!==void 0&&(s==null||(g=s.current)==null||g.setMicMuted(e))},[e]),Ce.useEffect(()=>{var g;n!==void 0&&(s==null||(g=s.current)==null||g.setVolume({volume:n}))},[n]),Ce.useEffect(()=>()=>{var g;(g=s.current)==null||g.endSession()},[]),{startSession:async g=>{var E;if((E=s.current)!=null&&E.isOpen())return s.current.getId();if(o.current)return(await o.current).getId();try{var v,T,b,C,x,A,D,U,V,R;const M=t1((g==null?void 0:g.serverLocation)||i),K=n1(M),Y=i1(M);return o.current=Z_.startSession(Fs({},r??{},g??{},{origin:K,livekitUrl:(g==null?void 0:g.livekitUrl)||(r==null?void 0:r.livekitUrl)||Y,overrides:Fs({},(v=r==null?void 0:r.overrides)!=null?v:{},(T=g==null?void 0:g.overrides)!=null?T:{},{client:Fs({},(b=r==null||(C=r.overrides)==null?void 0:C.client)!=null?b:{},(x=g==null||(A=g.overrides)==null?void 0:A.client)!=null?x:{},{source:(g==null||(D=g.overrides)==null||(D=D.client)==null?void 0:D.source)||(r==null||(U=r.overrides)==null||(U=U.client)==null?void 0:U.source)||"react_sdk",version:(g==null||(V=g.overrides)==null||(V=V.client)==null?void 0:V.version)||(r==null||(R=r.overrides)==null||(R=R.client)==null?void 0:R.version)||"0.12.1"})}),onConnect:(g==null?void 0:g.onConnect)||(r==null?void 0:r.onConnect),onDisconnect:(g==null?void 0:g.onDisconnect)||(r==null?void 0:r.onDisconnect),onError:(g==null?void 0:g.onError)||(r==null?void 0:r.onError),onMessage:(g==null?void 0:g.onMessage)||(r==null?void 0:r.onMessage),onAudio:(g==null?void 0:g.onAudio)||(r==null?void 0:r.onAudio),onDebug:(g==null?void 0:g.onDebug)||(r==null?void 0:r.onDebug),onUnhandledClientToolCall:(g==null?void 0:g.onUnhandledClientToolCall)||(r==null?void 0:r.onUnhandledClientToolCall),onVadScore:(g==null?void 0:g.onVadScore)||(r==null?void 0:r.onVadScore),onInterruption:(g==null?void 0:g.onInterruption)||(r==null?void 0:r.onInterruption),onAgentToolRequest:(g==null?void 0:g.onAgentToolRequest)||(r==null?void 0:r.onAgentToolRequest),onAgentToolResponse:(g==null?void 0:g.onAgentToolResponse)||(r==null?void 0:r.onAgentToolResponse),onConversationMetadata:(g==null?void 0:g.onConversationMetadata)||(r==null?void 0:r.onConversationMetadata),onMCPToolCall:(g==null?void 0:g.onMCPToolCall)||(r==null?void 0:r.onMCPToolCall),onMCPConnectionStatus:(g==null?void 0:g.onMCPConnectionStatus)||(r==null?void 0:r.onMCPConnectionStatus),onAsrInitiationMetadata:(g==null?void 0:g.onAsrInitiationMetadata)||(r==null?void 0:r.onAsrInitiationMetadata),onAgentChatResponsePart:(g==null?void 0:g.onAgentChatResponsePart)||(r==null?void 0:r.onAgentChatResponsePart),onModeChange:({mode:se})=>{var le;m(se),(le=(g==null?void 0:g.onModeChange)||(r==null?void 0:r.onModeChange))==null||le({mode:se})},onStatusChange:({status:se})=>{var le;c(se),(le=(g==null?void 0:g.onStatusChange)||(r==null?void 0:r.onStatusChange))==null||le({status:se})},onCanSendFeedbackChange:({canSendFeedback:se})=>{var le;d(se),(le=(g==null?void 0:g.onCanSendFeedbackChange)||(r==null?void 0:r.onCanSendFeedbackChange))==null||le({canSendFeedback:se})}})),s.current=await o.current,S.current!==void 0&&s.current.setMicMuted(S.current),y.current!==void 0&&s.current.setVolume({volume:y.current}),s.current.getId()}finally{o.current=null}},endSession:async()=>{const g=s.current;s.current=null,await(g==null?void 0:g.endSession())},setVolume:({volume:g})=>{var E;(E=s.current)==null||E.setVolume({volume:g})},getInputByteFrequencyData:()=>{var g;return(g=s.current)==null?void 0:g.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var g;return(g=s.current)==null?void 0:g.getOutputByteFrequencyData()},getInputVolume:()=>{var g,E;return(g=(E=s.current)==null?void 0:E.getInputVolume())!=null?g:0},getOutputVolume:()=>{var g,E;return(g=(E=s.current)==null?void 0:E.getOutputVolume())!=null?g:0},sendFeedback:g=>{var E;(E=s.current)==null||E.sendFeedback(g)},getId:()=>{var g;return(g=s.current)==null?void 0:g.getId()},sendContextualUpdate:g=>{var E;(E=s.current)==null||E.sendContextualUpdate(g)},sendUserMessage:g=>{var E;(E=s.current)==null||E.sendUserMessage(g)},sendUserActivity:()=>{var g;(g=s.current)==null||g.sendUserActivity()},sendMCPToolApprovalResult:(g,E)=>{var v;(v=s.current)==null||v.sendMCPToolApprovalResult(g,E)},changeInputDevice:async g=>{if(s.current&&"changeInputDevice"in s.current)return await s.current.changeInputDevice(g);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async g=>{if(s.current&&"changeOutputDevice"in s.current)return await s.current.changeOutputDevice(g);throw new Error("Device switching is only available for voice conversations")},status:a,canSendFeedback:u,micMuted:e,isSpeaking:f==="speaking"}}/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var s1={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o1=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Jr=(t,e)=>{const n=Ce.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:a="",children:c,...u},d)=>Ce.createElement("svg",{ref:d,...s1,width:r,height:r,stroke:i,strokeWidth:o?Number(s)*24/Number(r):s,className:["lucide",`lucide-${o1(t)}`,a].join(" "),...u},[...e.map(([f,m])=>Ce.createElement(f,m)),...Array.isArray(c)?c:[c]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a1=Jr("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c1=Jr("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l1=Jr("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1=Jr("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d1=Jr("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h1=Jr("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),f1=({squatState:t})=>{const[e,n]=Ce.useState(""),i=Ce.useRef(t);Ce.useEffect(()=>{i.current=t},[t]);const r=r1({onConnect:()=>console.log("Connected to ElevenLabs"),onDisconnect:()=>console.log("Disconnected from ElevenLabs"),onMessage:d=>console.log("Message:",d),onError:d=>console.error("Error:",d)}),{status:s,isSpeaking:o}=r,a=async()=>{if(!e){alert("Please enter an Agent ID first");return}try{await r.startSession({agentId:e,clientTools:{get_squat_analysis:{description:"Get the current squat count, knee angle, and form feedback.",parameters:{},handler:async()=>{const{count:d,angle:f,feedback:m,isGoodForm:S,stage:y}=i.current;return console.log("Agent asked for data:",i.current),{squat_count:d,current_knee_angle:f,feedback_string:m,is_form_good:S,movement_stage:y}}}}})}catch(d){console.error("Failed to start conversation:",d)}},c=async()=>{await r.endSession()},u=s==="connected";return ie.jsx("div",{className:"bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700 w-full max-w-md mx-auto",children:ie.jsxs("div",{className:"flex flex-col gap-4",children:[ie.jsxs("div",{className:"flex items-center justify-between",children:[ie.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[ie.jsx(d1,{className:`w-5 h-5 ${u?"text-green-500 animate-pulse":"text-slate-500"}`}),"Coach AI"]}),ie.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-mono ${u?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-400"}`,children:s})]}),!u&&ie.jsx("input",{type:"text",placeholder:"Enter Agent ID",value:e,onChange:d=>n(d.target.value),className:"bg-slate-900 border border-slate-700 text-white px-3 py-2 rounded-lg text-sm w-full"}),ie.jsx("div",{className:"flex gap-4",children:u?ie.jsxs("button",{onClick:c,className:"flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2",children:[ie.jsx(l1,{className:"w-5 h-5"}),"Stop Coaching"]}):ie.jsxs("button",{onClick:a,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2",children:[ie.jsx(u1,{className:"w-5 h-5"}),"Start Coaching"]})}),o&&ie.jsx("div",{className:"flex justify-center my-2",children:ie.jsx("div",{className:"flex gap-1 h-3 items-end",children:[...Array(5)].map((d,f)=>ie.jsx("div",{className:"w-1 bg-blue-400 animate-[bounce_1s_infinite]",style:{animationDelay:`${f*.1}s`,height:"100%"}},f))})})]})})},p1=()=>{const[t,e]=Ce.useState(0),[n,i]=Ce.useState(180),[r,s]=Ce.useState("UP"),[o,a]=Ce.useState("Prt pour commencer"),[c,u]=Ce.useState(!0),d=Ce.useRef(180),f=(S,y,g)=>{const E=Math.atan2(g.y-y.y,g.x-y.x)-Math.atan2(S.y-y.y,S.x-y.x);let v=Math.abs(E*180/Math.PI);return v>180&&(v=360-v),v},m=Ce.useCallback(S=>{if(!S)return;const y=S[23],g=S[25],E=S[27];if(y.visibility>.5&&g.visibility>.5&&E.visibility>.5){const v=f(y,g,E);i(Math.round(v)),v>160&&(r==="DOWN"&&(s("UP"),e(T=>T+1),a("Reptition valide !")),d.current=180),v<100&&(s("DOWN"),d.current>v&&(d.current=v)),v<70?(a("Trop bas ! Attention aux genoux."),u(!1)):v>160?(a("Debout, position neutre."),u(!0)):v<=100&&v>=80?(a("Excellente profondeur !"),u(!0)):(a("En mouvement..."),u(!0))}},[r]);return{count:t,angle:n,stage:r,feedback:o,isGoodForm:c,processLandmarks:m}};function m1(){const{count:t,angle:e,stage:n,feedback:i,isGoodForm:r,processLandmarks:s}=p1(),o={count:t,angle:e,stage:n,feedback:i,isGoodForm:r};return ie.jsxs("div",{className:"min-h-screen bg-slate-900 p-8 font-sans",children:[ie.jsx("header",{className:"mb-8 flex items-center justify-between",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:ie.jsx(c1,{className:"w-8 h-8 text-white"})}),ie.jsxs("div",{children:[ie.jsx("h1",{className:"text-3xl font-black text-white tracking-tight",children:"SquatAI Coach"}),ie.jsx("p",{className:"text-slate-400 text-sm",children:"Powered by ElevenLabs & MediaPipe"})]})]})}),ie.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8",children:[ie.jsx("div",{className:"lg:col-span-2 space-y-4",children:ie.jsxs("div",{className:"relative aspect-video bg-black rounded-3xl overflow-hidden shadow-2xl border-4 border-slate-800",children:[ie.jsx(OC,{onPoseDetected:s}),ie.jsxs("div",{className:"absolute top-4 left-4 bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10",children:[ie.jsx("div",{className:"text-slate-400 text-xs uppercase font-bold tracking-wider",children:"Knee Angle"}),ie.jsxs("div",{className:"text-4xl font-mono font-bold text-white",children:[e,""]})]}),ie.jsxs("div",{className:"absolute top-4 right-4 bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10",children:[ie.jsx("div",{className:"text-slate-400 text-xs uppercase font-bold tracking-wider",children:"Squats"}),ie.jsx("div",{className:"text-5xl font-mono font-bold text-blue-400",children:t})]})]})}),ie.jsxs("div",{className:"space-y-6",children:[ie.jsxs("div",{className:`p-6 rounded-2xl border-2 transition-all ${r?"bg-slate-800 border-slate-700":"bg-red-900/20 border-red-500/50"}`,children:[ie.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[ie.jsx(a1,{className:"w-5 h-5 text-slate-400"}),ie.jsx("span",{className:"text-sm font-bold text-slate-400 uppercase",children:"Live Analysis"})]}),ie.jsx("div",{className:`text-2xl font-bold ${r?"text-green-400":"text-red-400"}`,children:i}),ie.jsxs("div",{className:"flex items-center gap-2 mt-4 text-sm text-slate-500",children:[ie.jsx("div",{className:`w-3 h-3 rounded-full ${n==="DOWN"?"bg-blue-500":"bg-slate-600"}`}),ie.jsxs("span",{children:["Phase: ",n]})]})]}),ie.jsx(f1,{squatState:o}),ie.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-2xl border border-slate-700/50",children:[ie.jsxs("h3",{className:"font-bold text-white mb-2 flex items-center gap-2",children:[ie.jsx(h1,{className:"w-4 h-4 text-yellow-500"}),"How to use"]}),ie.jsxs("ul",{className:"text-sm text-slate-400 space-y-2 list-disc list-inside",children:[ie.jsx("li",{children:"Make sure your full body is visible"}),ie.jsx("li",{children:"Stand sideways to the camera for best angle detection"}),ie.jsx("li",{children:"Enter your ElevenLabs Agent ID"}),ie.jsx("li",{children:'Start the session and ask "How is my form?"'})]})]})]})]})]})}Bl.createRoot(document.getElementById("root")).render(ie.jsx(gS.StrictMode,{children:ie.jsx(m1,{})}));
